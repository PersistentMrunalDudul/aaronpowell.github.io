<!DOCTYPE HTML>
<!--
    Strongly Typed 1.0 by HTML5 UP
    html5up.net | @n33co
    Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
    <head>
  <meta charset="utf-8">
  <title>Storing credentials in Windows 8 | LINQ to Fail</title>
  <meta name="author" content="Aaron Powell">
  <meta name="viewport" content="width=1040" />
  <link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600|Arvo:700" rel="stylesheet" type="text/css" />
  <link href="/css/highlightjs/solarized_light.css" rel="stylesheet" type="text/css" />
  <script src="/js/jquery-1.9.1.min.js"></script>
  <script src="/js/jquery.dropotron-1.3.js"></script>
  <script src="/js/config.js"></script>
  <script src="/js/skel.min.js"></script>
  <script src="/js/skel-ui.min.js"></script>
  <noscript>
    <link rel="stylesheet" href="/css/skel-noscript.css" />
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/style-desktop.css" />
  </noscript>
  <!--[if lte IE 8]><script src="/js/html5shiv.js"></script><![endif]-->

</head>

    <body class="left-sidebar">

        <div id="header-wrapper">
            <div id="header" class="container">
                <h1 id="logo">Storing credentials in Windows 8</h1>
                <h2>4th June 2012</h2>
                <ul class="tags">
    
        <li><a class="icon icon-tag" href="/tagged/windows8.html"><span>windows8</span></a></li>
    
</ul>
                <!-- Nav -->
<nav id="nav">
    <ul>
        <li><a class="icon icon-home" href="/"><span>Home</span></a></li>
        <li><a class="icon icon-github" href="https://github.com/aaronpowell"><span>aaronpowell</span></a></li>
        <li><a class="icon icon-twitter" href="http://twitter.com/slace"><span>@slace</span></a></li>
        <li><a class="icon icon-book" href="/about"><span>About Me</span></a></li>
        <li><a class="icon icon-rss" href="/feed"><span>Feed</span></a></li>
    </ul>
</nav>

            </div>
        </div>

        <div id="main-wrapper">
            <div id="main" class="container">
                <div class="row">
                    <div id="sidebar" class="4u">
    <section>
        <ul class="divided">
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">24th September 2012</span>
                            <h3><a href="/posts/2012-09-24-check-if-file-exists.html">How to check if a file exists in Windows 8</a></h3>
                        </header>
                        <p>Ever wondered how to check if a file exists in Windows 8?</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/windows8.html"><span>windows8</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/winjs.html"><span>winjs</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/c-.html"><span>c#</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/winrt.html"><span>winrt</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">14th September 2012</span>
                            <h3><a href="/posts/2012-09-14-settings-suck.html">The settings suck</a></h3>
                        </header>
                        <p>Settings in Windows 8 XAML suck. Period.</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/xaml.html"><span>xaml</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/windows8.html"><span>windows8</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/rant.html"><span>rant</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">14th September 2012</span>
                            <h3><a href="/posts/2012-09-14-creating-classes.html">Creating classes in WinJS</a></h3>
                        </header>
                        <p>A look at how you can create JavaScript classes in WinJS</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/winjs.html"><span>winjs</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/windows8.html"><span>windows8</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">1st June 2012</span>
                            <h3><a href="/posts/2012-06-01-pinboard-for-win8.html">Pinboard for Windows 8</a></h3>
                        </header>
                        <p>A Windows 8 application for the Pinboard bookmarking service</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/windows8.html"><span>windows8</span></a>
                            
                        </div>
                    </article>
                </li>
            
        </ul>
    </section>
</div>

                    <div id="content" class="8u skel-cell-mainContent">
                        <article class="is-post">
                            <p>So you&#39;re building a Windows 8 application and you want to authenticate against an external service. For this it&#39;s likely that you&#39;re going to want to store a username and password for the user so that you can query off to the external service without bugging them constantly.</p>
<p>This was something that I had to do for my <a href="http://www.aaron-powell.com/pinboard-for-win8">Pinboard for Windows 8</a> application so I wanted to make sure that I was doing it above board and no one would think I&#39;ve been sneaky and abused their privacy.</p>
<h1>Accessing credentials</h1>
<p>Luckily Windows 8 provides you a nice and easy way which you can store the credentials your application has. I&#39;ll admit that I&#39;ve not done a lot of desktop application development so this may not be <em>that</em> new but hey it&#39;s new to me and new for WinJS :P. The way you interact with the credentials is through the <a href="http://msdn.microsoft.com/en-us/library/windows/apps/xaml/br227081.aspx"><code>Windows.Security.Credentials.PasswordVault</code></a> class and it&#39;s shockingly simple to do:</p>
<pre class="highlighted"><code class="nginx"><span class="title">var</span> resourceKey = <span class="string">'My app key'</span>;
<span class="title">var</span> passwordVault = new Windows.Security.Credentials.PasswordVault();

<span class="title">var</span> credentials = passwordVault.findAllByResource(resourceKey);</code></pre>
<p>First off you need to create a resource key for your application; this is an identifier for your application&#39;s credentials. The <code>FindAllByResource</code> method will provide you with all the credentials you&#39;ve stored, you can then filter this down as required to find the particular user you&#39;re after.</p>
<p>Once you have the username you can retrieve the password since the password wont be provided in a usable method initial (I&#39;m guessing for security reasons) so you have to explicitly request it:</p>
<pre class="highlighted"><code class="avrasm">var user = passwordVault<span class="preprocessor">.retrieve</span>(resoruceKey, credentials[<span class="number">0</span>]<span class="preprocessor">.userName</span>)<span class="comment">;</span></code></pre>
<p>This <code>user</code> object will have a password property that you can do what ever you need to do.</p>
<h1>Where it gets ugly</h1>
<p>It&#39;s the first time a user installs your application so you wont have any credentials. You want them to log in before you can do anything right? That makes sense so you check to see if there is a user:</p>
<pre class="highlighted"><code class="cs"><span class="keyword">var</span> resourceKey = <span class="string">'My app key'</span>;
<span class="keyword">var</span> passwordVault = <span class="keyword">new</span> Windows.Security.Credentials.PasswordVault();

<span class="keyword">var</span> credentials = passwordVault.findAllByResource(resourceKey);

<span class="keyword">if</span> (credentials.length) {
    <span class="comment">//we've got a credential</span>
} <span class="keyword">else</span> {
    <span class="comment">//no credentials yet</span>
}</code></pre>
<p>Right? <strong>Wrong.</strong></p>
<p>Where you expect to an empty credential store for your resource you actually get... <strong>an exception</strong>! That right the code you&#39;ll actually need looks more like this:</p>
<pre class="highlighted"><code class="cs"><span class="keyword">var</span> resourceKey = <span class="string">'My app key'</span>;
<span class="keyword">var</span> passwordVault = <span class="keyword">new</span> Windows.Security.Credentials.PasswordVault();

<span class="keyword">var</span> credentials;

<span class="keyword">try</span> {
    credentials = passwordVault.findAllByResource(resourceKey);
    <span class="comment">//we've got a credential</span>
} <span class="keyword">catch</span> (e) {
    <span class="comment">//no credentials yet</span>
}</code></pre>
<p><em>Le sigh...</em> I haven&#39;t found any better way to do this other than trying to get <em>all</em> credentials using the <a href="http://msdn.microsoft.com/en-us/library/windows/apps/xaml/windows.security.credentials.passwordvault.retrieveall.aspx"><code>retrieveAll</code></a> method but that implies that it gets back all credentials regardless of the resource key, which is what we really want to identify our application.</p>
<h1>Storing credentials</h1>
<p>Once we get passed the oddity of try/ catch driven development it&#39;s worthwhile thinking about storing credentials. Turns out that this is also really easy to do:</p>
<pre class="highlighted"><code class="avrasm">var creds = new Windows<span class="preprocessor">.Security</span><span class="preprocessor">.Credentials</span><span class="preprocessor">.PasswordCredential</span>(resourceKey, username, password)<span class="comment">;</span>

passwordVault<span class="preprocessor">.add</span>(creds)<span class="comment">;</span></code></pre>
<p>Now your store is updated and what&#39;s also cool is that you can access them from Windows 8 itself. If you navigate to <code>Control Panel\User Accounts and Family Safety\Credential Manager</code> you&#39;ll see your newly stored credentials:</p>
<p><img src="http://www.aaron-powell.com/get/windows-8-credentials-store.png" alt="Credentials Store"></p>
<p>And there we go, all stored securely inside the Windows security store. The other cool thing about this is that it allows credentials to roam between devices, I haven&#39;t been able to put this to the test yet though as I only have one machine with Windows 8 on it so roaming isn&#39;t all that viable!</p>
<h1>Conclusion</h1>
<p>Storing credentials in Windows 8 is so simple but it has some strangeness about it. Your main point of call is the <a href="http://msdn.microsoft.com/en-us/library/windows/apps/xaml/br227081.aspx"><code>PasswordVault</code></a> class, part of the Windows 8 runtime, which gives you a simple programming interface into the Windows security store.</p>

                        </article>
                    </div>
                    <div class="8u skel-cell-mainContent">
                        <article class="is-post">
                            <div id="disqus_thread"></div>
<script>
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
window.disqus_shortname = 'aaronpowell'; // required: replace example with your forum shortname
window.disqus_identifier = document.title || 'Home';
window.disqus_developer = !! ~document.location.href.indexOf("localhost") ? 1 : 0;
window.disqus_url = document.location.origin + '/storing-credentials-windows-8';

/* * * DON'T EDIT BELOW THIS LINE * * */
(function () {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by</a>
<span class="logo-disqus"> Disqus</span>

                        </article>
                    </div>
                </div>
            </div>
        </div>

        <div id="footer-wrapper">

    <!-- Copyright -->
        <div id="copyright" class="container">
            <ul class="links">
                <li>&copy; Aaron Powell. All rights reserved</li>
                <li>Design: <a href="http://html5up.net/">HTML5 UP</a></li>
            </ul>
        </div>

</div>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-6399564-1']);
  _gaq.push(['_trackPageview']);

  (function () {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
  })();

</script>

    </body>
</html>