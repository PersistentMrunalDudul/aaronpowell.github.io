<!DOCTYPE HTML>
<!--
    Strongly Typed 1.0 by HTML5 UP
    html5up.net | @n33co
    Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
    <head>
  <meta charset="utf-8">
  <title>An EventManager in JavaScript - LINQ to Fail</title>
  <meta name="author" content="Aaron Powell">
  <meta name="viewport" content="width=1040" />
  <link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600|Arvo:700" rel="stylesheet" type="text/css" />
  <link href="/css/highlightjs/solarized_light.css" rel="stylesheet" type="text/css" />
  <script src="/js/jquery-1.9.1.min.js"></script>
  <script src="/js/jquery.dropotron-1.3.js"></script>
  <script src="/js/config.js"></script>
  <script src="/js/skel.min.js"></script>
  <script src="/js/skel-ui.min.js"></script>
  <noscript>
    <link rel="stylesheet" href="/css/skel-noscript.css" />
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/style-desktop.css" />
  </noscript>
  <!--[if lte IE 8]><script src="/js/html5shiv.js"></script><![endif]-->

</head>

    <body class="left-sidebar">

        <div id="header-wrapper">
            <div id="header" class="container">
                <h1 id="logo">An EventManager in JavaScript</h1>
                <h2>12th September 2010</h2>
                <ul class="tags">
    
        <li><a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a></li>
    
        <li><a class="icon icon-tag" href="/tagged/javascript-eventmanager.html"><span>javascript-eventmanager</span></a></li>
    
        <li><a class="icon icon-tag" href="/tagged/web.html"><span>web</span></a></li>
    
</ul>
                <!-- Nav -->
<nav id="nav">
    <ul>
        <li><a class="icon icon-home" href="/"><span>Home</span></a></li>
        <li><a class="icon icon-github" href="https://github.com/aaronpowell"><span>aaronpowell</span></a></li>
        <li><a class="icon icon-twitter" href="http://twitter.com/slace"><span>@slace</span></a></li>
        <li><a class="icon icon-book" href="/about"><span>About Me</span></a></li>
        <li><a class="icon icon-rss" href="/feed"><span>Feed</span></a></li>
    </ul>
</nav>

            </div>
        </div>

        <div id="main-wrapper">
            <div id="main" class="container">
                <div class="row">
                    <div id="sidebar" class="4u">
    <section>
        <ul class="divided">
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">14th July 2013</span>
                            <h3><a href="/posts/2013-07-14-javascript-new-operator.html">The JavaScript new operator</a></h3>
                        </header>
                        <p>Time to revisit something that was overlooked in the last post, the <code>new</code> operator in JavaScript and what it does.</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">10th July 2013</span>
                            <h3><a href="/posts/2013-07-10-implementing-indexers-in-javascript.html">Implementing "indexers" in JavaScript</a></h3>
                        </header>
                        <p>My colleague Luke Drumm challenged me to implement C# style indexers in JavaScript.</p>
<p>So let&#39;s have a look at how you can do that, and how you can make some very interesting JavaScript objects that are self replicating. We&#39;ll build on the knowledge of using <code>bind</code> and <code>apply</code> from the last two posts.</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">5th July 2013</span>
                            <h3><a href="/posts/2013-07-05-javascript-binding-currying-and-arrows.html">JavaScript bind, currying and arrow functions</a></h3>
                        </header>
                        <p>After confusing my colleagues with how to invoke functions with a modifided set of arguments at a single time the next evolutionary point was to confuse them with creating functions that are always called with a different state.</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">4th July 2013</span>
                            <h3><a href="/posts/2013-07-04-javascript-call-and-apply.html">JavaScript call and apply</a></h3>
                        </header>
                        <p>After having confused one of my colleagues with some code that used the JavaScript <code>apply</code> method and giving them an answer that didn&#39;t leave them completely bemused I thought I&#39;d share my explanation with the world.</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">21st June 2013</span>
                            <h3><a href="/posts/2013-06-21-walking-a-javascript-object.html">Walking a JavaScript object</a></h3>
                        </header>
                        <p>Ever had a path to a path to a property on a JavaScript object that you want to walk? Something along the lines of <code>foo.bar.baz</code>.</p>
<p>Recently I was trying to solve this problem and came across a nifty little trick</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                        </div>
                    </article>
                </li>
            
        </ul>
    </section>
</div>

                    <div id="content" class="8u skel-cell-mainContent">
                        <article class="is-post">
                            <h2>Overview</h2>
<p>Previously I&#39;ve blogged about <a href="/client-event-pool">Client Event Pool&#39;s</a> (yes I know the images are broken), but that example was intrinsically tied to Microsoft AJAX and I wanted to have one which was separate from it.</p>
<p>So I decided to create an object that resides at <code>slace.core.eventManager</code> which will achieve this.</p>
<p><em>Note: This library has a dependency on the <code>slace.core</code> library.</em></p>
<p>This API allows you to bind events, trigger events, unbind events (and event handlers) and event check if an event handler is registered.</p>
<p>This is all possible without having to explicitly tie each object to the objects which need to know about the events it&#39;s firing. To fully understand the idea behind the Client Event Pool concept I suggest you read my previous article and its references.</p>
<h2>Binding events</h2>
<p>The concept of binding to an event is handy if you&#39;ve got code on a page that you want to run when a certain event will be completed (although the code may also be run by other means), and to do this there is a simple method which works like this:</p>
<pre class="highlighted"><code class="r">slace.core.eventManager.bind(<span class="string">'some event'</span>, <span class="keyword">function</span>() { <span class="keyword">...</span> });</code></pre>
<p>This will put that handler there so that if any code that triggers (raises) the &#39;some event&#39; event the handler you specify will be executed.</p>
<p>You can call <code>bind</code> as many times as you like, adding as many handlers as you want.</p>
<p>One thing that can be handy (if you need to add/ remove events programmatically) is the ability to provide a unique ID to an event handler, to do that it&#39;s a third argument to the <code>bind</code> method:</p>
<pre class="highlighted"><code class="r">slace.core.eventManager.bind(<span class="string">'some event'</span>, <span class="keyword">function</span>() { <span class="keyword">...</span> }, <span class="string">'awesome-event'</span>);</code></pre>
<p>This will give the identifier of &#39;awesome-event&#39; to the function you provided (we&#39;ll look at how this is handy shortly)</p>
<h3>How it works</h3>
<p>Here&#39;s the code that makes up <code>bind</code>:</p>
<pre class="highlighted"><code class="avrasm">    bind: function (name, fn, eventHandlerId) {
        var e = getEvent(name)<span class="comment">;</span>
        if (!eventHandlerId) {
            eventHandlerId = name + <span class="string">'-'</span> + (e<span class="preprocessor">.length</span> + <span class="number">1</span>)<span class="comment">;</span>
        }
        fn<span class="preprocessor">.id</span> = eventHandlerId<span class="comment">;</span>
        e<span class="preprocessor">.push</span>(fn)<span class="comment">;</span>
    }</code></pre>
<p><em>I&#39;ve omitted the getEvent method as it&#39;s not important, look into the real source for it</em></p>
<p>What it does is check if you gave a unique ID, and if you didn&#39;t then I&#39;ll create one based off of the name of the event and the position in array of handlers and then it&#39;s assigned to the <code>id</code> property of the function object and adds it to the array of handlers.</p>
<h2>Triggering events</h2>
<p>If you&#39;re binding to events you&#39;re probably going to want to be raising them as well, and this is what the <code>trigger</code> method is for and it works similarly to .NET events, like so:</p>
<pre class="highlighted"><code class="matlab"><span class="transposed_variable">slace.</span><span class="transposed_variable">core.</span><span class="transposed_variable">eventManager.</span>trigger(<span class="string">'some event'</span>);</code></pre>
<p>When triggering an event you need to provide it the name of the event to trigger (eg: &#39;some event&#39;). Additionally there are two more arguments, with the full method call looking like this:</p>
<pre class="highlighted"><code class="matlab"><span class="transposed_variable">slace.</span><span class="transposed_variable">core.</span><span class="transposed_variable">eventManager.</span>trigger(<span class="string">'some event'</span>, source, args);</code></pre>
<p>If you&#39;ve been doing much JavaScript work you&#39;ll be familiar with just how much fun scope can be in JavaScript, well with the <code>trigger</code> method, you&#39;re able to specify what object you want to be scoped as the <code>this</code> object in the method when it runs. This is the 2nd argument to the <code>trigger</code> method.</p>
<p>Lastly you can pass in arguments you want for the event handlers. If your handlers are to accept multiple arguments then you need to pass in an array, but I&#39;d suggest just passing in an object literal each time, it&#39;s a lot more flexible than multiple arguments :P.</p>
<p>The most common reason I&#39;ve needed to use this is to work nicely with AJAX requests, rather than having to pass in call-back methods ;).</p>
<h3>How it works</h3>
<p>Here&#39;s the code:</p>
<pre class="highlighted"><code class="matlab">    trigger: <span class="function"><span class="keyword">function</span> <span class="params">(name, source, args)</span> {</span>
        <span class="keyword">if</span> (!source) <span class="cell">{
            source = {}</span>;
        }
        <span class="keyword">if</span> (!args) <span class="cell">{
            args = [];
        }</span>
        var evt = getEvent(name);
        <span class="keyword">if</span> (!evt || (<span class="transposed_variable">evt.</span><span class="built_in">length</span> === <span class="number">0</span>)) <span class="cell">{
            return;
        }</span>
        evt = <span class="transposed_variable">evt.</span><span class="built_in">length</span> === <span class="number">1</span> ? <span class="matrix">[evt[<span class="number">0</span>]</span>] : <span class="transposed_variable">Array.</span>apply(null, evt);
        <span class="keyword">if</span> (<span class="transposed_variable">args.</span>constructor !== Array) <span class="cell">{
            args = [args];
        }</span>
        <span class="keyword">for</span> (var <span class="built_in">i</span> = <span class="number">0</span>, l = <span class="transposed_variable">evt.</span><span class="built_in">length</span>; <span class="built_in">i</span> &lt; l; <span class="built_in">i</span>++) <span class="cell">{
            evt[i].apply(source, args);
        }</span>
    }</code></pre>
<p>First off I do a few things like making sure you&#39;re passing in an object for the sender (or I&#39;ll default it to an empty one) and some arguments (which will become an empty array if it&#39;s not there).</p>
<p>Next I get the event by name and make sure there are some handlers to run.</p>
<p>If there are some handlers it&#39;ll just do a check to make sure that it&#39;s an array that we&#39;ll be working with for the handlers, ensure that the arguments are an array (if it&#39;s not the code will break during the <code>apply</code> method, since you <strong>have</strong> to pass an array as the 2nd argument to it) and then we iterate through all the handlers in the order they were added, setting the scope to what was specified.</p>
<h2>Programmatically playing with events</h2>
<p>In addition to <code>bind</code> and <code>trigger</code> there are two methods which are handy if you&#39;re trying to work with events easily.</p>
<p>As I mentioned for the <code>bind</code> method you can pass in an ID for the event handler, well the ID can be used to remove the event:</p>
<pre class="highlighted"><code class="matlab"><span class="transposed_variable">slace.</span><span class="transposed_variable">core.</span><span class="transposed_variable">eventManager.</span>unbind(<span class="string">'some event'</span>, <span class="string">'my-event'</span>);</code></pre>
<p>What this will do is iterate through all the registered handlers and if one matches with the ID you&#39;ve provided then it&#39;ll remove it from the handler collection.</p>
<p>If you want to get rid of all the event handlers you can just omit the handler ID and it&#39;ll clear all the handlers for that event.</p>
<p>Another useful feature of the <code>eventManager</code> is that it allows you to check if an event is already registered. If you had a named function that you want to bind to an event you should check to make sure it hasn&#39;t already been registered, eg:</p>
<pre class="highlighted"><code class="matlab"><span class="transposed_variable">slace.</span><span class="transposed_variable">core.</span><span class="transposed_variable">eventManager.</span>isRegistered(<span class="string">'some event'</span>, <span class="string">'my-event'</span>);</code></pre>
<p>This will return true or false depending on whether the ID you&#39;re providing matches a handler registered in that event.</p>
<p>You could use it like this:</p>
<pre class="highlighted"><code class="r"><span class="keyword">function</span> myMethod() { <span class="keyword">...</span> }

/* <span class="keyword">...</span> */

<span class="keyword">if</span>(!slace.core.eventManager.isRegistered(<span class="string">'some event'</span>, <span class="string">'myMethod'</span>)) {
    slace.core.eventManager.bind(<span class="string">'somme event'</span>, myMethod);
}</code></pre>
<p>Sure it&#39;s a sandboxed example but it should give you an idea.</p>
<h2>Source Code</h2>
<p>You can grab the full source code for the <code>eventManager</code> from the project on bitbucket, which is here: <a href="http://bitbucket.org/slace/javascript-tools/src/tip/JavaScriptTools/Scripts/slace.core.eventManager.js"><a href="http://bitbucket.org/slace/javascript-tools/src/tip/JavaScriptTools/Scripts/slace.core.eventManager.js">http://bitbucket.org/slace/javascript-tools/src/tip/JavaScriptTools/Scripts/slace.core.eventManager.js</a></a></p>

                        </article>
                    </div>
                    <div class="8u skel-cell-mainContent">
                        <article class="is-post">
                            <div id="disqus_thread"></div>
<script>
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
window.disqus_shortname = 'aaronpowell'; // required: replace example with your forum shortname
window.disqus_identifier = document.title || 'Home';
window.disqus_developer = !! ~document.location.href.indexOf("localhost") ? 1 : 0;
window.disqus_url = document.location.origin + '/javascript-eventmanager';

/* * * DON'T EDIT BELOW THIS LINE * * */
(function () {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by</a>
<span class="logo-disqus"> Disqus</span>

                        </article>
                    </div>
                </div>
            </div>
        </div>

        <div id="footer-wrapper">

    <!-- Copyright -->
        <div id="copyright" class="container">
            <ul class="links">
                <li>&copy; Aaron Powell. All rights reserved</li>
                <li>Design: <a href="http://html5up.net/">HTML5 UP</a></li>
            </ul>
        </div>

</div>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-6399564-1']);
  _gaq.push(['_trackPageview']);

  (function () {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
  })();

</script>

    </body>
</html>