<!DOCTYPE HTML>
<!--
    Strongly Typed 1.0 by HTML5 UP
    html5up.net | @n33co
    Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
    <head>
  <meta charset="utf-8">
  <title>Implementing the marquee tag using jQuery - LINQ to Fail</title>
  <meta name="author" content="Aaron Powell">
  <meta name="viewport" content="width=1040" />
  <link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600|Arvo:700" rel="stylesheet" type="text/css" />
  <link href="/css/highlightjs/solarized_light.css" rel="stylesheet" type="text/css" />
  <script src="/js/jquery-1.9.1.min.js"></script>
  <script src="/js/jquery.dropotron-1.3.js"></script>
  <script src="/js/config.js"></script>
  <script src="/js/skel.min.js"></script>
  <script src="/js/skel-ui.min.js"></script>
  <noscript>
    <link rel="stylesheet" href="/css/skel-noscript.css" />
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/style-desktop.css" />
  </noscript>
  <!--[if lte IE 8]><script src="/js/html5shiv.js"></script><![endif]-->

</head>

    <body class="left-sidebar">

        <div id="header-wrapper">
            <div id="header" class="container">
                <h1 id="logo">Implementing the marquee tag using jQuery</h1>
                <h2>9th February 2011</h2>
                <ul class="tags">
    
        
            <li><a class="icon icon-tag" href="/tagged/jquery.html"><span>jquery</span></a></li>
        
            <li><a class="icon icon-tag" href="/tagged/doing-it-wrong.html"><span>doing-it-wrong</span></a></li>
        
            <li><a class="icon icon-tag" href="/tagged/web.html"><span>web</span></a></li>
        
            <li><a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a></li>
        
    
</ul>
                <!-- Nav -->
<nav id="nav">
    <ul>
        <li><a class="icon icon-home" href="/"><span>Home</span></a></li>
        <li><a class="icon icon-github" href="https://github.com/aaronpowell"><span>aaronpowell</span></a></li>
        <li><a class="icon icon-twitter" href="http://twitter.com/slace"><span>@slace</span></a></li>
        <li><a class="icon icon-book" href="/about"><span>About Me</span></a></li>
        <li><a class="icon icon-rss" href="/feed"><span>Feed</span></a></li>
    </ul>
</nav>

            </div>
        </div>

        <div id="main-wrapper">
            <div id="main" class="container">
                <div class="row">
                    <div id="sidebar" class="4u">
    <section>
        <ul class="divided">
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">6th September 2013</span>
                            <h3><a href="/posts/2013-09-06-linq-in-javascript-es6.html">LINQ in JavaScript, ES6 style</a></h3>
                        </header>
                        <p>It&#39;s been a few years since I last blogged about the concept of LINQ in JavaScript as a lot has changed in the JavaScript landscape.</p>
<p>So let&#39;s revisit the idea of it with a look at how you could leverage LINQ in JavaScript for ES6.</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/linq.html"><span>linq</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/es6.html"><span>es6</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">22nd July 2013</span>
                            <h3><a href="/posts/2013-07-22-array-like-objects.html">Array-like objects</a></h3>
                        </header>
                        <p>Just because it looks like a duck, walks like a duck, quacks like a duck doesn&#39;t mean it&#39;s a duck. There&#39;s dangers with making assumptions of your JavaScript objects based on their surface area.</p>
<p>That said, a lot of power can be gleamed by these seemingly innocent assumptions.</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">14th July 2013</span>
                            <h3><a href="/posts/2013-07-14-javascript-new-operator.html">The JavaScript new operator</a></h3>
                        </header>
                        <p>Time to revisit something that was overlooked in the last post, the <code>new</code> operator in JavaScript and what it does.</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">10th July 2013</span>
                            <h3><a href="/posts/2013-07-10-implementing-indexers-in-javascript.html">Implementing "indexers" in JavaScript</a></h3>
                        </header>
                        <p>My colleague Luke Drumm challenged me to implement C# style indexers in JavaScript.</p>
<p>So let&#39;s have a look at how you can do that, and how you can make some very interesting JavaScript objects that are self replicating. We&#39;ll build on the knowledge of using <code>bind</code> and <code>apply</code> from the last two posts.</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">5th July 2013</span>
                            <h3><a href="/posts/2013-07-05-javascript-binding-currying-and-arrows.html">JavaScript bind, currying and arrow functions</a></h3>
                        </header>
                        <p>After confusing my colleagues with how to invoke functions with a modifided set of arguments at a single time the next evolutionary point was to confuse them with creating functions that are always called with a different state.</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                        </div>
                    </article>
                </li>
            
        </ul>
    </section>
</div>

                    <div id="content" class="8u skel-cell-mainContent">
                        <article class="is-post">
                            <p>It&#39;s time for another foray into the good old days of HTML, and we&#39;re going to look at how to build the <a href="http://en.wikipedia.org/wiki/Marquee_element"><code>&lt;marquee&gt;</code> tag</a>, which has also gone for quite some time.</p>
<p>Again we&#39;re going to use <a href="http://jquery.com">jQuery</a> to help us out, so let&#39;s see what we&#39;re building:</p>
<pre class="highlighted"><code class="lisp"><span class="list">(<span class="title">function</span><span class="body"><span class="list">(<span class="body">$)</span></span> {
    $.fn.textWidth = function<span class="list">(<span class="body">)</span></span>{
         var calc = '&lt;span style=<span class="string">"display:none"</span>&gt;' + $<span class="list">(<span class="title">this</span><span class="body">)</span></span>.text<span class="list">(<span class="body">)</span></span> + '&lt;/span&gt;'<span class="comment">;</span>
         $<span class="list">(<span class="body">'body')</span></span>.append<span class="list">(<span class="title">calc</span><span class="body">)</span></span><span class="comment">;</span>
         var width = $<span class="list">(<span class="body">'body')</span></span>.find<span class="list">(<span class="body">'span<span class="keyword">:last</span>')</span></span>.width<span class="list">(<span class="body">)</span></span><span class="comment">;</span>
         $<span class="list">(<span class="body">'body')</span></span>.find<span class="list">(<span class="body">'span<span class="keyword">:last</span>')</span></span>.remove<span class="list">(<span class="body">)</span></span><span class="comment">;</span>
        return width<span class="comment">;</span>
    }<span class="comment">;</span>

    $.fn.marquee = function<span class="list">(<span class="body">)</span></span> {
        var that = $<span class="list">(<span class="title">this</span><span class="body">)</span></span>,
            textWidth = that.textWidth<span class="list">(<span class="body">)</span></span>,
            offset = that.width<span class="list">(<span class="body">)</span></span>,
            width = offset,
            css = {
                'text-indent' : that.css<span class="list">(<span class="body">'text-indent')</span></span>,
                'overflow' : that.css<span class="list">(<span class="body">'overflow')</span></span>,
                'white-space' : that.css<span class="list">(<span class="body">'white-space')</span></span>
            },
            marqueeCss = {
                'text-indent' : width,
                'overflow' : 'hidden',
                'white-space' : 'nowrap'
            }<span class="comment">;</span>

        function go<span class="list">(<span class="body">)</span></span> {
            if<span class="list">(<span class="title">width</span><span class="body"> == <span class="list">(<span class="title">textWidth*-1</span><span class="body">)</span></span>)</span></span> {
                width = offset<span class="comment">;</span>
            }
            that.css<span class="list">(<span class="body">'text-indent', width + 'px')</span></span><span class="comment">;</span>
            width--<span class="comment">;</span>
            setTimeout<span class="list">(<span class="title">go</span><span class="body">, <span class="number">1e1</span>)</span></span><span class="comment">;</span>
        }<span class="comment">;</span>
        that.css<span class="list">(<span class="title">marqueeCss</span><span class="body">)</span></span><span class="comment">;</span>
        width--<span class="comment">;</span>
        go<span class="list">(<span class="body">)</span></span><span class="comment">;</span>
    }<span class="comment">;</span>
})</span></span><span class="list">(<span class="title">jQuery</span><span class="body">)</span></span><span class="comment">;</span></code></pre>
<p>We then use it like this:</p>
<pre class="highlighted"><code class="ruby"><span class="variable">$(</span><span class="string">'h1'</span>).marquee();</code></pre>
<p>As you can probably see this is a bit more involved than when we <a href="http://www.aaron-powell.com/doing-it-wrong/blink">implemented the <code>&lt;blink&gt;</code> tag</a>.</p>
<h1>Breaking it down</h1>
<p>From what you can see here we&#39;ve actually got 2 plugins that I&#39;m creating, the first one is going called <code>textWidth</code>, the other being the actual <code>marquee</code>.</p>
<p><em>Note: I&#39;ve actually used some code I found on the web for the <code>textWidth</code> plugin, which you can find <a href="http://stackoverflow.com/questions/1582534/calculating-text-width-with-jquery/3925757#3925757">here</a>.</em></p>
<h2>Text Width</h2>
<p>The first issue we have to overcome is working out just how wide the piece of text we&#39;re going to be moving is, otherwise we don&#39;t really know what we&#39;re going to be moving.</p>
<p>The piece of code we&#39;re using for it is quite simple, all it does is creates a hidden tag that will contain only the text, and then get the size of that element. It&#39;s not 100% fool-proof, I&#39;m not taking into account padding/ margin/ border on the span tag, but it&#39;ll <em>generally</em> do the job.</p>
<h2>Implementing Marquee</h2>
<p>So now that we&#39;re able to work out the width of the text we can start implementing the full <code>marquee</code> plugin, first thing we need to do is setup a few variables:</p>
<ul>
<li><code>that</code> will be a jQuery instance of the DOM elements we&#39;ve selected</li>
<li><code>textWidth</code> is well, the text width</li>
<li><code>offset</code> is the full width of the element we want</li>
<li><code>css</code> will contain the original values of the elements we&#39;ve about to change for the marquee to work</li>
<li><code>marqueeCss</code> is a set of CSS values we need to change</li>
</ul>
<p>As you can see we are changing some CSS values, what we are setting is:</p>
<ul>
<li><code>text-indent</code>, we need to set this to the full width of the element, this means that the text wont start until it&#39;s off the screen</li>
<li><code>overflow</code>, so the text doesn&#39;t show up when we push the indent out we will set the overflow to hidden</li>
<li><code>white-space</code>, this is an interesting one, there&#39;s probably a better way to do this, but what it does is prevents the content from breaking to a new line when the width isn&#39;t enough for the content to reside within. This combined with the <code>overflow</code> will mean that the content stays on the one line and isn&#39;t shown until we want</li>
</ul>
<p>Again we&#39;re going to use the recursive setTimeout pattern, <a href="http://www.aaron-powell.com/doing-it-wrong/blink">which I talked about here</a>, but before we get started we want to update the CSS for the element and then do our first move, decreasing the width by 1px for when we first call <code>go</code>.</p>
<p>Let&#39;s have another look at the <code>go</code> method:</p>
<pre class="highlighted"><code class="delphi"><span class="function"><span class="keyword">function</span> <span class="title">go</span><span class="params">()</span> <span class="comment">{
    if(width == (textWidth*-1)) {
        width = offset;
    }</span>
    <span class="title">that</span>.<span class="title">css</span><span class="params">(<span class="string">'text-indent'</span>, width + <span class="string">'px'</span>)</span>;</span>
    width--;
    setTimeout(go, <span class="number">1</span>e1);
};</code></pre>
<p>This is why we need the <code>textWidth</code>, as we move once we&#39;ve moved the text off the screen we need to then move it back to the right hand side and it starts all over again.</p>
<p>Woo it&#39;s so pretty.</p>
<h1>Time for sex appeal</h1>
<p>Why don&#39;t we add the ability to set the number of times to scroll, that&#39;s an easy one to add:</p>
<pre class="highlighted"><code class="applescript">$.fn.marquee = function(args) {
    var <span class="keyword">that</span> = $(this),
        textWidth = <span class="keyword">that</span>.textWidth(),
        <span class="command">offset</span> = <span class="keyword">that</span>.width(),
        width = <span class="command">offset</span>,
        css = {
            '<span class="type">text</span>-indent' : <span class="keyword">that</span>.css('<span class="type">text</span>-indent'),
            'overflow' : <span class="keyword">that</span>.css('overflow'),
            'white-<span class="constant">space</span>' : <span class="keyword">that</span>.css('white-<span class="constant">space</span>')
        },
        marqueeCss = {
            '<span class="type">text</span>-indent' : width,
            'overflow' : 'hidden',
            'white-<span class="constant">space</span>' : 'nowrap'
        },
        args = $.extend(<span class="constant">true</span>, { <span class="command">count</span>: -<span class="number">1</span> }, args),
        i = <span class="number">0</span>;

    function go() {
        <span class="keyword">if</span>(width == (textWidth*-<span class="number">1</span>)) {
            i++;
            <span class="keyword">if</span>(i == args.<span class="command">count</span>) {
                <span class="keyword">that</span>.css(css);
<span class="command">                return</span>;
            }
            width = <span class="command">offset</span>;
        }
        <span class="keyword">that</span>.css('<span class="type">text</span>-indent', width + 'px');
        width<span class="comment">--;</span>
        setTimeout(go, <span class="number">1e1</span>);
    };
    <span class="keyword">that</span>.css(marqueeCss);
    width<span class="comment">--;</span>
    go();
};</code></pre>
<p>Really all we&#39;ve done here is allow an argument to be passed in, and each time we hit the left edge we increment the count and check if we&#39;ve done enough passes. When we have we&#39;ll set it back to the original state.</p>
<p>Now you can run this if you want only two passes:</p>
<pre class="highlighted"><code class="smalltalk"><span class="char">$(</span><span class="string">'h1'</span>).marquee({ <span class="method">count:</span> <span class="number">2</span> });</code></pre>
<p>Next up, we&#39;ll add some speed, and that&#39;s just a matter of adding <code>speed</code> to the arguments, and default it to <code>1e1</code> so that we have our standard. I wont bore you with the code (it&#39;ll be visible in the next parts anyway), but with this you can just run:</p>
<pre class="highlighted"><code class="smalltalk"><span class="char">$(</span><span class="string">'h1'</span>).marquee({ <span class="method">speed:</span> <span class="number">5</span> });</code></pre>
<p>Now it goes twice as fast!</p>
<h1>Bringing sexy backwards</h1>
<p>So the next thing that&#39;d be cool, let&#39;s go from left to right, rather than right to left.</p>
<p>First off we&#39;ll add a new argument property, meaning we can do args like this:</p>
<pre class="highlighted"><code class="css"><span class="rules">{ 
    <span class="rule"><span class="attribute">leftToRight</span>:<span class="value"> true 
}</span></span></span></code></pre>
<p>Here&#39;s the updated plugin:</p>
<pre class="highlighted"><code class="applescript">$.fn.marquee = function(args) {
    var <span class="keyword">that</span> = $(this);
    var textWidth = <span class="keyword">that</span>.textWidth(),
        <span class="command">offset</span> = <span class="keyword">that</span>.width(),
        width = <span class="command">offset</span>,
        css = {
            '<span class="type">text</span>-indent' : <span class="keyword">that</span>.css('<span class="type">text</span>-indent'),
            'overflow' : <span class="keyword">that</span>.css('overflow'),
            'white-<span class="constant">space</span>' : <span class="keyword">that</span>.css('white-<span class="constant">space</span>')
        },
        marqueeCss = {
            '<span class="type">text</span>-indent' : width,
            'overflow' : 'hidden',
            'white-<span class="constant">space</span>' : 'nowrap'
        },
        args = $.extend(<span class="constant">true</span>, { <span class="command">count</span>: -<span class="number">1</span>, speed: <span class="number">1e1</span>, leftToRight: <span class="constant">false</span> }, args),
        i = <span class="number">0</span>,
        stop = textWidth*-<span class="number">1</span>;

    function go() {
        <span class="keyword">if</span>(width == stop) {
            i++;
            <span class="keyword">if</span>(i == args.<span class="command">count</span>) {
                <span class="keyword">that</span>.css(css);
<span class="command">                return</span>;
            }
            <span class="keyword">if</span>(args.leftToRight) {
                width = textWidth*-<span class="number">1</span>;
            } <span class="keyword">else</span> {
                width = <span class="command">offset</span>;
            }
        }
        <span class="keyword">that</span>.css('<span class="type">text</span>-indent', width + 'px');
        <span class="keyword">if</span>(args.leftToRight) {
            width++;
        } <span class="keyword">else</span> {
            width<span class="comment">--;</span>
        }
        setTimeout(go, args.speed);
    };
    <span class="keyword">if</span>(args.leftToRight) {
        width = textWidth*-<span class="number">1</span>;
        width++;
        stop = <span class="command">offset</span>;
    } <span class="keyword">else</span> {
        width<span class="comment">--;            </span>
    }
    <span class="keyword">that</span>.css(marqueeCss);
    go();
};</code></pre>
<p>Now what we need to do is change the start position, if we&#39;re going left-to-right we&#39;ll set the initial indent to be the negative width of the text. I&#39;ve also done some refactoring which will have a preset value for the position we need to stop and reset from. By default this will be the negative width of the text when we&#39;re going right to left. When we&#39;re going left to right though we want it to be the full width of the content.</p>
<p>Also the <code>width</code> that we&#39;re tracking either gets increased or decreased, depending what direction we&#39;re going.</p>
<p>So we can go backwards like this:</p>
<pre class="highlighted"><code class="smalltalk"><span class="char">$(</span><span class="string">'h1'</span>).marquee({ <span class="method">leftToRight:</span> <span class="keyword">true</span> });</code></pre>
<p>Weeeeeeeeee!</p>
<h1>Finishing it off with $.Deferred</h1>
<p>We looked at <code>$.Deferred()</code> as part of the <code>&lt;blink&gt;</code> tag implementation, so I wont cover it in great depth here, really all we have to do is quite simply, we create our <code>$.Deferred()</code> at the start of the plugin, return the <code>promise</code> at the end, and run <code>resolve</code> when the count is up.</p>
<p>There&#39;s also a <code>reject</code> call to make sure that we can fail if the selector didn&#39;t work.</p>
<h1>Conclusion</h1>
<p>This brings us to the conclusion of our fun into jQuery again and bringing back a good ol&#39; friend in the form of <code>marquee</code>.</p>
<p>I&#39;ve got a <a href="https://gist.github.com/820404">gist</a> if you want the code and a <a href="http://jsfiddle.net/slace/88YLG/">jsfiddle</a> if you want to play around with it.</p>
<p>Go go gadget 1998 :D.</p>

                        </article>
                    </div>
                    <div class="8u skel-cell-mainContent">
                        <article class="is-post">
                            <div id="disqus_thread"></div>
<script>
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
window.disqus_shortname = 'aaronpowell'; // required: replace example with your forum shortname
window.disqus_identifier = document.title || 'Home';
window.disqus_developer = !! ~document.location.href.indexOf("localhost") ? 1 : 0;
window.disqus_url = document.location.origin + '/doing-it-wrong/marquee';

/* * * DON'T EDIT BELOW THIS LINE * * */
(function () {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by</a>
<span class="logo-disqus"> Disqus</span>

                        </article>
                    </div>
                </div>
            </div>
        </div>

        <div id="footer-wrapper">

    <!-- Copyright -->
        <div id="copyright" class="container">
            <ul class="links">
                <li>&copy; Aaron Powell. All rights reserved</li>
                <li>Design: <a href="http://html5up.net/">HTML5 UP</a></li>
            </ul>
        </div>

</div>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-6399564-1']);
  _gaq.push(['_trackPageview']);

  (function () {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
  })();

</script>

    </body>
</html>