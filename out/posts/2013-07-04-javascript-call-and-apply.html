<!DOCTYPE HTML>
<!--
    Strongly Typed 1.0 by HTML5 UP
    html5up.net | @n33co
    Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
    <head>
  <meta charset="utf-8">
  <title>JavaScript call and apply - LINQ to Fail</title>
  <meta name="author" content="Aaron Powell">
  <meta name="viewport" content="width=1040" />
  <link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600|Arvo:700" rel="stylesheet" type="text/css" />
  <link href="/css/highlightjs/solarized_light.css" rel="stylesheet" type="text/css" />
  <script src="/js/jquery-1.9.1.min.js"></script>
  <script src="/js/jquery.dropotron-1.3.js"></script>
  <script src="/js/config.js"></script>
  <script src="/js/skel.min.js"></script>
  <script src="/js/skel-ui.min.js"></script>
  <noscript>
    <link rel="stylesheet" href="/css/skel-noscript.css" />
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/style-desktop.css" />
  </noscript>
  <!--[if lte IE 8]><script src="/js/html5shiv.js"></script><![endif]-->

</head>

    <body class="left-sidebar">

        <div id="header-wrapper">
            <div id="header" class="container">
                <h1 id="logo">JavaScript call and apply</h1>
                <h2>4th July 2013</h2>
                <ul class="tags">
    
        <li><a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a></li>
    
</ul>
                <!-- Nav -->
<nav id="nav">
    <ul>
        <li><a class="icon icon-home" href="/"><span>Home</span></a></li>
        <li><a class="icon icon-github" href="https://github.com/aaronpowell"><span>aaronpowell</span></a></li>
        <li><a class="icon icon-twitter" href="http://twitter.com/slace"><span>@slace</span></a></li>
        <li><a class="icon icon-book" href="/about"><span>About Me</span></a></li>
        <li><a class="icon icon-rss" href="/feed"><span>Feed</span></a></li>
    </ul>
</nav>

            </div>
        </div>

        <div id="main-wrapper">
            <div id="main" class="container">
                <div class="row">
                    <div id="sidebar" class="4u">
    <section>
        <ul class="divided">
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">21st June 2013</span>
                            <h3><a href="/posts/2013-06-21-walking-a-javascript-object.html">Walking a JavaScript object</a></h3>
                        </header>
                        <p>Ever had a path to a path to a property on a JavaScript object that you want to walk? Something along the lines of <code>foo.bar.baz</code>.</p>
<p>Recently I was trying to solve this problem and came across a nifty little trick</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">22nd January 2013</span>
                            <h3><a href="/posts/2013-01-22-hello-mathy.html">Hello mathy</a></h3>
                        </header>
                        <p>An introduction to another new library from me, this time it&#39;s mathy, a simple formula parser</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/typescript.html"><span>typescript</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/web.html"><span>web</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">14th January 2013</span>
                            <h3><a href="/posts/2013-01-14-ie10-console-thoughts.html">Making the Internet Explorer JavaScript tools better, again</a></h3>
                        </header>
                        <p>A look at what&#39;s changed since I last pointed out the failings of the IE dev tools</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/web.html"><span>web</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/internet-explorer.html"><span>internet-explorer</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/web-dev.html"><span>web-dev</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">7th January 2013</span>
                            <h3><a href="/posts/2013-01-07-thoughts-on-typescript.html">Thoughts on TypeScript</a></h3>
                        </header>
                        <p>Some of my impressions from trying to implement something in TypeScript</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/typescript.html"><span>typescript</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">2nd October 2012</span>
                            <h3><a href="/posts/2012-10-02-pubsub-in-typescript.html">PubSub in TypeScript</a></h3>
                        </header>
                        <p>It&#39;s that time again, time for more Pub/Sub!</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/typescript.html"><span>typescript</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/web.html"><span>web</span></a>
                            
                        </div>
                    </article>
                </li>
            
        </ul>
    </section>
</div>

                    <div id="content" class="8u skel-cell-mainContent">
                        <article class="is-post">
                            <p>A colleague recently came across this line in our codebase that I wrote:</p>
<pre class="highlighted"><code class="avrasm">binding<span class="preprocessor">.vehicle</span><span class="preprocessor">.involvements</span><span class="preprocessor">.push</span><span class="preprocessor">.apply</span>(binding<span class="preprocessor">.vehicle</span><span class="preprocessor">.involvements</span>, vehicle<span class="preprocessor">.involvements</span>)<span class="comment">;</span></code></pre>
<p>What the overall result of the code is isn&#39;t particularly important, the part that tripped them up (and made them think I&#39;m on drugs I&#39;m not actually on) was this:</p>
<pre class="highlighted"><code class="avrasm">binding<span class="preprocessor">.vehicle</span><span class="preprocessor">.involvements</span><span class="preprocessor">.push</span><span class="preprocessor">.apply</span>(binding<span class="preprocessor">.vehicle</span><span class="preprocessor">.involvements</span>, vehicle<span class="preprocessor">.involvements</span>)<span class="comment">;</span></code></pre>
<p>Now the  involvements property is an array in both scenarios which exposes a push method, the confusion was around what the apply method does and why I was even using it.</p>
<p>Both call and apply are methods which are part of the JavaScript language and are exposed on the Function prototype, meaning that they can be accessed from any function, so let&#39;s say we have this function:</p>
<pre class="highlighted"><code class="matlab"><span class="function"><span class="keyword">function</span> <span class="title">foo</span> <span class="params">(a)</span> {</span>
      <span class="transposed_variable">console.</span><span class="built_in">log</span>(this, a, argument);
};</code></pre>
<p>And we invoke it like this:</p>
<pre class="highlighted"><code class="erlang"><span class="function"><span class="title">foo</span><span class="params">('b')</span>;</code></pre>
<p>It is the same as doing this:</p>
<pre class="highlighted"><code class="avrasm">console<span class="preprocessor">.log</span>(window, <span class="string">'b'</span>, [<span class="string">'b'</span>])<span class="comment">;</span></code></pre>
<p><em>Note: In ES3 it&#39;ll be window, ES5 strict mode it&#39;ll be null, or undefined, I forget which</em></p>
<p>Now let&#39;s throw the apply method into the mix and invoke it like so:</p>
<pre class="highlighted"><code class="avrasm">foo<span class="preprocessor">.apply</span>(<span class="string">'a'</span>, [<span class="string">'b'</span>])<span class="comment">;</span></code></pre>
<p>This time it&#39;ll be like we&#39;ve done this:</p>
<pre class="highlighted"><code class="avrasm">console<span class="preprocessor">.log</span>(<span class="string">'a'</span>, <span class="string">'b'</span>, [<span class="string">'b'</span>])<span class="comment">;</span></code></pre>
<p>We could alternatively provide an array of arguments so:</p>
<pre class="highlighted"><code class="avrasm">foo<span class="preprocessor">.apply</span>(<span class="string">'a'</span>, [<span class="string">'b'</span>,<span class="string">'c'</span>])<span class="comment">;</span></code></pre>
<p>Becomes:</p>
<pre class="highlighted"><code class="avrasm">console<span class="preprocessor">.log</span>(<span class="string">'a'</span>, <span class="string">'b'</span>, [<span class="string">'b'</span>, <span class="string">'c'</span>])<span class="comment">;</span></code></pre>
<p>So what happened?</p>
<p>The apply method takes two arguments, the first is what controls the this value, the second is an array of objects that will be decomposed to represent the various arguments passed in, meaning that the array item 0 will be the first argument, b in our example, and so on.</p>
<p>The call method is similar but instead of taking an array that represents the arguments it takes a splat, anything after the this context will be used directly as the arguments. So we&#39;d use call like this to achieve the same result:</p>
<pre class="highlighted"><code class="avrasm">foo<span class="preprocessor">.call</span>(<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>)<span class="comment">;</span></code></pre>
<h2>Relating it to our original code</h2>
<p>Let&#39;s think about how this related back to our original code, working with arrays and push. Say I have an array and I want to add N number of values to said array. How would you do it?</p>
<pre class="highlighted"><code class="cs"><span class="keyword">var</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];
<span class="keyword">var</span> arr2 = [<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>];
<span class="comment">//I want arr == [1,2,3,4,5,6]</span></code></pre>
<p>Well the first obvious candidate is a for loop:</p>
<pre class="highlighted"><code class="matlab"><span class="keyword">for</span> (var <span class="built_in">i</span> = <span class="number">0</span>; <span class="built_in">i</span> &lt; <span class="transposed_variable">arr2.</span><span class="built_in">length</span>; <span class="built_in">i</span>++) <span class="cell">{
      arr.push(arr2[i]);
}</span></code></pre>
<p>That&#39;ll do exactly what we&#39;re after, but there&#39;s a problem, we&#39;re calling push <em>a lot</em>, once for every item in the array in fact(!!). This can be a bit of a performance hit, especially if you have large arrays, the JavaScript runtime engine simply can&#39;t optimise it because it doesn&#39;t know how many there could be so it can&#39;t preallocate the memory, meaning it&#39;s somewhat inefficient.</p>
<p>Alternatively you could use the <code>concat</code> method:</p>
<pre class="highlighted"><code class="ini"><span class="setting">arr = <span class="value">arr.concat(arr2);</span></span></code></pre>
<p>That works just fine but the problem is that you replace arr with a new instance of it. <em>Generally speaking</em> that&#39;s not a problem, but if you&#39;re relying on the object itself to not change, at a memory level (say it&#39;s an observable property from Knockout, or a bound property in WinJS), you&#39;ll potentially run into problems.</p>
<p>So we&#39;re back to push, we want to append multiple items to an existing array without overriding the original object/property. The nice thing about push is that we can provide it N number of arguments which represent all the items we wish to push. Well since I&#39;ve got an array I can&#39;t exactly pass that in directly, since then argument 1 will be the array, it won&#39;t be decomposed. And this is where apply comes in, we can provide the array as the 2nd argument to apply and have N number of items pushed to the array. This brings us to doing this:</p>
<pre class="highlighted"><code class="avrasm">arr<span class="preprocessor">.push</span><span class="preprocessor">.apply</span>(arr, arr2)<span class="comment">;</span></code></pre>
<p>And there we have it, we&#39;ve used apply to decompose an array and push all he values into the target array, basically we&#39;ve done this:</p>
<pre class="highlighted"><code class="avrasm">arr<span class="preprocessor">.push</span>(<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>)<span class="comment">;</span></code></pre>
<p>Since the this context we&#39;ve set is the <code>arr</code> object itself.</p>
<p>Hopefully that does a good enough explanation to confuse everyone ;).</p>

                        </article>
                    </div>
                    <div class="8u skel-cell-mainContent">
                        <article class="is-post">
                            <div id="disqus_thread"></div>
<script>
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
window.disqus_shortname = 'aaronpowell'; // required: replace example with your forum shortname
window.disqus_identifier = document.title || 'Home';
window.disqus_developer = !! ~document.location.href.indexOf("localhost") ? 1 : 0;
window.disqus_url = document.location.origin + '/posts/2013-07-04-javascript-call-and-apply.html';

/* * * DON'T EDIT BELOW THIS LINE * * */
(function () {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by</a>
<span class="logo-disqus"> Disqus</span>

                        </article>
                    </div>
                </div>
            </div>
        </div>

        <div id="footer-wrapper">

    <!-- Copyright -->
        <div id="copyright" class="container">
            <ul class="links">
                <li>&copy; Aaron Powell. All rights reserved</li>
                <li>Design: <a href="http://html5up.net/">HTML5 UP</a></li>
            </ul>
        </div>

</div>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-6399564-1']);
  _gaq.push(['_trackPageview']);

  (function () {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
  })();

</script>

    </body>
</html>