<!DOCTYPE HTML>
<!--
    Strongly Typed 1.0 by HTML5 UP
    html5up.net | @n33co
    Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
    <head>
  <meta charset="utf-8">
  <title>AJAX without jQuery - LINQ to Fail</title>
  <meta name="author" content="Aaron Powell">
  <meta name="viewport" content="width=1040" />
  <link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600|Arvo:700" rel="stylesheet" type="text/css" />
  <link href="/css/highlightjs/solarized_light.css" rel="stylesheet" type="text/css" />
  <script src="/js/jquery-1.9.1.min.js"></script>
  <script src="/js/jquery.dropotron-1.3.js"></script>
  <script src="/js/config.js"></script>
  <script src="/js/skel.min.js"></script>
  <script src="/js/skel-ui.min.js"></script>
  <noscript>
    <link rel="stylesheet" href="/css/skel-noscript.css" />
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/style-desktop.css" />
  </noscript>
  <!--[if lte IE 8]><script src="/js/html5shiv.js"></script><![endif]-->

</head>

    <body class="left-sidebar">

        <div id="header-wrapper">
            <div id="header" class="container">
                <h1 id="logo">AJAX without jQuery</h1>
                <h2>2nd August 2013</h2>
                <ul class="tags">
    
        
            <li><a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a></li>
        
            <li><a class="icon icon-tag" href="/tagged/ajax.html"><span>ajax</span></a></li>
        
            <li><a class="icon icon-tag" href="/tagged/jquery.html"><span>jquery</span></a></li>
        
    
</ul>
                <!-- Nav -->
<nav id="nav">
    <ul>
        <li><a class="icon icon-home" href="/"><span>Home</span></a></li>
        <li><a class="icon icon-github" href="https://github.com/aaronpowell"><span>aaronpowell</span></a></li>
        <li><a class="icon icon-twitter" href="http://twitter.com/slace"><span>@slace</span></a></li>
        <li><a class="icon icon-book" href="/about"><span>About Me</span></a></li>
        <li><a class="icon icon-rss" href="/feed"><span>Feed</span></a></li>
    </ul>
</nav>

            </div>
        </div>

        <div id="main-wrapper">
            <div id="main" class="container">
                <div class="row">
                    <div id="sidebar" class="4u">
    <section>
        <ul class="divided">
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">6th September 2013</span>
                            <h3><a href="/posts/2013-09-06-linq-in-javascript-es6.html">LINQ in JavaScript, ES6 style</a></h3>
                        </header>
                        <p>It&#39;s been a few years since I last blogged about the concept of LINQ in JavaScript as a lot has changed in the JavaScript landscape.</p>
<p>So let&#39;s revisit the idea of it with a look at how you could leverage LINQ in JavaScript for ES6.</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/linq.html"><span>linq</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/es6.html"><span>es6</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">22nd July 2013</span>
                            <h3><a href="/posts/2013-07-22-array-like-objects.html">Array-like objects</a></h3>
                        </header>
                        <p>Just because it looks like a duck, walks like a duck, quacks like a duck doesn&#39;t mean it&#39;s a duck. There&#39;s dangers with making assumptions of your JavaScript objects based on their surface area.</p>
<p>That said, a lot of power can be gleamed by these seemingly innocent assumptions.</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">14th July 2013</span>
                            <h3><a href="/posts/2013-07-14-javascript-new-operator.html">The JavaScript new operator</a></h3>
                        </header>
                        <p>Time to revisit something that was overlooked in the last post, the <code>new</code> operator in JavaScript and what it does.</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">10th July 2013</span>
                            <h3><a href="/posts/2013-07-10-implementing-indexers-in-javascript.html">Implementing "indexers" in JavaScript</a></h3>
                        </header>
                        <p>My colleague Luke Drumm challenged me to implement C# style indexers in JavaScript.</p>
<p>So let&#39;s have a look at how you can do that, and how you can make some very interesting JavaScript objects that are self replicating. We&#39;ll build on the knowledge of using <code>bind</code> and <code>apply</code> from the last two posts.</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">5th July 2013</span>
                            <h3><a href="/posts/2013-07-05-javascript-binding-currying-and-arrows.html">JavaScript bind, currying and arrow functions</a></h3>
                        </header>
                        <p>After confusing my colleagues with how to invoke functions with a modifided set of arguments at a single time the next evolutionary point was to confuse them with creating functions that are always called with a different state.</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                        </div>
                    </article>
                </li>
            
        </ul>
    </section>
</div>

                    <div id="content" class="8u skel-cell-mainContent">
                        <article class="is-post">
                            <p>I&#39;m very much of the opinion that the better you know your tools the better you can make intelligent choices about the layers you put over them. One such layer I see constantly used that people tend to use but not really understand is jQuery. Don&#39;t get me wrong I&#39;m not anti-jQuery or anything, but like I said I believe you should understand your tools before you try and abstract them away.</p>
<p>So today I want to look at a really critical part of jQuery, AJAX.</p>
<p>You&#39;ve probably written something like this:</p>
<pre class="highlighted"><code class="haskell">$.ajax({
    <span class="typedef"><span class="keyword">type</span>: 'get',</span>
    url:<span class="string"> '/foo'</span>,
    success: function (<span class="typedef"><span class="keyword">data</span>) <span class="container">{
        //<span class="title">something</span> <span class="title">with</span> <span class="title">data</span>
    }</span></span>
});</code></pre>
<p>But what&#39;s that doing under the hood?</p>
<h1>Hello XMLHttpRequest</h1>
<p>If you&#39;re doing an AJAX request you&#39;re going to need the <em>X</em> part of that and that&#39;s handled through the <a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest"><code>XMLHttpRequest</code></a> object. This object is the descendant of the <code>ActiveX</code> object which Microsoft added to early Internet Explorer which kick started the AJAX revolution.</p>
<p>So this is the backbone of doing the request and obviously the backbone of what jQuery does under its API, but how do we use it?</p>
<h1>Creating a GET with XMLHttpRequest</h1>
<p>Let&#39;s look back to our example above, how does that work? Well first things first we need to create an instance of the <code>XMLHttpRequest</code>:</p>
<pre class="highlighted"><code class="cs"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</code></pre>
<p>Now we need to open our request telling it what kind method we want to use and where to go:</p>
<pre class="highlighted"><code class="vhdl">xhr.<span class="keyword">open</span>(<span class="attribute">'get</span>', '/foo');</code></pre>
<p><em>Note: There&#39;s a few other arguments which we can pass through, whether you want it to be handled as an async request as well as credentials if you&#39;re doing an authenticated request.</em></p>
<p>Since we&#39;ve opened our request we&#39;re probably going to want to do something when it completes right? To do that we rely on the DOM event standard, using the <code>addEventListener</code> method (you can assign event listeners using the <code>on...</code> style but that&#39;s so IE6). Probably the most important event to be listening for is the <code>load</code> event, this is the one that is executed when a successful response is completed:</p>
<pre class="highlighted"><code class="javascript">xhr.addEventListener(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(e)</span> {</span>
    <span class="comment">//handle success</span>
}, <span class="literal">false</span>);</code></pre>
<p>There are other events you can listen for, <code>progress</code>, <code>error</code> and <code>abort</code> which do pretty much what their names state. The <code>progress</code> event is really useful if you&#39;re expecting a request to take a long time to complete, say you&#39;re uploading a file, or expecting a large response, you can listen for this and inform the user of the status, you know, awesome progress bar style.</p>
<p>But we&#39;re not done yet, our request is still in a <em>holding pattern</em>, the request hasn&#39;t been issued, that doesn&#39;t happen unless we explicitly make it so, we have to explicitly send the request:</p>
<pre class="highlighted"><code class="avrasm">xhr<span class="preprocessor">.send</span>()<span class="comment">;</span></code></pre>
<p>You can see it in action <a href="http://jsbin.com/inikir/1">here</a>.</p>
<h1>Handling responses</h1>
<p>So you&#39;re probably going to want to do something when the response comes in right? And even more logical is to do something with the response data that comes back. Depending what kind of data you&#39;re getting back you have different ways to work with it. Let&#39;s start with the one you&#39;re most like going to want from an AJAX request, JSON.</p>
<p>Well the XMLHttpRequest doesn&#39;t really have the concept of JSON, as far as it is concerned this is just text, so we get at it from the <code>responseText</code> property of <em>either</em> the first argument of the event handler <strong>or</strong> the <code>xhr</code> object itself. With this you would then convert it to a JavaScript object using the JSON API:</p>
<pre class="highlighted"><code class="javascript">xhr.addEventListener(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(e)</span> {</span>
    <span class="keyword">var</span> o = JSON.parse(xhr.responseText); <span class="comment">//or e.responseText</span>
    <span class="comment">//work with our object</span>
}, <span class="literal">false</span>);</code></pre>
<p>What if you are expecting HTML? Say you&#39;re loading a template or doing another kind of partial page load. For this you&#39;re <em>likely</em> to want the <code>responseXML</code> property. Modern browsers support this, which turns your response content into a DOM snippet you can work with. If you&#39;ve got an older browser <a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/Using_XMLHttpRequest#Analyzing_and_manipulating_the_responseXML_property">there are other options available</a>.</p>
<h1>POST-ing data</h1>
<p>We&#39;ve seen how to <code>GET</code> data, but what about if we want to <code>POST</code> data?</p>
<p>Obviously we&#39;d need to change the <code>open</code> call:</p>
<pre class="highlighted"><code class="vhdl">xhr.<span class="keyword">open</span>(<span class="attribute">'POST</span>', '/foo');</code></pre>
<p>But we&#39;re probably going to want to submit some data too right? That&#39;s the whole point of a POST isn&#39;t it? Most likely you&#39;re going to be POST-ing data from a form, and to do that you can use the <a href="https://developer.mozilla.org/en-US/docs/Web/API/FormData">FormData</a> API. In this scenario you need to pass the FormData instance through the <code>send</code> method:</p>
<pre class="highlighted"><code class="haskell"><span class="title">var</span> <span class="typedef"><span class="keyword">data</span> = new <span class="type">FormData</span><span class="container">()</span>;</span>
<span class="typedef"><span class="keyword">data</span>.append<span class="container">('<span class="title">name'</span>, '<span class="type">Aaron</span>')</span>;</span>
<span class="title">xhr</span>.send(<span class="typedef"><span class="keyword">data</span>);</span></code></pre>
<p>This will send up request body with <code>name=Aaron</code> in it, where <code>name</code> is the key of a form value and <code>Aaron</code> is the value. This can be read out of the middleware of whatever HTTP framework you&#39;re working with. ASP.Net this would be the <code>HttpRequest.Form</code> object, Express.js it&#39;ll be <code>request.form</code>.</p>
<p>If you&#39;re not posting FormData but instead want to POST JSON then you&#39;ll need to do make sure your server knows it&#39;s like that, and doing so means setting the headers appropriately. First off you&#39;ll want to set the <code>Content-Type</code> header:</p>
<pre class="highlighted"><code class="vhdl">xhr.setRequestHeader(<span class="attribute">'Content</span>-<span class="keyword">Type</span>', <span class="attribute">'application</span>/json');</code></pre>
<p>This is especially important if you&#39;re using ASP.Net MVC as your end point, it will detect the <code>Content-Type</code> and be able to parse it into your model. Next you&#39;ll want to make sure that you set the <code>Content-Length</code> so your server knows how much data to expect:</p>
<pre class="highlighted"><code class="haskell"><span class="title">xhr</span>.setRequestHeader('<span class="type">Content</span>-<span class="type">Length'</span>, <span class="type">JSON</span>.stringify(<span class="typedef"><span class="keyword">data</span>).length);</span></code></pre>
<p>And finally when you call <code>send</code> you&#39;ll need to send up a JSON string, not the object:</p>
<pre class="highlighted"><code class="haskell"><span class="title">xhr</span>.send(<span class="type">JSON</span>.stringify(<span class="typedef"><span class="keyword">data</span>));</span></code></pre>
<h1>Conclusion</h1>
<p>So there we have it, we&#39;ve seen the building blocks of making an AJAX request, the <code>XMLHttpRequest</code> object. We&#39;ve seen how to make <code>GET</code> and <code>POST</code> requests, pass up data, manipulate headers and get data back in a response.</p>
<p>From these building blocks you can start understanding what is actually happening in your libraries and even avoid them if you don&#39;t want the overhead (say a mobile app).</p>

                        </article>
                    </div>
                    <div class="8u skel-cell-mainContent">
                        <article class="is-post">
                            <div id="disqus_thread"></div>
<script>
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
window.disqus_shortname = 'aaronpowell'; // required: replace example with your forum shortname
window.disqus_identifier = document.title || 'Home';
window.disqus_developer = !! ~document.location.href.indexOf("localhost") ? 1 : 0;
window.disqus_url = document.location.origin + '/posts/2013-08-02-ajax-without-jquery.html';

/* * * DON'T EDIT BELOW THIS LINE * * */
(function () {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by</a>
<span class="logo-disqus"> Disqus</span>

                        </article>
                    </div>
                </div>
            </div>
        </div>

        <div id="footer-wrapper">

    <!-- Copyright -->
        <div id="copyright" class="container">
            <ul class="links">
                <li>&copy; Aaron Powell. All rights reserved</li>
                <li>Design: <a href="http://html5up.net/">HTML5 UP</a></li>
            </ul>
        </div>

</div>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-6399564-1']);
  _gaq.push(['_trackPageview']);

  (function () {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
  })();

</script>

    </body>
</html>