<!DOCTYPE HTML>
<!--
    Strongly Typed 1.0 by HTML5 UP
    html5up.net | @n33co
    Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
    <head>
  <meta charset="utf-8">
  <title>jQuery validation, dynamic forms and a really bad idea - LINQ to Fail</title>
  <meta name="author" content="Aaron Powell">
  <meta name="viewport" content="width=1040" />
  <link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600|Arvo:700" rel="stylesheet" type="text/css" />
  <link href="/css/highlightjs/solarized_light.css" rel="stylesheet" type="text/css" />
  <script src="/js/jquery-1.9.1.min.js"></script>
  <script src="/js/jquery.dropotron-1.3.js"></script>
  <script src="/js/config.js"></script>
  <script src="/js/skel.min.js"></script>
  <script src="/js/skel-ui.min.js"></script>
  <noscript>
    <link rel="stylesheet" href="/css/skel-noscript.css" />
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/style-desktop.css" />
  </noscript>
  <!--[if lte IE 8]><script src="/js/html5shiv.js"></script><![endif]-->

</head>

    <body class="left-sidebar">

        <div id="header-wrapper">
            <div id="header" class="container">
                <h1 id="logo">jQuery validation, dynamic forms and a really bad idea</h1>
                <h2>20th May 2011</h2>
                <ul class="tags">
    
        <li><a class="icon icon-tag" href="/tagged/jquery.html"><span>jquery</span></a></li>
    
        <li><a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a></li>
    
</ul>
                <!-- Nav -->
<nav id="nav">
    <ul>
        <li><a class="icon icon-home" href="/"><span>Home</span></a></li>
        <li><a class="icon icon-github" href="https://github.com/aaronpowell"><span>aaronpowell</span></a></li>
        <li><a class="icon icon-twitter" href="http://twitter.com/slace"><span>@slace</span></a></li>
        <li><a class="icon icon-book" href="/about"><span>About Me</span></a></li>
        <li><a class="icon icon-rss" href="/feed"><span>Feed</span></a></li>
    </ul>
</nav>

            </div>
        </div>

        <div id="main-wrapper">
            <div id="main" class="container">
                <div class="row">
                    <div id="sidebar" class="4u">
    <section>
        <ul class="divided">
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">4th July 2013</span>
                            <h3><a href="/posts/2013-07-04-javascript-call-and-apply.html">JavaScript call and apply</a></h3>
                        </header>
                        <p>After having confused one of my colleagues with some code that used the JavaScript <code>apply</code> method and giving them an answer that didn&#39;t leave them completely bemused I thought I&#39;d share my explanation with the world.</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">21st June 2013</span>
                            <h3><a href="/posts/2013-06-21-walking-a-javascript-object.html">Walking a JavaScript object</a></h3>
                        </header>
                        <p>Ever had a path to a path to a property on a JavaScript object that you want to walk? Something along the lines of <code>foo.bar.baz</code>.</p>
<p>Recently I was trying to solve this problem and came across a nifty little trick</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">7th May 2013</span>
                            <h3><a href="/posts/2013-05-07-firefox-jquery-missing-datatype.html">Firefox, jQuery and the case of the Document response</a></h3>
                        </header>
                        <p>A mystery that resulted in a strange mix of expected responses</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/jquery.html"><span>jquery</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">22nd January 2013</span>
                            <h3><a href="/posts/2013-01-22-hello-mathy.html">Hello mathy</a></h3>
                        </header>
                        <p>An introduction to another new library from me, this time it&#39;s mathy, a simple formula parser</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/typescript.html"><span>typescript</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/web.html"><span>web</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">14th January 2013</span>
                            <h3><a href="/posts/2013-01-14-ie10-console-thoughts.html">Making the Internet Explorer JavaScript tools better, again</a></h3>
                        </header>
                        <p>A look at what&#39;s changed since I last pointed out the failings of the IE dev tools</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/web.html"><span>web</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/internet-explorer.html"><span>internet-explorer</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/web-dev.html"><span>web-dev</span></a>
                            
                        </div>
                    </article>
                </li>
            
        </ul>
    </section>
</div>

                    <div id="content" class="8u skel-cell-mainContent">
                        <article class="is-post">
                            <p>Currently at work I&#39;m part of a team that&#39;s developing a really JavaScript heavy application and in doing so we&#39;re finding problems, challenges and solutions. One such that I was working on recently I thought I&#39;d share with you as it was a majour source of frustration, but ultimately I succeeded in it and that made it all the worth while!</p>
<p>The section of the application I&#39;ve been working on deals with an external data source which manages some systems that the user interacts with. We don&#39;t have <em>any</em> C# code that supports this section of the application, everything is provided by a third party and a JavaScript API which they have provided us with for interaction. This means that whenever we need display something to the user they are providing us with the data. Generally speaking this is fairly straight forward, they are providing lists of data, messages, etc, but there&#39;s one step that is quite tricky, and that is developing a form.</p>
<p>So to set up the scenario what we are running through a multi-part form. On the first step of the form we give the user an option of what they want to add and then on the second step we display a form with a number of fields. The thing is that these fields are defined <strong>by the option chosen on step 1</strong>, meaning that we have to generate the form <em>on the fly</em>. Breaking it down what we&#39;re getting back from the external API is a JSON object which represents a form schema. It dictates the fields we&#39;re including, the order they appear in and the types of inputs. To then throw another spanner in the works the fields all need to be validated. Each field is mandatory and we have some special fields such as date fields.</p>
<p>Essentially I have to take this:</p>
<pre class="highlighted"><code class="css"><span class="rules">{
    <span class="rule"><span class="attribute">fields</span>:<span class="value"> [{
        type: <span class="string">'text'</span>,
        label: <span class="string">'First Name'</span>
    }</span></span></span>, <span class="rules">{
        <span class="rule"><span class="attribute">type</span>:<span class="value"> <span class="string">'text'</span>,
        label: <span class="string">'Last Name'</span>
    }</span></span></span>, <span class="rules">{
        <span class="rule"><span class="attribute">type</span>:<span class="value"> <span class="string">'date'</span>,
        label: <span class="string">'DOB'</span>
    }</span></span></span>]
}</code></pre>
<p>And turn it into the following:</p>
<pre class="highlighted"><code class="xml"><span class="tag">&lt;<span class="title">form</span>&gt;</span>
    <span class="tag">&lt;<span class="title">fieldset</span>&gt;</span>
        <span class="tag">&lt;<span class="title">ol</span>&gt;</span>
            <span class="tag">&lt;<span class="title">li</span>&gt;</span>
                <span class="tag">&lt;<span class="title">label</span> <span class="attribute">for</span>=<span class="value">"field-0"</span>&gt;</span>First Name<span class="tag">&lt;/<span class="title">label</span>&gt;</span>
                <span class="tag">&lt;<span class="title">input</span> <span class="attribute">id</span>=<span class="value">"field-0"</span> <span class="attribute">name</span>=<span class="value">"field-0"</span> <span class="attribute">type</span>=<span class="value">"text"</span> /&gt;</span>
            <span class="tag">&lt;/<span class="title">li</span>&gt;</span>
            <span class="tag">&lt;<span class="title">li</span>&gt;</span>
                <span class="tag">&lt;<span class="title">label</span> <span class="attribute">for</span>=<span class="value">"field-1"</span>&gt;</span>Last Name<span class="tag">&lt;/<span class="title">label</span>&gt;</span>
                <span class="tag">&lt;<span class="title">input</span> <span class="attribute">id</span>=<span class="value">"field-1"</span> <span class="attribute">name</span>=<span class="value">"field-1"</span> <span class="attribute">type</span>=<span class="value">"text"</span> /&gt;</span>
            <span class="tag">&lt;/<span class="title">li</span>&gt;</span>
            <span class="tag">&lt;<span class="title">li</span>&gt;</span>
                <span class="tag">&lt;<span class="title">label</span> <span class="attribute">for</span>=<span class="value">"field-2"</span>&gt;</span>DOB<span class="tag">&lt;/<span class="title">label</span>&gt;</span>
                <span class="tag">&lt;<span class="title">input</span> <span class="attribute">id</span>=<span class="value">"field-2"</span> <span class="attribute">name</span>=<span class="value">"field-2"</span> <span class="attribute">type</span>=<span class="value">"date"</span> /&gt;</span>
            <span class="tag">&lt;/<span class="title">li</span>&gt;</span>
        <span class="tag">&lt;/<span class="title">ol</span>&gt;</span>
    <span class="tag">&lt;/<span class="title">fieldset</span>&gt;</span>
    <span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">"submit"</span>&gt;</span>Submit<span class="tag">&lt;/<span class="title">button</span>&gt;</span>
<span class="tag">&lt;/<span class="title">form</span>&gt;</span></code></pre>
<p>Now let&#39;s have a look at how you generate a form from a JSON schema, display it to the user and ultimately configure some validation.</p>
<p>Oh, and to cap it all off we don&#39;t actually have a .NET method which we&#39;re posting the form to, there&#39;s no ASMX, no Controller Action, no PostBack. Instead we&#39;re submitting the form back into a JavaScipt API call which our external service is providing to us!</p>
<h1>Getting started</h1>
<p>When getting started with these we already had a lot of design patterns in place and JavaScript libraries to play with. For the purpose of this blog post I&#39;m going to look at the tools which are relivent to what I&#39;m doing and which will (hopefully) save you some time if/ when you have to do something similar.</p>
<p>These tools are:</p>
<ul>
<li><a href="http://jquery.com">jQuery</a> (duh!)</li>
<li><a href="http://docs.jquery.com/Plugins/validation">jQuery Validate</a></li>
<li><a href="http://api.jquery.com/jquery.tmpl/">jQuery Templating</a></li>
</ul>
<h1>Building your form</h1>
<p>So I&#39;m going to be building out my form based on a JSON schema, but I want to do it in such a way as that I don&#39;t have any &quot;magic strings&quot; which are responsible for DOM element creation. I&#39;m trying really hard to keep a good clean separation between the HTML and the JavaScript so littering my parser with HTML snippets kind of throws off my concept a bit.</p>
<p>Instead though I&#39;ve decided to take a different route, I&#39;m going to use the fantastic jQuery template enging to create the form fields to begin with. If you&#39;re not familiar with the jQuery Templating enging then I suggest reading their docs before going much further and getting confused.</p>
<p>Now my schema will only support a sub-set of form fields, so I don&#39;t need to worry about having a solution for every different scneario, instead I&#39;m catering for the following:</p>
<ul>
<li>Regular text fields</li>
<li>Password fields</li>
<li>Date fields</li>
<li>Checkbox fields</li>
</ul>
<p>So for this I&#39;m going to create separate templates for each of the form field types that are supported:</p>
<pre class="highlighted"><code class="xml"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/x-jquery-tmpl"</span> <span class="attribute">id</span>=<span class="value">"text-template"</span>&gt;</span><span class="javascript">
    &lt;li&gt;
        <span class="xml"><span class="tag">&lt;<span class="title">label</span> <span class="attribute">for</span>=<span class="value">"field-${index}"</span>&gt;</span>${label}<span class="tag">&lt;/<span class="title">label</span>&gt;</span>
        <span class="tag">&lt;<span class="title">input</span> <span class="attribute">id</span>=<span class="value">"field-${index}"</span> <span class="attribute">name</span>=<span class="value">"field-${index}"</span> <span class="attribute">type</span>=<span class="value">"text"</span> /&gt;</span>
    <span class="tag">&lt;/<span class="title">li</span>&gt;</span>
</span></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>

<span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/x-jquery-tmpl"</span> <span class="attribute">id</span>=<span class="value">"text-template"</span>&gt;</span><span class="javascript">
    &lt;li&gt;
        <span class="xml"><span class="tag">&lt;<span class="title">label</span> <span class="attribute">for</span>=<span class="value">"field-${index}"</span>&gt;</span>${label}<span class="tag">&lt;/<span class="title">label</span>&gt;</span>
        <span class="tag">&lt;<span class="title">input</span> <span class="attribute">id</span>=<span class="value">"field-${index}"</span> <span class="attribute">name</span>=<span class="value">"field-${index}"</span> <span class="attribute">type</span>=<span class="value">"password"</span> /&gt;</span>
    <span class="tag">&lt;/<span class="title">li</span>&gt;</span>
</span></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></code></pre>
<p>(And so on, I wont put out all the templates here, it&#39;ll get a bit repetative)</p>
<p>You could go about this a slightly different way and put conditional statements in your template. Personally I&#39;m against that for a few reasons:</p>
<ol>
<li>You end up with larger and potentially more complex templates</li>
<li>Template parsing has an overhead. The more logic you put into a template the more slower it&#39;ll become to parse as the regexs have to work that bit harder</li>
<li>You&#39;re loosing your separation of concerns but bringing JavaScript into your templating engine</li>
</ol>
<p>Since we&#39;re only templating our form fields we&#39;ve got t ohave a starting HTML snippet that we&#39;ll be appending to:</p>
<pre class="highlighted"><code class="xml"><span class="tag">&lt;<span class="title">form</span>&gt;</span>
    <span class="tag">&lt;<span class="title">fieldset</span>&gt;</span><span class="tag">&lt;/<span class="title">fieldset</span>&gt;</span>
    <span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">"submit"</span>&gt;</span>Submit<span class="tag">&lt;/<span class="title">button</span>&gt;</span>
<span class="tag">&lt;/<span class="title">form</span>&gt;</span></code></pre>
<h1>Parsing our schema</h1>
<p>So now we know how we&#39;re going to go about building our HTML we now have to parse our schema. It&#39;s a fairly simple concept, we need to:</p>
<ul>
<li>Itterate through each field in the response</li>
<li>Determine the type</li>
<li>Parse the template with the field info</li>
</ul>
<p>Let&#39;s assume that we&#39;ve made it to the wizard step that we&#39;ve called out to our external service to provide the JSON schema, now we&#39;ve got to deal with it.</p>
<pre class="highlighted"><code class="lisp"><span class="list">(<span class="title">function</span><span class="body"><span class="list">(<span class="body">$)</span></span> {
    $<span class="list">(<span class="title">function</span><span class="body"><span class="list">(<span class="body">)</span></span> {
        //call out to our external API
        external.getForm<span class="list">(<span class="body">'form-identifier', function<span class="list">(<span class="title">result</span><span class="body">)</span></span> {
            //this callback will handle the parsing
            buildForm<span class="list">(<span class="body">$<span class="list">(<span class="body">'form')</span></span>, result.fields)</span></span><span class="comment">;</span>
        })</span></span><span class="comment">;</span>
    })</span></span><span class="comment">;</span>
})</span></span><span class="list">(<span class="title">jQuery</span><span class="body">)</span></span><span class="comment">;</span></code></pre>
<p>This is a fairly simple little code snippet, we&#39;re expecting to call our external API which will in turn send us our JSON schema. Now let&#39;s implement the <code>buildForm</code> method.</p>
<pre class="highlighted"><code class="haskell"><span class="title">function</span> buildForm(form, fields) {
    var fieldset = form.find('fieldset'),
        ol = $('&lt;ol&gt;&lt;/ol&gt;'),
        templates = {
            text: $('text-template'),
            date: $('date-template') //and so on for more templates
        };

    for(var i=<span class="number">0</span>, il = fields.length; i &lt; il; i++) {
        var field = fields[i],
            field.index = i, //so we've got a unique <span class="type">ID</span> for the field
            html = {};

        switch(field.<span class="typedef"><span class="keyword">type</span>) <span class="container">{
            <span class="title">case</span> '<span class="title">text'</span>:
                <span class="title">html</span> = <span class="title">templates</span>.<span class="title">text</span>
                        .<span class="title">tmpl</span>(<span class="title">field</span>)
                        .<span class="title">appendTo</span>(<span class="title">ol</span>);
                <span class="title">break</span>;

            <span class="title">case</span> '<span class="title">date'</span>:
                <span class="title">html</span> = <span class="title">templates</span>.<span class="title">date</span>
                        .<span class="title">tmpl</span>(<span class="title">field</span>)
                        .<span class="title">appendTo</span>(<span class="title">ol</span>);
                <span class="title">break</span>;

            <span class="title">default</span>:
                <span class="title">throw</span> <span class="title">new</span> <span class="type">Error</span>('<span class="type">The</span> <span class="title">field</span> <span class="title">type</span> "' + <span class="title">field</span>.<span class="title">type</span> + '" <span class="title">is</span> <span class="title">not</span> <span class="title">supported</span>.\<span class="title">r</span>\<span class="title">n</span>" + <span class="type">JSON</span>.<span class="title">stringify</span>(<span class="title">field</span>);
        }</span></span>
    }
    ol.appendTo(fieldset);
}</code></pre>
<p>Now this is really simple code, we&#39;re defining some variables up front which will be needed, and also some pointers to our templates (because caching jQuery selectors is a very good idea people!). Next we go through each item in the fields collection, find the right template and then apply the field to it.</p>
<p><strong>Pro tip - templates aren&#39;t just for dealing with collections, you can apply a single JavaScript object to it.</strong></p>
<p>Once we&#39;ve build up a full form it wil then be added to the DOM, this is just for athetics, rather than appending each one to the DOM as you loop through it does it in a single go. This means you can have some fun animations if you want to make the form appear, rather than a staggered approach if you were adding to the DOM as you go.</p>
<p>Essentially we are done, the JSON schema has been parsed and we&#39;ve now got a form which the users will see and be able to work with. It&#39;s also surprisingly easy to do.</p>
<h1>Adding validation</h1>
<p>As I mentioned in the introduction to the article the fields need to be validated as well. Depending on how you&#39;re getting your JSON schema you may receive the validation down the pipe as part of the schema, but in this example I&#39;m going to have all fields validated.</p>
<p>One thing to note, I&#39;m assuming that this code is in run in an ASP.NET MVC3 application, so I&#39;ve got the unobtrusive jQuery validation also included which has an interesting side effect, it parses all forms and tries to set up the validation rules. But sadly we don&#39;t have the form built so the validation rules can&#39;t get created!</p>
<p>Because we&#39;ve got unobtrusive validation included and it&#39;s already parsed our form it poses a bit of a problem, when you pass your rules into the <code>validate</code> method it wont do anything. When the plugin runs it adds a data attribute to the form which contains all the rules (<code>$(&#39;form&#39;).data(&#39;validator&#39;)</code> is where it is). This is problematic, we can&#39;t <strong>revalidate</strong> the form if we put unobtrusive rules on it.</p>
<h2>Building validation rules</h2>
<p>Although we may not be able to go with the unobtrusive validation it&#39;s not a <em>big</em> issue IMO, we&#39;re already being unobtrusive by running out JavaScript to build the form in a separate file (you <em>are</em> doing that right...), so we can just build up the rules as we&#39;re parsing our schema:</p>
<pre class="highlighted"><code class="haskell"><span class="title">function</span> buildForm(form, fields) {
    var fieldset = form.find('fieldset'),
        ol = $('&lt;ol&gt;&lt;/ol&gt;'),
        templates = {
            text: $('text-template'),
            date: $('date-template') //and so on for more templates
        },
        rules = {},
        messages = {};

    for(var i=<span class="number">0</span>, il = fields.length; i &lt; il; i++) {
        var field = fields[i],
            field.index = i,
            html = {},
            id =<span class="string"> 'field-'</span> + i;

        rules[id] = {
            required: true; //setup the rule for this field, we're just putting required <span class="keyword">as</span> true
        };
        messages[id] = {
            required:<span class="string"> 'The field is required'</span> //create a message for when the field is invalid
        };

        switch(field.<span class="typedef"><span class="keyword">type</span>) <span class="container">{
            <span class="title">case</span> '<span class="title">text'</span>:
                <span class="title">html</span> = <span class="title">templates</span>.<span class="title">text</span>
                        .<span class="title">tmpl</span>(<span class="title">field</span>)
                        .<span class="title">appendTo</span>(<span class="title">ol</span>);
                <span class="title">break</span>;

            <span class="title">case</span> '<span class="title">date'</span>:
                <span class="title">html</span> = <span class="title">templates</span>.<span class="title">date</span>
                        .<span class="title">tmpl</span>(<span class="title">field</span>)
                        .<span class="title">appendTo</span>(<span class="title">ol</span>);

                <span class="title">rules</span>[<span class="title">id</span>].<span class="title">date</span> = <span class="title">true</span>;
                <span class="title">messages</span>[<span class="title">id</span>].<span class="title">date</span> = '<span class="type">That</span>\'<span class="title">s</span> <span class="title">not</span> <span class="title">a</span> <span class="title">valid</span> <span class="title">date'</span>;

                <span class="title">break</span>;

            <span class="title">default</span>:
                <span class="title">throw</span> <span class="title">new</span> <span class="type">Error</span>('<span class="type">The</span> <span class="title">field</span> <span class="title">type</span> "' + <span class="title">field</span>.<span class="title">type</span> + '" <span class="title">is</span> <span class="title">not</span> <span class="title">supported</span>.\<span class="title">r</span>\<span class="title">n</span>" + <span class="type">JSON</span>.<span class="title">stringify</span>(<span class="title">field</span>);
        }</span></span>
    }
    ol.appendTo(fieldset);
    //wait, how <span class="keyword">do</span> we add the rules?
}</code></pre>
<p>In the above we&#39;ve added a few new variables, one which will hold our ruleset and one which will hold the messages. Each rule is based off the name (or ID, I forget which) of the form field, so I&#39;ve created a variable in the loop that&#39;s the ID. You could then add this to the <code>field</code> object and have the template parse it rather than having duplicate code (but I&#39;m lazy and it&#39;s not overly exciting so I&#39;ll skip it :P).</p>
<p>Now though we have all our rules made how do we go about adding them? As I mentioned the form has already been parsed thanks to the unobtrusive validation plugin, so when we do this:</p>
<pre class="highlighted"><code class="css"><span class="tag">form</span><span class="class">.validate</span>(<span class="rules">{ <span class="rule"><span class="attribute">rules</span>:<span class="value"> rules, messages: message }</span></span></span>);</code></pre>
<p>Nothing happens...</p>
<p>Well actually something useful happens, when you do call <code>validate</code> it&#39;ll return the validation rules.</p>
<p>Rules which we can modify ;).</p>
<p>That&#39;s right, we don&#39;t <em>need</em> to &quot;parse the form&quot; again, we can just modify the ruleset that&#39;s already there, so we&#39;ll update our code:</p>
<pre class="highlighted"><code class="haskell"><span class="title">function</span> buildForm(form, fields) {
    var fieldset = form.find('fieldset'),
        ol = $('&lt;ol&gt;&lt;/ol&gt;'),
        templates = {
            text: $('text-template'),
            date: $('date-template') //and so on for more templates
        },
        validationRules = form.validate(),
        rules = {},
        messages = {};

    for(var i=<span class="number">0</span>, il = fields.length; i &lt; il; i++) {
        var field = fields[i],
            field.index = i,
            html = {},
            id =<span class="string"> 'field-'</span> + i;

        rules[id] = {
            required: true; //setup the rule for this field, we're just putting required <span class="keyword">as</span> true
        };
        messages[id] = {
            required:<span class="string"> 'The field is required'</span> //create a message for when the field is invalid
        };

        switch(field.<span class="typedef"><span class="keyword">type</span>) <span class="container">{
            <span class="title">case</span> '<span class="title">text'</span>:
                <span class="title">html</span> = <span class="title">templates</span>.<span class="title">text</span>
                        .<span class="title">tmpl</span>(<span class="title">field</span>)
                        .<span class="title">appendTo</span>(<span class="title">ol</span>);
                <span class="title">break</span>;

            <span class="title">case</span> '<span class="title">date'</span>:
                <span class="title">html</span> = <span class="title">templates</span>.<span class="title">date</span>
                        .<span class="title">tmpl</span>(<span class="title">field</span>)
                        .<span class="title">appendTo</span>(<span class="title">ol</span>);

                <span class="title">rules</span>[<span class="title">id</span>].<span class="title">date</span> = <span class="title">true</span>;
                <span class="title">messages</span>[<span class="title">id</span>].<span class="title">date</span> = '<span class="type">That</span>\'<span class="title">s</span> <span class="title">not</span> <span class="title">a</span> <span class="title">valid</span> <span class="title">date'</span>;

                <span class="title">break</span>;

            <span class="title">default</span>:
                <span class="title">throw</span> <span class="title">new</span> <span class="type">Error</span>('<span class="type">The</span> <span class="title">field</span> <span class="title">type</span> "' + <span class="title">field</span>.<span class="title">type</span> + '" <span class="title">is</span> <span class="title">not</span> <span class="title">supported</span>.\<span class="title">r</span>\<span class="title">n</span>" + <span class="type">JSON</span>.<span class="title">stringify</span>(<span class="title">field</span>);
        }</span></span>
    }
    ol.appendTo(fieldset);

    $.extend(validationRules.settings, { rules: rules, messages: messages });
}</code></pre>
<p>Up front we&#39;ve defined another variable which will hold our existing validation information and then at the tail of the method we&#39;re using the <code>$.extend</code> method to add our new rules to the existing rules. Well the be specific we&#39;re passing the <code>validationRules.settings</code> property, as that&#39;s actually where the rules (and messages) reside, not on the root object.</p>
<h2>Alternate way to build up rules</h2>
<p>Part of the jQuery Validate plugin is it adds a <code>rules</code> method onto the jQuery objects, this means you can add rules that way. The problem I&#39;ve found with this though is if the input field isn&#39;t in the DOM you can&#39;t use the <code>rules</code> method since internally it&#39;ll look back up the DOM for the form they are attached to, but there&#39;s no DOM to walk yet so it&#39;ll throw an error.</p>
<h1>Conclusion</h1>
<p>This has been a fairly full-on article, we&#39;ve looked at:</p>
<ul>
<li>How to use jQuery templates to build a HTML snippet</li>
<li>How we can parse a JSON schema for a form</li>
<li>How to extend the existing validation rules to support new rules from the schema</li>
</ul>
<p>Hopefully this has given a bit of an insight into how to do some crazy, way out problems, but also how to do some more real-world scenarios such as updating an existing from with JavaScript and then augmenting the validation rules.</p>

                        </article>
                    </div>
                    <div class="8u skel-cell-mainContent">
                        <article class="is-post">
                            <div id="disqus_thread"></div>
<script>
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
window.disqus_shortname = 'aaronpowell'; // required: replace example with your forum shortname
window.disqus_identifier = document.title || 'Home';
window.disqus_developer = !! ~document.location.href.indexOf("localhost") ? 1 : 0;
window.disqus_url = document.location.origin + '/javascript/jquery-validation-and-dynamic-forms';

/* * * DON'T EDIT BELOW THIS LINE * * */
(function () {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by</a>
<span class="logo-disqus"> Disqus</span>

                        </article>
                    </div>
                </div>
            </div>
        </div>

        <div id="footer-wrapper">

    <!-- Copyright -->
        <div id="copyright" class="container">
            <ul class="links">
                <li>&copy; Aaron Powell. All rights reserved</li>
                <li>Design: <a href="http://html5up.net/">HTML5 UP</a></li>
            </ul>
        </div>

</div>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-6399564-1']);
  _gaq.push(['_trackPageview']);

  (function () {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
  })();

</script>

    </body>
</html>