<!DOCTYPE HTML>
<!--
    Strongly Typed 1.0 by HTML5 UP
    html5up.net | @n33co
    Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
    <head>
  <meta charset="utf-8">
  <title>LINQ in JavaScript - LINQ to Fail</title>
  <meta name="author" content="Aaron Powell">
  <meta name="viewport" content="width=1040" />
  <link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600|Arvo:700" rel="stylesheet" type="text/css" />
  <link href="/css/highlightjs/solarized_light.css" rel="stylesheet" type="text/css" />
  <script src="/js/jquery-1.9.1.min.js"></script>
  <script src="/js/jquery.dropotron-1.3.js"></script>
  <script src="/js/config.js"></script>
  <script src="/js/skel.min.js"></script>
  <script src="/js/skel-ui.min.js"></script>
  <noscript>
    <link rel="stylesheet" href="/css/skel-noscript.css" />
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/style-desktop.css" />
  </noscript>
  <!--[if lte IE 8]><script src="/js/html5shiv.js"></script><![endif]-->

</head>

    <body class="left-sidebar">

        <div id="header-wrapper">
            <div id="header" class="container">
                <h1 id="logo">LINQ in JavaScript</h1>
                <h2>24th April 2010</h2>
                <ul class="tags">
    
        <li><a class="icon icon-tag" href="/tagged/linq.html"><span>linq</span></a></li>
    
        <li><a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a></li>
    
</ul>
                <!-- Nav -->
<nav id="nav">
    <ul>
        <li><a class="icon icon-home" href="/"><span>Home</span></a></li>
        <li><a class="icon icon-github" href="https://github.com/aaronpowell"><span>aaronpowell</span></a></li>
        <li><a class="icon icon-twitter" href="http://twitter.com/slace"><span>@slace</span></a></li>
        <li><a class="icon icon-book" href="/about"><span>About Me</span></a></li>
        <li><a class="icon icon-rss" href="/feed"><span>Feed</span></a></li>
    </ul>
</nav>

            </div>
        </div>

        <div id="main-wrapper">
            <div id="main" class="container">
                <div class="row">
                    <div id="sidebar" class="4u">
    <section>
        <ul class="divided">
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">14th July 2013</span>
                            <h3><a href="/posts/2013-07-14-javascript-new-operator.html">The JavaScript new operator</a></h3>
                        </header>
                        <p>Time to revisit something that was overlooked in the last post, the <code>new</code> operator in JavaScript and what it does.</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">10th July 2013</span>
                            <h3><a href="/posts/2013-07-10-implementing-indexers-in-javascript.html">Implementing "indexers" in JavaScript</a></h3>
                        </header>
                        <p>My colleague Luke Drumm challenged me to implement C# style indexers in JavaScript.</p>
<p>So let&#39;s have a look at how you can do that, and how you can make some very interesting JavaScript objects that are self replicating. We&#39;ll build on the knowledge of using <code>bind</code> and <code>apply</code> from the last two posts.</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">5th July 2013</span>
                            <h3><a href="/posts/2013-07-05-javascript-binding-currying-and-arrows.html">JavaScript bind, currying and arrow functions</a></h3>
                        </header>
                        <p>After confusing my colleagues with how to invoke functions with a modifided set of arguments at a single time the next evolutionary point was to confuse them with creating functions that are always called with a different state.</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">4th July 2013</span>
                            <h3><a href="/posts/2013-07-04-javascript-call-and-apply.html">JavaScript call and apply</a></h3>
                        </header>
                        <p>After having confused one of my colleagues with some code that used the JavaScript <code>apply</code> method and giving them an answer that didn&#39;t leave them completely bemused I thought I&#39;d share my explanation with the world.</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">21st June 2013</span>
                            <h3><a href="/posts/2013-06-21-walking-a-javascript-object.html">Walking a JavaScript object</a></h3>
                        </header>
                        <p>Ever had a path to a path to a property on a JavaScript object that you want to walk? Something along the lines of <code>foo.bar.baz</code>.</p>
<p>Recently I was trying to solve this problem and came across a nifty little trick</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                        </div>
                    </article>
                </li>
            
        </ul>
    </section>
</div>

                    <div id="content" class="8u skel-cell-mainContent">
                        <article class="is-post">
                            <p><em>Let me start by saying that I am aware that there is a <a href="http://jslinq.codeplex.com/">LINQ to JavaScript project on Codeplex</a> but this was done by me are more of an achidemic exercise/ challange.</em></p>
<p>So while I&#39;ve been working on LINQ to Umbraco I&#39;ve also been spending some time doing AJAX-y stuff, and I have been having a lot of fun playing with JavaScript.
And then one day I was thinking about how I would go about manipulating a collection entirely client-side, and realised that loops are ultimately the only way to go about it. Well that&#39;s all well and good, but if you want to do a lot of collection manipulation there&#39;s not a really good way to go about it (or at least, a really good way from a .NET developer point of view :P).</p>
<p>And after all, what is LINQ? LINQ really just is a way in which you can do pesudo-dynamic programming in a static language (as Lambda is heavily derived from dynamic languages). So shouldn&#39;t it be possible to do in a dynamic language?</p>
<p>So I whipped out my copy of Visual Studio and got coding away, and here&#39;s an end-line of code entirely in JavaScript:</p>
<pre class="highlighted"><code class="avrasm">array<span class="preprocessor">.where</span>(function(item) { 
    return item<span class="preprocessor">.property</span> === <span class="string">"something"</span><span class="comment">; </span>
    })
    <span class="preprocessor">.orderBy</span>()
    <span class="preprocessor">.groupBy</span>(function(item) { 
        return item<span class="preprocessor">.value</span><span class="comment">; </span>
    })<span class="comment">;</span></code></pre>
<p>Lovely isn&#39;t it.</p>
<p>But before I get into some of the stuff I do, let me explain why my approach is different to the JSLINQ project on Codeplex.
Now I mean no disrespect to Chris, but there are a few things which I don&#39;t like about his approach, and which kind of go against the LINQ pattern.</p>
<p>First off JSLINQ requires that you create a new object which you pass the array into. I can see some reasons for this, better intellisense, more strict control over collection manipulation (the collection becomes read-only) but I think that the primary reason must be to better support object-notation arrays (you know, [] arrays). When you define an array using object notation it&#39;s not really an array (<code>typeof [] === &quot;object&quot;</code>). This is a problem if you want to LINQify it, you need to pass it to some other type.</p>
<p>The second issue I have with it is the naming. All the methods are named with Pascal Casing, which is the standard in .NET land, but every JavaScript library I&#39;ve ever used (and as is standard) uses Camel Casing for methods. Sure Pascal keeps its relationship to .NET valid, but when trying to appeal the JavaScript developers it&#39;s just a bit foreign.</p>
<p>Lastly I&#39;m a bit bothered by the lack of argument checking. This may be because I&#39;m a very defensive programmer, but I don&#39;t like to allow developers to shoot themselves in the foot. If a parameter should be a function, then the paramter should be checked as a function. If a parameter is required, it should be checked as such.</p>
<p>This is more of a personal preference than a real design flaw though.</p>
<h2>My Approach</h2>
<p>Now that I&#39;ve talked aobut what I don&#39;t like with the JSLINQ project I think it&#39;s only fair to talk about my approach. I&#39;ve gone with a more traditional LINQ approach and added extensions to an existing type, in this case the Array type, via <code>Array.prototype</code>. This means it is closer to the extension-method format of IEnumerable<T> from .NET, you just need to add in a namespace (aka, include the JavaScript file), but does have a problem of allowing the collection to be modified (which does have pros and cons).</p>
<p>I have also kept with standard JavaScript programming and Camel Cased the method names.</p>
<p>The following operators are supported:</p>
<ul>
<li>Where </li>
<li>Order By (inc decending)</li>
<li>First/orDefault </li>
<li>Single/orDefault</li>
<li>Last/orDefault </li>
<li>Select </li>
<li>GroupBy </li>
<li>IndexOf</li>
</ul>
<p>By and large the word under the hood with for loops, taking a method (aka a Lambda function) and using it.
As I said I&#39;m a defensive programmer so there is a lot of type-checking against the arguments and the return types of methods (for example, ensuring the the Where lambda returns a boolean).</p>
<p>GroupBy is my most proud operator, as it turned out to be a bit harder than I had though. But it does return a collection which is also a pesudo-dictionary which can be itterated through.</p>
<p>I would provide the full source code but there seems to be a problem with current Umbraco instance running my blog which wont let me upload media items!</p>
<p>But here&#39;s the Where and GroupBy operators:</p>
<pre class="highlighted"><code class="cs">Array.prototype.<span class="keyword">where</span> = function(fn) {
    <span class="comment"><span class="xmlDocTag">///</span> Filters the array</span>
    <span class="comment"><span class="xmlDocTag">///</span> Filtering function</span>
    <span class="comment"><span class="xmlDocTag">///</span> </span>
    <span class="keyword">if</span> (<span class="keyword">typeof</span> (fn) !== <span class="keyword">typeof</span> (Function)) <span class="keyword">throw</span> Error.argumentType(<span class="string">"fn"</span>, <span class="keyword">typeof</span> (fn), <span class="keyword">typeof</span> (Function), <span class="string">"where takes a function to filter on"</span>);
    <span class="keyword">var</span> coll = <span class="keyword">new</span> Array();
    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.length; i++) {
        <span class="keyword">var</span> ret = fn(<span class="keyword">this</span>[i]);
        <span class="keyword">if</span> (<span class="keyword">typeof</span> (ret) !== <span class="string">"boolean"</span>) <span class="keyword">throw</span> Error.argumentType(<span class="string">"fn"</span>, <span class="keyword">typeof</span> (ret), <span class="keyword">typeof</span> (Boolean), <span class="string">"function provided to where much return bool"</span>);
        <span class="keyword">else</span> <span class="keyword">if</span> (ret) coll.push(<span class="keyword">this</span>[i]);
    }
    <span class="keyword">return</span> coll;
}

Array.prototype.groupBy = function(fn) {
    <span class="comment"><span class="xmlDocTag">///</span> </span>
    <span class="keyword">if</span> (!fn || <span class="keyword">typeof</span> (fn) !== <span class="keyword">typeof</span> (Function)) {
        <span class="keyword">throw</span> Error.argumentType(<span class="string">"fn"</span>, <span class="keyword">typeof</span> (fn), <span class="keyword">typeof</span> (Function), <span class="string">"groupBy takes a function to filter on"</span>);
    }
    <span class="keyword">var</span> ret = <span class="keyword">new</span> Array();
    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.length; i++) {
        <span class="keyword">var</span> key = fn(<span class="keyword">this</span>[i]);
        <span class="keyword">var</span> keyNode = ret.singleOrDefault(function(item) { <span class="keyword">return</span> item.key === key; });

        <span class="keyword">if</span> (!keyNode) {
            ret[ret.length] = { <span class="string">"key"</span>: key, <span class="string">"items"</span>: <span class="keyword">new</span> Array() };
            ret[ret.length - <span class="number">1</span>].items.push(<span class="keyword">this</span>[i]);
        } <span class="keyword">else</span> {
            ret[ret.indexOf(keyNode)].items.push(<span class="keyword">this</span>[i]);
        }
    }

    <span class="keyword">return</span> ret;
}</code></pre>
<h2>The next stage</h2>
<p>I&#39;ve done a few tweaks within LINQ in JavaScript, and I&#39;ve added a couple of new operators, <code>Skip</code>, <code>SkipWhile</code> and <code>Take</code>, all providing the same functionality that their .NET counterparts provide.</p>
<p>Lets have a look at the way some of the code works, we&#39;ll look at the where method:</p>
<pre class="highlighted"><code class="haskell"><span class="type">Array</span>.prototype.<span class="keyword">where</span> = function(fn) {
    <span class="keyword">if</span> (<span class="typedef">typeof <span class="container">(<span class="title">fn</span>)</span> !== typeof <span class="container">(<span class="type">Function</span>)</span>) throw <span class="type">Error</span>.argumentType<span class="container">("<span class="title">fn</span>", <span class="title">typeof</span> (<span class="title">fn</span>)</span>, typeof <span class="container">(<span class="type">Function</span>)</span>, "where takes a function to filter on");</span>
    var coll = new <span class="type">Array</span>();
    for (var i = <span class="number">0</span>; i &lt; this.length; i++) {
        var ret = fn(this[i]);
        <span class="keyword">if</span> (<span class="typedef">typeof <span class="container">(<span class="title">ret</span>)</span> !== "boolean") throw <span class="type">Error</span>.argumentType<span class="container">("<span class="title">fn</span>", <span class="title">typeof</span> (<span class="title">ret</span>)</span>, typeof <span class="container">(<span class="type">Boolean</span>)</span>, "function provided to where much return bool");</span>
        <span class="keyword">else</span> <span class="keyword">if</span> (ret) coll.push(this[i]);
    }
    return coll;
}</code></pre>
<p>First off you&#39;ll notice that I expect a function to be passed into the method, otherwise how would you apply a where?! As you&#39;ll notice I&#39;m doing a lot of type checking as well, the parameter for Where needs to be a function, so I explicitly check it so.</p>
<p>Then it&#39;s really just a simple itterator that is used, and pushing each item into a new collection where the provided function returns a boolean value of true.
Again you&#39;ll notice type checking, this time of the return value of the function. Because JavaScript isn&#39;t compiled, and there is no type checking I have to do it manually (this means that I&#39;m doing a traditional LINQ API, not one where you can return anything you like, ala <a href="http://community.bartdesmet.net/blogs/bart/archive/2008/09/14/who-ever-said-linq-predicates-need-to-be-boolean-valued.aspx">this post</a>). Not a big problem, but it does add a little overhead.</p>
<p>Sure you can remove it but then it kind-of defeats what I&#39;m trying to achieve, which is a very type-safe API.</p>
<p>Ultimately LINQ in JavaScript is nothing more than throught experiment project. It shows that you can quite easily have a client side query language using JavaScript and functional programming.</p>
<p><strong>But I don&#39;t recommend that anyone acutally use it</strong>. If you&#39;re using a client-side query API such as this (or any of the other LINQ implementations for JavaScript) you&#39;re doing it wrong. Particularly operators like where, skip, take and even select. These operators are designed to lower/ change the data volume you are working with, which on the client side is not a good idea. It means that you&#39;ve returned too much data from the server!
I see the only real useful reason for this (other than just wanting to prove it can be done) is to manipulate a DOM structure, say client-side reordering of a table.</p>
<h2>ECMAScript 5</h2>
<p>LINQ in JavaScript supports the new Array methods which are part of ECMAScript 5, you can read more about it in the <a href="/linq-in-javascript/html5">announcement post</a>.</p>
<h2>Source code</h2>
<p>I&#39;ve pushed the <a href="https://hg.slace.biz/linq-in-javascript">source code for the LINQ in JavaScript</a> project up to bitbucket. If you&#39;re interested in having a play with it you can grab it from there.</p>
<h2>NuGet</h2>
<p>I have created a NuGet package for this as well. <a href="http://nuget.org/Packages/Packages/Details/LinqInJavaScript-1-0">You can get it here</a>.</p>

                        </article>
                    </div>
                    <div class="8u skel-cell-mainContent">
                        <article class="is-post">
                            <div id="disqus_thread"></div>
<script>
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
window.disqus_shortname = 'aaronpowell'; // required: replace example with your forum shortname
window.disqus_identifier = document.title || 'Home';
window.disqus_developer = !! ~document.location.href.indexOf("localhost") ? 1 : 0;
window.disqus_url = document.location.origin + '/linq-in-javascript';

/* * * DON'T EDIT BELOW THIS LINE * * */
(function () {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by</a>
<span class="logo-disqus"> Disqus</span>

                        </article>
                    </div>
                </div>
            </div>
        </div>

        <div id="footer-wrapper">

    <!-- Copyright -->
        <div id="copyright" class="container">
            <ul class="links">
                <li>&copy; Aaron Powell. All rights reserved</li>
                <li>Design: <a href="http://html5up.net/">HTML5 UP</a></li>
            </ul>
        </div>

</div>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-6399564-1']);
  _gaq.push(['_trackPageview']);

  (function () {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
  })();

</script>

    </body>
</html>