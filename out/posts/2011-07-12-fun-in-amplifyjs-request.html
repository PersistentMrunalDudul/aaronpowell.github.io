<!DOCTYPE HTML>
<!--
    Strongly Typed 1.0 by HTML5 UP
    html5up.net | @n33co
    Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
    <head>
  <meta charset="utf-8">
  <title>Having fun and digging deep into amplifyjs and the request API - LINQ to Fail</title>
  <meta name="author" content="Aaron Powell">
  <meta name="viewport" content="width=1040" />
  <link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600|Arvo:700" rel="stylesheet" type="text/css" />
  <link href="/css/highlightjs/solarized_light.css" rel="stylesheet" type="text/css" />
  <script src="/js/jquery-1.9.1.min.js"></script>
  <script src="/js/jquery.dropotron-1.3.js"></script>
  <script src="/js/config.js"></script>
  <script src="/js/skel.min.js"></script>
  <script src="/js/skel-ui.min.js"></script>
  <noscript>
    <link rel="stylesheet" href="/css/skel-noscript.css" />
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/style-desktop.css" />
  </noscript>
  <!--[if lte IE 8]><script src="/js/html5shiv.js"></script><![endif]-->

</head>

    <body class="left-sidebar">

        <div id="header-wrapper">
            <div id="header" class="container">
                <h1 id="logo">Having fun and digging deep into amplifyjs and the request API</h1>
                <h2>12th July 2011</h2>
                <ul class="tags">
    
        <li><a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a></li>
    
        <li><a class="icon icon-tag" href="/tagged/amplifyjs.html"><span>amplifyjs</span></a></li>
    
        <li><a class="icon icon-tag" href="/tagged/doing-it-wrong.html"><span>doing-it-wrong</span></a></li>
    
</ul>
                <!-- Nav -->
<nav id="nav">
    <ul>
        <li><a class="icon icon-home" href="/"><span>Home</span></a></li>
        <li><a class="icon icon-github" href="https://github.com/aaronpowell"><span>aaronpowell</span></a></li>
        <li><a class="icon icon-twitter" href="http://twitter.com/slace"><span>@slace</span></a></li>
        <li><a class="icon icon-book" href="/about"><span>About Me</span></a></li>
        <li><a class="icon icon-rss" href="/feed"><span>Feed</span></a></li>
    </ul>
</nav>

            </div>
        </div>

        <div id="main-wrapper">
            <div id="main" class="container">
                <div class="row">
                    <div id="sidebar" class="4u">
    <section>
        <ul class="divided">
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">2nd July 2011</span>
                            <h3><a href="/posts/2011-07-02-postman.html">Introducing Postman - A JavaScript Messaging Library</a></h3>
                        </header>
                        <h1>Prelude</h1>
<p>Back in May I presented at DDD Melbourne on JavaScript design patterns. One of the patterns that I was talking about was the idea of [pub/ sub][1].</p>
<p>Let me start by saying that this isn&#39;...</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/postman.html"><span>postman</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/coffeescript.html"><span>coffeescript</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">21st June 2013</span>
                            <h3><a href="/posts/2013-06-21-walking-a-javascript-object.html">Walking a JavaScript object</a></h3>
                        </header>
                        <p>Ever had a path to a path to a property on a JavaScript object that you want to walk? Something along the lines of <code>foo.bar.baz</code>.</p>
<p>Recently I was trying to solve this problem and came across a nifty little trick</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">14th January 2013</span>
                            <h3><a href="/posts/2013-01-14-ie10-console-thoughts.html">Making the Internet Explorer JavaScript tools better, again</a></h3>
                        </header>
                        <p>A look at what&#39;s changed since I last pointed out the failings of the IE dev tools</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/web.html"><span>web</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/internet-explorer.html"><span>internet-explorer</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/web-dev.html"><span>web-dev</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">7th January 2013</span>
                            <h3><a href="/posts/2013-01-07-thoughts-on-typescript.html">Thoughts on TypeScript</a></h3>
                        </header>
                        <p>Some of my impressions from trying to implement something in TypeScript</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/typescript.html"><span>typescript</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">2nd October 2012</span>
                            <h3><a href="/posts/2012-10-02-pubsub-in-typescript.html">PubSub in TypeScript</a></h3>
                        </header>
                        <p>It&#39;s that time again, time for more Pub/Sub!</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/typescript.html"><span>typescript</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/web.html"><span>web</span></a>
                            
                        </div>
                    </article>
                </li>
            
        </ul>
    </section>
</div>

                    <div id="content" class="8u skel-cell-mainContent">
                        <article class="is-post">
                            <p>Have you played with <a href="http://amplifyjs.com">amplifyjs</a> yet? Played with it&#39;s cool way of handling requests?</p>
<p>I really like the way you can do this:</p>
<pre class="highlighted"><code class="haskell">//<span class="keyword">in</span> our <span class="type">JavaScript</span> bootstrapper
<span class="title">amplify</span>.request.define(<span class="string">"searchTwitter"</span>, <span class="string">"ajax"</span>, {
    url: <span class="string">"http://search.twitter.com/search.json?callback=?"</span>,
    <span class="typedef">dataType: "jsonp",</span>
    cache: <span class="number">30000</span>
});

//<span class="keyword">in</span> some other file
<span class="title">amplify</span>.request('searchTwitter', { q:<span class="string"> 'amplifyjs'</span> }, function (<span class="typedef"><span class="keyword">data</span>) <span class="container">{
    //<span class="title">handle</span> <span class="title">returned</span> <span class="title">data</span>
}</span>);</span></code></pre>
<p>It&#39;s nice and clean a way to setup request pointers which you can then mock out for testing purposes.</p>
<p>But you know, it&#39;s not as clean as I&#39;d really like and if you know me you&#39;ll know that I like to try and do something with an API that you&#39;re <strong>not meant to do</strong>. So while playing with amplify I decided to dive into the code and work at how it was mapping my defined requests to the method call and doing so I found something interesting (and well... fun!):</p>
<pre class="highlighted"><code class="haskell"><span class="title">amplify</span>.request.resources.searchTwitter({
  <span class="typedef"><span class="keyword">data</span>: <span class="container">{ <span class="title">q</span>: '<span class="title">amplifyjs'</span> }</span>,</span>
  success: function(<span class="typedef"><span class="keyword">data</span>) <span class="container">{
    //<span class="title">handle</span> <span class="title">returned</span> <span class="title">data</span>
  }</span></span>
}, {});</code></pre>
<p>Yep that&#39;s right, the <code>request</code> function has a <strong>public</strong> property called <code>resources</code>, which has properties added to it that represent the requests which have been defined.</p>
<p>If you&#39;re using an <code>ajax</code> request (as I defined at the start) you have two arguments to pass in:</p>
<ol>
<li>The settings object, most of which are passed to <a href="http://api.jquery.com/jQuery.ajax/"><code>$.ajax</code></a>. In this case I&#39;m passing in the data object and a success callback, a bit more explicitly obviously</li>
<li>I haven&#39;t quite worked out what the 2nd parameter is for other than passing in an <code>abort</code> handler in (but it does seem to be overridden at the end of the function anyway...)</li>
</ol>
<p>Whether or not the knowledge that you can do this is kind of any use I don&#39;t know, I just think it&#39;s kind of cool :P.</p>
<h3>Some points of note</h3>
<p>The arguments of your method hanging off resources will depend on the <em>type of request</em>. Amplifyjs has <a href="http://amplifyjs.com/api/request/#built-in_types">build in request types</a> and supports custom types, so the arguments may be different, eg:</p>
<pre class="highlighted"><code class="haskell"><span class="title">amplify</span>.request.<span class="typedef">types.foo = function<span class="container">()</span> <span class="container">{
    <span class="title">return</span> <span class="title">function</span>(<span class="title">callback</span>) {
      <span class="title">console</span>.<span class="title">log</span>('<span class="title">aww</span> <span class="title">you</span> <span class="title">want</span> <span class="title">to</span> <span class="title">foo</span>!');
      <span class="title">if</span>(<span class="title">callback</span>) {
        <span class="title">callback</span>.<span class="title">call</span>(<span class="title">this</span>);
      }</span></span>
    };
};

<span class="title">amplify</span>.request.define('bar',<span class="string"> 'foo'</span>, {});

<span class="title">amplify</span>.request.resources.bar(function() { //just a function <span class="keyword">as</span> an argument
    console.log('hey, it works!');
});</code></pre>
<ul>
<li>This isn&#39;t a documented feature so it <strong>works on my machine</strong> and may not work ever again</li>
<li>I offer no warranty on this code</li>
<li>Custom request types must return a function (in fact any request types have to return a function)</li>
<li>It&#39;s your choice as to whether a <code>TypeError</code> is better than the built in error handling</li>
<li>This was really just a thought experiment to push an API to its limit</li>
</ul>
<p>Happy Hacking!</p>

                        </article>
                    </div>
                    <div class="8u skel-cell-mainContent">
                        <article class="is-post">
                            <div id="disqus_thread"></div>
<script>
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
window.disqus_shortname = 'aaronpowell'; // required: replace example with your forum shortname
window.disqus_identifier = document.title || 'Home';
window.disqus_developer = !! ~document.location.href.indexOf("localhost") ? 1 : 0;
window.disqus_url = document.location.origin + '/javascript/fun-in-amplifyjs-request';

/* * * DON'T EDIT BELOW THIS LINE * * */
(function () {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by</a>
<span class="logo-disqus"> Disqus</span>

                        </article>
                    </div>
                </div>
            </div>
        </div>

        <div id="footer-wrapper">

    <!-- Copyright -->
        <div id="copyright" class="container">
            <ul class="links">
                <li>&copy; Aaron Powell. All rights reserved</li>
                <li>Design: <a href="http://html5up.net/">HTML5 UP</a></li>
            </ul>
        </div>

</div>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-6399564-1']);
  _gaq.push(['_trackPageview']);

  (function () {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
  })();

</script>

    </body>
</html>