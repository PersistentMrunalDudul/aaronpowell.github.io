<!DOCTYPE HTML>
<!--
    Strongly Typed 1.0 by HTML5 UP
    html5up.net | @n33co
    Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
    <head>
  <meta charset="utf-8">
  <title>Hello mathy - LINQ to Fail</title>
  <meta name="author" content="Aaron Powell">
  <meta name="viewport" content="width=1040" />
  <link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600|Arvo:700" rel="stylesheet" type="text/css" />
  <link href="/css/highlightjs/solarized_light.css" rel="stylesheet" type="text/css" />
  <script src="/js/jquery-1.9.1.min.js"></script>
  <script src="/js/jquery.dropotron-1.3.js"></script>
  <script src="/js/config.js"></script>
  <script src="/js/skel.min.js"></script>
  <script src="/js/skel-ui.min.js"></script>
  <noscript>
    <link rel="stylesheet" href="/css/skel-noscript.css" />
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/style-desktop.css" />
  </noscript>
  <!--[if lte IE 8]><script src="/js/html5shiv.js"></script><![endif]-->

</head>

    <body class="left-sidebar">

        <div id="header-wrapper">
            <div id="header" class="container">
                <h1 id="logo">Hello mathy</h1>
                <h2>22nd January 2013</h2>
                <ul class="tags">
    
        <li><a class="icon icon-tag" href="/tagged/typescript.html"><span>typescript</span></a></li>
    
        <li><a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a></li>
    
        <li><a class="icon icon-tag" href="/tagged/web.html"><span>web</span></a></li>
    
</ul>
                <!-- Nav -->
<nav id="nav">
    <ul>
        <li><a class="icon icon-home" href="/"><span>Home</span></a></li>
        <li><a class="icon icon-github" href="https://github.com/aaronpowell"><span>aaronpowell</span></a></li>
        <li><a class="icon icon-twitter" href="http://twitter.com/slace"><span>@slace</span></a></li>
        <li><a class="icon icon-book" href="/about"><span>About Me</span></a></li>
        <li><a class="icon icon-rss" href="/feed"><span>Feed</span></a></li>
    </ul>
</nav>

            </div>
        </div>

        <div id="main-wrapper">
            <div id="main" class="container">
                <div class="row">
                    <div id="sidebar" class="4u">
    <section>
        <ul class="divided">
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">9th August 2011</span>
                            <h3><a href="/posts/2011-08-09-a-story.html">JavaScript: A story</a></h3>
                        </header>
                        <p>Everyone use to notice the old war veteran that sat on the corner. His uniform was tatty and he’s always be spouting about his heyday with lines like “Don’t  you remember my role in the first brows...</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/random.html"><span>random</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">19th April 2013</span>
                            <h3><a href="/posts/2013-04-19-ie-useragents.html">Internet Explorer userAgents</a></h3>
                        </header>
                        <p>A new program from the IE team</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/internet-explorer.html"><span>internet-explorer</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/web.html"><span>web</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">7th January 2013</span>
                            <h3><a href="/posts/2013-01-07-thoughts-on-typescript.html">Thoughts on TypeScript</a></h3>
                        </header>
                        <p>Some of my impressions from trying to implement something in TypeScript</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/typescript.html"><span>typescript</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">18th October 2012</span>
                            <h3><a href="/posts/2012-10-18-dbjs-chrome.html">Chrome support for db.js</a></h3>
                        </header>
                        <p>A little word on the db.js support for Chrome</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/indexeddb.html"><span>indexeddb</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/chrome.html"><span>chrome</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/web.html"><span>web</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">8th October 2012</span>
                            <h3><a href="/posts/2012-10-08-reverse-order-unique-indexes.html">Reverse order unique queries in IndexedDB</a></h3>
                        </header>
                        <p>The quirk of reverse index querying in IndexedDB and in turn db.js</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/indexeddb.html"><span>indexeddb</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/web.html"><span>web</span></a>
                            
                        </div>
                    </article>
                </li>
            
        </ul>
    </section>
</div>

                    <div id="content" class="8u skel-cell-mainContent">
                        <article class="is-post">
                            <p>In a previous post I <a href="http://www.aaron-powell.com/javascript/thoughts-on-typescript">laid out some thoughts on TypeScript</a> which came from building a little library in TypeScript called <a href="https://github.com/aaronpowell/mathy.js">mathy</a>.</p>
<h1>Hello mathy</h1>
<p>A few months ago I came to a realisation... I&#39;ve never written a parser, at least not a language parser. Sure I&#39;ve parsed CSVs, sure I&#39;ve parsed XML, but never a language.</p>
<p>Part of what I&#39;ve been working on recently has needed a formula parser to deal with chemical formulas, basically we need to be able to take this:</p>
<pre class="highlighted"><code class="ini"><span class="setting">Y = <span class="value">(Q * <span class="number">0.12</span> + <span class="number">100</span>) / (Q * <span class="number">15</span>)</span></span></code></pre>
<p>Another member of the team wrote a C# parser for this so I decided in my spare time to implement something similar in JavaScript and hence mathy was born.</p>
<p>The usage is something like this:</p>
<pre class="highlighted"><code class="erlang">var engine = new mathy.<span class="variable">Engine</span>(<span class="tuple">{ name: 'a', derivation: '<span class="number">1</span> + <span class="number">2</span>' }</span>);
var result = engine.process();
<span class="function"><span class="title">expect</span><span class="params">(result[<span class="number">0</span>])</span>.<span class="title">to</span>.<span class="title">equal</span><span class="params">(<span class="number">3</span>)</span>;</code></pre>
<p>Pretty simple, create a new engine, provide it some parameters and process it. You can also install mathy as a global Node.js module and get a new command that will do math for you:</p>
<pre class="highlighted"><code class="ruby"><span class="variable">0.9698138511739671gt;</span> npm install -g mathy
<span class="variable">0.9698138511739671gt;</span> mathy <span class="string">"1 + 2"</span> /<span class="regexp">/output's 3</code></pre>
<h1>Smarter than your average shell</h1>
<p>So that example isn&#39;t particularly useful, open up PowerShell (or Terminal) and you can easily just type <code>1 + 2</code> and get a result. Where mathy does get a bit more useful is when you want a more complex formula parsed, something like this:</p>
<pre class="highlighted"><code class="erlang">var engine = new mathy.<span class="variable">Engine</span>(<span class="tuple">{ name: 'a', derivation: '<span class="number">1</span> + <span class="number">2</span> * <span class="number">3</span> - <span class="number">1</span> * <span class="number">10</span> ^ <span class="number">1</span> / <span class="number">5</span>' }</span>);
var result = engine.process();
<span class="function"><span class="title">expect</span><span class="params">(result[<span class="number">0</span>])</span>.<span class="title">to</span>.<span class="title">equal</span><span class="params">(<span class="number">5</span>)</span>;</code></pre>
<p>Here we&#39;re doing a <em>to the power of</em> (using <code>^</code>), you can also do negative powers like this:</p>
<pre class="highlighted"><code class="cs"><span class="keyword">var</span> engine = <span class="keyword">new</span> mathy.Engine({ name: <span class="string">'a'</span>, derivation: <span class="string">'1 + 2 * 3 - 1 * 10 ^ (-1) / 5'</span> });</code></pre>
<p><em>Yes negative powers need to be parenthesis wrapped, that&#39;s pretty standard notation if you look around at how to handle it.</em></p>
<h1>Smarter calculations</h1>
<p>Let&#39;s think back to the example that I said we&#39;re parsing in our application:</p>
<pre class="highlighted"><code class="ini"><span class="setting">Y = <span class="value">(Q * <span class="number">0.12</span> + <span class="number">100</span>) / (Q * <span class="number">15</span>)</span></span></code></pre>
<p>Well <code>Q</code> isn&#39;t exactly a number so that isn&#39;t a mathematical equation yet, but that&#39;s cool, mathy will allow you to provide multiple parameters, like so:</p>
<pre class="highlighted"><code class="smalltalk">var engine = new mathy.<span class="class">Engine</span>(
    { <span class="method">name:</span> <span class="string">'a'</span>, <span class="method">derivation:</span> <span class="string">'(Q * 0.12 + 100) / (Q * 15)'</span>, <span class="method">result:</span> <span class="keyword">true</span> },
    { <span class="method">name:</span> <span class="string">'Q'</span>, <span class="method">derivation:</span> <span class="string">'10'</span> }
);</code></pre>
<p>Now when mathy runs it&#39;ll hit the <code>Q</code> in the formula and then attempt to resolve that. It&#39;ll realise that it&#39;s not a numerical value so it&#39;ll then see if it was another parameter, then it&#39;ll find the value of <code>10</code> and be able to insert that.</p>
<p>Where this is more useful is when you want to late-add a parameter, meaning you can do this:</p>
<pre class="highlighted"><code class="smalltalk">var engine = new mathy.<span class="class">Engine</span>(
    { <span class="method">name:</span> <span class="string">'a'</span>, <span class="method">derivation:</span> <span class="string">'(Q * 0.12 + 100) / (Q * 15)'</span>, <span class="method">result:</span> <span class="keyword">true</span> }
);
engine.add({ <span class="method">name:</span> <span class="string">'Q'</span>, <span class="method">derivation:</span> <span class="string">'10'</span> });</code></pre>
<p>So you can create the engine and then ask the user for the inputs, adding them as they are provided.</p>
<h1>Decisions, decisions</h1>
<p>While it&#39;s all well and good to be able to process parameterised numerical equations where mathy starts to get into its own is where it diverges and becomes a bit more of a standalone language; the main feature for this is decisions.</p>
<p>A decision is a binary condition statement, a tuple, and it&#39;s used like so:</p>
<pre class="highlighted"><code class="cs"><span class="keyword">var</span> engine = <span class="keyword">new</span> mathy.Engine(
    { name: <span class="string">'a'</span>, derivation: <span class="string">'1 &gt; 2 ? -1 : 42'</span> }
);</code></pre>
<p>The statement on the left will be evaluated as a true/false statement (it only supports <a href="http://javascriptweblog.wordpress.com/2011/02/07/truth-equality-and-javascript/">JavaScript strict-equal equality</a>, but you only need to use <code>==</code> not <code>===</code>).</p>
<p>And of course all parts (well, except the operator) can be parameters:</p>
<pre class="highlighted"><code class="css"><span class="tag">new</span> <span class="tag">mathy</span><span class="class">.Engine</span>(
    <span class="rules">{ <span class="rule"><span class="attribute">name</span>:<span class="value"> <span class="string">'a'</span>, derivation: <span class="string">'b == c ? d : e'</span>, result: true }</span></span></span>,
    <span class="rules">{ <span class="rule"><span class="attribute">name</span>:<span class="value"> <span class="string">'b'</span>, derivation: <span class="string">'42'</span> }</span></span></span>,
    <span class="rules">{ <span class="rule"><span class="attribute">name</span>:<span class="value"> <span class="string">'c'</span>, derivation: <span class="string">'d'</span> }</span></span></span>,
    <span class="rules">{ <span class="rule"><span class="attribute">name</span>:<span class="value"> <span class="string">'d'</span>, derivation: <span class="string">'42'</span> }</span></span></span>,
    <span class="rules">{ <span class="rule"><span class="attribute">name</span>:<span class="value"> <span class="string">'e'</span>, derivation: <span class="string">'-1'</span> }</span></span></span>
);</code></pre>
<h1>Real-world usage</h1>
<p>It&#39;s all well and good to make this simple little language/parser for chemical formulas but is there any other real reason you&#39;d do this?</p>
<p>My main thoughts on this would be in a shopping cart scenario. Since <a href="http://minimaxir.com/2012/10/client-side-validation-is-hard-mode/">you shouldn&#39;t trust the client</a> if you&#39;re doing any kind of calculation of the cart you&#39;ll be wanting to do that server side. But what if you want to have some benefits? Say you have a threshold before they get free shipping, or a discount for certain number of purchases, preferred customer, etc.</p>
<p>Often times these can be expressed as a simple formula rather a series of statements in code. Values like &#39;is this customer a preferred customer&#39; can be provided as a parameter value to the formula which then does the calculation.</p>
<h1>Conclusion</h1>
<p>So there we have it, a very simple little JavaScript formula engine called <a href="https://github.com/aaronpowell/mathy.js">mathy</a> which has some nice little features to do slightly smarter formulas.</p>
<p>Check out the tests folder for more complex usage examples.</p>

                        </article>
                    </div>
                    <div class="8u skel-cell-mainContent">
                        <article class="is-post">
                            <div id="disqus_thread"></div>
<script>
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
window.disqus_shortname = 'aaronpowell'; // required: replace example with your forum shortname
window.disqus_identifier = document.title || 'Home';
window.disqus_developer = !! ~document.location.href.indexOf("localhost") ? 1 : 0;
window.disqus_url = document.location.origin + '/hello-mathy';

/* * * DON'T EDIT BELOW THIS LINE * * */
(function () {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by</a>
<span class="logo-disqus"> Disqus</span>

                        </article>
                    </div>
                </div>
            </div>
        </div>

        <div id="footer-wrapper">

    <!-- Copyright -->
        <div id="copyright" class="container">
            <ul class="links">
                <li>&copy; Aaron Powell. All rights reserved</li>
                <li>Design: <a href="http://html5up.net/">HTML5 UP</a></li>
            </ul>
        </div>

</div>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-6399564-1']);
  _gaq.push(['_trackPageview']);

  (function () {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
  })();

</script>

    </body>
</html>