<!DOCTYPE HTML>
<!--
    Strongly Typed 1.0 by HTML5 UP
    html5up.net | @n33co
    Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
    <head>
  <meta charset="utf-8">
  <title>Flight Mode - local and session storage | LINQ to Fail</title>
  <meta name="author" content="Aaron Powell">
  <meta name="viewport" content="width=1040" />
  <link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600|Arvo:700" rel="stylesheet" type="text/css" />
  <link href="/css/highlightjs/solarized_light.css" rel="stylesheet" type="text/css" />
  <script src="/js/jquery-1.9.1.min.js"></script>
  <script src="/js/jquery.dropotron-1.3.js"></script>
  <script src="/js/config.js"></script>
  <script src="/js/skel.min.js"></script>
  <script src="/js/skel-ui.min.js"></script>
  <noscript>
    <link rel="stylesheet" href="/css/skel-noscript.css" />
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/style-desktop.css" />
  </noscript>
  <!--[if lte IE 8]><script src="/js/html5shiv.js"></script><![endif]-->

</head>

    <body class="left-sidebar">

        <div id="header-wrapper">
            <div id="header" class="container">
                <h1 id="logo">Flight Mode - local and session storage</h1>
                <h2>23rd May 2013</h2>
                <ul class="tags">
    
        <li><a class="icon icon-tag" href="/tagged/flight-mode.html"><span>flight-mode</span></a></li>
    
        <li><a class="icon icon-tag" href="/tagged/offline-storage.html"><span>offline-storage</span></a></li>
    
        <li><a class="icon icon-tag" href="/tagged/localStorage.html"><span>localStorage</span></a></li>
    
        <li><a class="icon icon-tag" href="/tagged/sessionStorage.html"><span>sessionStorage</span></a></li>
    
</ul>
                <!-- Nav -->
<nav id="nav">
    <ul>
        <li><a class="icon icon-home" href="/"><span>Home</span></a></li>
        <li><a class="icon icon-github" href="https://github.com/aaronpowell"><span>aaronpowell</span></a></li>
        <li><a class="icon icon-twitter" href="http://twitter.com/slace"><span>@slace</span></a></li>
        <li><a class="icon icon-book" href="/about"><span>About Me</span></a></li>
        <li><a class="icon icon-rss" href="/feed"><span>Feed</span></a></li>
    </ul>
</nav>

            </div>
        </div>

        <div id="main-wrapper">
            <div id="main" class="container">
                <div class="row">
                    <div id="sidebar" class="4u">
    <section>
        <ul class="divided">
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">30th May 2013</span>
                            <h3><a href="/posts/2013-05-30-libraries.html">Flight Mode - Libraries</a></h3>
                        </header>
                        <p>Throughout the last few posts we&#39;ve looked at the different ways which we can store data offline in browsers and then created a basic little API that will help is with doing that. The <code>FlightMode</code> ...</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/flight-mode.html"><span>flight-mode</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/indexeddb.html"><span>indexeddb</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/localStorage.html"><span>localStorage</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/sessionStorage.html"><span>sessionStorage</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/offline-storage.html"><span>offline-storage</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">28th May 2013</span>
                            <h3><a href="/posts/2013-05-28-file-system.html">Flight Mode - FileSystem API</a></h3>
                        </header>
                        <p>The last piece of the puzzle when looking at offline storage options is a bit of a shift from what we&#39;ve been looking at so far. Generally speaking we&#39;ve been looking at how to store plain data, ei...</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/flight-mode.html"><span>flight-mode</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/offline-storage.html"><span>offline-storage</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/file-system.html"><span>file-system</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">27th May 2013</span>
                            <h3><a href="/posts/2013-05-27-indexeddb.html">Flight Mode - IndexedDB</a></h3>
                        </header>
                        <p>The next stop in our offline storage adventure is to look at the big daddy of offline storage, <a href="http://www.w3.org/TR/IndexedDB/">IndexedDB</a>. Now I&#39;ve [blogged about <code>IndexedDB</code> in the past](http://...</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/flight-mode.html"><span>flight-mode</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/offline-storage.html"><span>offline-storage</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/indexeddb.html"><span>indexeddb</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">23rd May 2013</span>
                            <h3><a href="/posts/2013-05-23-cookies.html">Flight Mode - Cookies</a></h3>
                        </header>
                        <p>In the beginning there was a simple way to store data offline in an application, or more accurately, across sessions, and that is the HTTP Cookie.</p>
<p>Cookies are used for everything, they can [track ...</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/offline-storage.html"><span>offline-storage</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/flight-mode.html"><span>flight-mode</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/cookies.html"><span>cookies</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">23rd May 2013</span>
                            <h3><a href="/posts/2013-05-23-introduction.html">Flight Mode - Introduction</a></h3>
                        </header>
                        <p>So you&#39;ve got an idea to build an amazing new web application, it&#39;s going to make you tens of dollars, hundreds of cents, it&#39;s all web API&#39;ed and SPA. There&#39;s a responsive design so it&#39;s mobile fri...</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/offline-storage.html"><span>offline-storage</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/flight-mode.html"><span>flight-mode</span></a>
                            
                        </div>
                    </article>
                </li>
            
        </ul>
    </section>
</div>

                    <div id="content" class="8u skel-cell-mainContent">
                        <article class="is-post">
                            <p>Last time we looked a <a href="/flight-mode/cookies">using cookies to store offline data</a> and we also saw that there&#39;s a number of problems with that approach. So let&#39;s move forward, let&#39;s look at what our next option would be when it comes to offline storage in our multi-dollar application.</p>
<p>Today it&#39;s time for the next level of offline storage, <code>localStorage</code> and <code>sessionStorage</code> which is sometimes referred to as <code>DOM storage</code>.</p>
<p>I&#39;m going to talk about both of these options together as they share a lot of similarities.</p>
<p>There&#39;s a bit of a misconception around these two APIs, people often refer to them as <em>HTML5 storage</em> but in truth they have been available much longer than that, in fact they can be used in <a href="http://caniuse.com/#search=localstorage">browsers as low as IE8</a> which is not much of a HTML5 browser, and there&#39;s a lot more interesting storage options for &quot;HTML5 browsers&quot; that we&#39;ll look at later.</p>
<h2>Benefits of local/session storage</h2>
<p>Like cookies <code>localStorage</code> and <code>sessionStorage</code> store key/value pairs of data, but they have a much nicer API to work with than you find when trying to work with cookies; it has explicit methods for getting, setting and removing data.</p>
<p>I keep referring to these two storage models together as they share a common root API but they are different. <code>sessionStorage</code> is designed for storing data for the life of a browser session (until the window/tab is closed). This can make it ideal if you&#39;ve got data that you want to temporarily store until the user leaves your application. But this obviously makes it a dangerous one to use in our scenario, because if the browser was to crash while the user is offline you&#39;re likely to loose the data.</p>
<p><code>localStorage</code> on the other hand is a long-term persistent storage, meaning that the data will stay between browser restarts, making it much more ideal for persisting data when we&#39;re offline.</p>
<p>But ultimately you need to select the right one for the right scenario so there are valid use cases for both and it&#39;s good to have that option.</p>
<h2>Drawbacks of local/session storage</h2>
<p>Like cookies these stores are only capable of storing string values. This has the obvious drawback of being difficult to use if we&#39;ve got a complex object that we&#39;re going to want to store for our application state.</p>
<p>The other main drawback is that there&#39;s no &quot;magic sync to server&quot; like with cookies. The data stored in either of these stores is <strong>only</strong> available to the client application, if you need to get the data back up to the server then you&#39;ll need to perform your own data sync. Now that does have the benefit of not having extra data added to a HTTP request so it&#39;s both a pro and a con.</p>
<h2>Implementing local/session storage</h2>
<p>While it&#39;s an exercise in <a href="http://www.codinghorror.com/blog/2009/02/dont-reinvent-the-wheel-unless-you-plan-on-learning-more-about-wheels.html">reinventing the wheel</a> we&#39;ll have a look at how to create a very simple key/value storage API on top of both <code>localStorage</code> and <code>sessionStorage</code>.</p>
<p>We&#39;ll be using our <code>FlightMode</code> API and creating two new adapters, one for each of the stores.</p>
<p>As I mentioned they have a nice API to work with and we get data in/out like so:</p>
<pre class="highlighted"><code class="vhdl">localStorage.setItem(<span class="attribute">'foo</span>', <span class="attribute">'bar</span>');
var item = localStorage.getItem(<span class="attribute">'foo</span>');
localStorage.removeItem(<span class="attribute">'foo</span>');</code></pre>
<p>But like cookies it can only store string values meaning that we&#39;ll be doing a lot of JSON serialization/deserialization, for example here&#39;s how we would do a <code>get</code>/<code>getAll</code> method:</p>
<pre class="highlighted"><code class="objectivec">Store<span class="variable">.prototype</span><span class="variable">.get</span> = function(<span class="keyword">id</span>) {
    <span class="keyword">return</span> JSON<span class="variable">.parse</span>(<span class="keyword">this</span><span class="variable">.storage</span><span class="variable">.getItem</span>(<span class="keyword">id</span>));
};

Store<span class="variable">.prototype</span><span class="variable">.getAll</span> = function() {
    <span class="keyword">return</span> <span class="keyword">this</span><span class="variable">.store</span><span class="variable">.map</span>(<span class="keyword">this</span><span class="variable">.get</span><span class="variable">.bind</span>(<span class="keyword">this</span>));
};</code></pre>
<p>And like the cookie implementation we&#39;re tracking the IDs of all known objects which also adds overhead to out interactions as we need to add/remove items from the tracking object.</p>
<p>You can find the rest of the implementation <a href="https://github.com/aaronpowell/flight-mode-blog/src/adapters/local-session-storage.js">in the github repository</a>.</p>
<h1>Conclusion</h1>
<p>While it might seem that there&#39;s quite a number of downsides for <code>localStorage</code> and <code>sessionStorage</code> over cookies when looking at offline storage options. But really <code>localStorage</code> and <code>sessionStorage</code> are much better options as they:</p>
<ul>
<li>Don&#39;t pollute the HTTP headers and thus increases the request/response size</li>
<li>It&#39;s designed for storing medium-sized bits of data</li>
<li>Getting items in/out has a cleaner API, and it&#39;s better designed than relying on string splitting</li>
</ul>
<p>So if you&#39;re needing to store only really simple data structures across browser sessions then <code>localStorage</code> is a good option especially if the data you&#39;re working with can be indexed by a single property (which would represent your key). If you&#39;re only really focused on single-session cache then <code>sessionStorage</code> can be a good option but it has a much narrower use-case and is less than ideal for offline applications.</p>
<p>If you&#39;re curious to see an implementation of using <code>localStorage</code> for storing data then check out <a href="http://twitter.com">twitter.com</a> and use your browsers dev tools to inspect <code>localStorage</code>. If you start writing a tweet and then close the tab the contents of that tweet are stored in an item keyed <code>__draft_tweets__:home</code> (there&#39;s also a <code>__draft_tweets__:profile</code> for doing it on your profile page). And there&#39;s a bunch of other useful data stored in there. While this data isn&#39;t synced across instances it&#39;s good for when you use a browser and then come back later.</p>

                        </article>
                    </div>
                    <div class="8u skel-cell-mainContent">
                        <article class="is-post">
                            <div id="disqus_thread"></div>
<script>
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
window.disqus_shortname = 'aaronpowell'; // required: replace example with your forum shortname
window.disqus_identifier = document.title || 'Home';
window.disqus_developer = !! ~document.location.href.indexOf("localhost") ? 1 : 0;
window.disqus_url = document.location.origin + '/flight-mode/local-session-storage';

/* * * DON'T EDIT BELOW THIS LINE * * */
(function () {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by</a>
<span class="logo-disqus"> Disqus</span>

                        </article>
                    </div>
                </div>
            </div>
        </div>

        <div id="footer-wrapper">

    <!-- Copyright -->
        <div id="copyright" class="container">
            <ul class="links">
                <li>&copy; Aaron Powell. All rights reserved</li>
                <li>Design: <a href="http://html5up.net/">HTML5 UP</a></li>
            </ul>
        </div>

</div>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-6399564-1']);
  _gaq.push(['_trackPageview']);

  (function () {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
  })();

</script>

    </body>
</html>