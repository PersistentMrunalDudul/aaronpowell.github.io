<!DOCTYPE HTML>
<!--
    Strongly Typed 1.0 by HTML5 UP
    html5up.net | @n33co
    Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
    <head>
  <meta charset="utf-8">
  <title>Introducing Postman - A JavaScript Messaging Library | LINQ to Fail</title>
  <meta name="author" content="Aaron Powell">
  <meta name="viewport" content="width=1040" />
  <link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600|Arvo:700" rel="stylesheet" type="text/css" />
  <link href="/css/highlightjs/solarized_light.css" rel="stylesheet" type="text/css" />
  <script src="/js/jquery-1.9.1.min.js"></script>
  <script src="/js/jquery.dropotron-1.3.js"></script>
  <script src="/js/config.js"></script>
  <script src="/js/skel.min.js"></script>
  <script src="/js/skel-ui.min.js"></script>
  <noscript>
    <link rel="stylesheet" href="/css/skel-noscript.css" />
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/style-desktop.css" />
  </noscript>
  <!--[if lte IE 8]><script src="/js/html5shiv.js"></script><![endif]-->

</head>

    <body class="left-sidebar">

        <div id="header-wrapper">
            <div id="header" class="container">
                <h1 id="logo">Introducing Postman - A JavaScript Messaging Library</h1>
                <h2>2nd July 2011</h2>
                <ul class="tags">
    
        <li><a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a></li>
    
        <li><a class="icon icon-tag" href="/tagged/postman.html"><span>postman</span></a></li>
    
        <li><a class="icon icon-tag" href="/tagged/coffeescript.html"><span>coffeescript</span></a></li>
    
</ul>
                <!-- Nav -->
<nav id="nav">
    <ul>
        <li><a class="icon icon-home" href="/"><span>Home</span></a></li>
        <li><a class="icon icon-github" href="https://github.com/aaronpowell"><span>aaronpowell</span></a></li>
        <li><a class="icon icon-twitter" href="http://twitter.com/slace"><span>@slace</span></a></li>
        <li><a class="icon icon-book" href="/about"><span>About Me</span></a></li>
        <li><a class="icon icon-rss" href="/feed"><span>Feed</span></a></li>
    </ul>
</nav>

            </div>
        </div>

        <div id="main-wrapper">
            <div id="main" class="container">
                <div class="row">
                    <div id="sidebar" class="4u">
    <section>
        <ul class="divided">
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">10th July 2011</span>
                            <h3><a href="/posts/2011-07-10-javascript-quiz.html">JavaScript Quiz</a></h3>
                        </header>
                        <p>Today I released a little website, [<a href="http://javascriptquiz.com][1">http://javascriptquiz.com][1</a>], which was inspired by [<a href="http://cssquiz.com][2">http://cssquiz.com][2</a>].</p>
<p>Basically it&#39;s a site which I&#39;ll put out JavaScript questions for people to tackle...</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">22nd January 2013</span>
                            <h3><a href="/posts/2013-01-22-hello-mathy.html">Hello mathy</a></h3>
                        </header>
                        <p>An introduction to another new library from me, this time it&#39;s mathy, a simple formula parser</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/typescript.html"><span>typescript</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/web.html"><span>web</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">7th January 2013</span>
                            <h3><a href="/posts/2013-01-07-thoughts-on-typescript.html">Thoughts on TypeScript</a></h3>
                        </header>
                        <p>Some of my impressions from trying to implement something in TypeScript</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/typescript.html"><span>typescript</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">2nd October 2012</span>
                            <h3><a href="/posts/2012-10-02-pubsub-in-typescript.html">PubSub in TypeScript</a></h3>
                        </header>
                        <p>It&#39;s that time again, time for more Pub/Sub!</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/typescript.html"><span>typescript</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/web.html"><span>web</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">14th September 2012</span>
                            <h3><a href="/posts/2012-09-14-creating-classes.html">Creating classes in WinJS</a></h3>
                        </header>
                        <p>A look at how you can create JavaScript classes in WinJS</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/winjs.html"><span>winjs</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/windows8.html"><span>windows8</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                        </div>
                    </article>
                </li>
            
        </ul>
    </section>
</div>

                    <div id="content" class="8u skel-cell-mainContent">
                        <article class="is-post">
                            <h1>Prelude</h1>
<p>Back in May I presented at DDD Melbourne on JavaScript design patterns. One of the patterns that I was talking about was the idea of <a href="http://en.wikipedia.org/wiki/Publish/subscribe">pub/ sub</a>.</p>
<p>Let me start by saying that this isn&#39;t the <a href="http://www.aaron-powell.com/javascript-eventmanager">first time I have blogged about pub/ sub</a>, it&#39;s also not the first time I&#39;d written one, but essentially I wrote the following code snippet on stage for the audience:</p>
<pre class="highlighted"><code class="lisp"><span class="list">(<span class="title">function</span><span class="body"><span class="list">(<span class="body">)</span></span> {
  var cache = {}<span class="comment">;</span>

  function pub<span class="list">(<span class="title">name</span><span class="body">, args)</span></span> {
    if<span class="list">(<span class="body">!cache[name])</span></span> {
      cache[name] = {
        subs = []
      }
    }
    for<span class="list">(<span class="title">var</span><span class="body"> i=<span class="number">0</span>, il=cache[name].subs.length<span class="comment">; i&lt;il; i++) {</span>
      cache[name].subs[i].apply<span class="list">(<span class="title">null</span><span class="body">, args)</span></span><span class="comment">;</span>
    }
  }<span class="comment">;</span>

  function sub<span class="list">(<span class="title">name</span><span class="body">, fn)</span></span> {
    if<span class="list">(<span class="body">!cache[name])</span></span> {
      cache[name] = {
        subs = []
      }
    }
    cache[name].subs.push<span class="list">(<span class="title">fn</span><span class="body">)</span></span><span class="comment">;</span>
  }<span class="comment">;</span>

  this.pubsub = {
    pub: pub,
    sub: sub
  }<span class="comment">;</span>
})</span></span><span class="list">(<span class="body">)</span></span><span class="comment">;</span></code></pre>
<p>The code is short and to the point and with the addition of some error checking in it you could probably use that in a live environment.</p>
<h1>Post-DDD</h1>
<p>After the conference I decided that I wanted to revisit how write pub/ sub and essentially scrap the library I last wrote and write it again (for the record I <em>know</em> there are plenty of existing JavaScript pub/ sub libraries out there already, but mine will be cooler, just read on :P).</p>
<p>But something else I wanted to do, and use this project as a sandbox for it, was learn more about <a href="http://coffeescript.org">Coffeescript</a>. If you haven&#39;t heard about Coffeescript but are doing a lot of JavaScript then I suggest you give it a look. Essentially it&#39;s a language on top of JavaScript which aims to remove some of the syntax guff that exists, turning JavaScript into a language that is very similar to Ruby.</p>
<p>So I decided to start a new project, this would be called <code>[Postman][4]</code> that handles sending and receiving messages.</p>
<h1>Hello Mr Postman</h1>
<p>So <a href="http://github.com/aaronpowell/postman">Postman</a> is available on <a href="http://github.com/aaronpowell">my github repository</a> and at the moment I&#39;m quite happy with its feature set. Like a good pub/ sub library you can send and receive messages, like so:</p>
<pre class="highlighted"><code class="matlab"><span class="transposed_variable">postman.</span>receive(<span class="string">'some-message'</span>, <span class="keyword">function</span>(args) <span class="cell">{
  //handle <span class="string">'some-message'</span>
}</span>);

<span class="transposed_variable">postman.</span>deliver(<span class="string">'some-message'</span>, <span class="matrix">[<span class="string">'foo'</span>, <span class="string">'bar'</span>]</span>);</code></pre>
<p>So with the <code>receive</code> method you can add your handlers (sub), and with your <code>deliver</code> method will fire messages (pub). So yes, nothing different to your standard pub/ sub except for the fact that it has a quirky syntax.</p>
<p><code>Postman</code> also has the ability to change methods, every method returns the <code>Postman</code> so he can chain up his operations:</p>
<pre class="highlighted"><code class="vhdl">postman.deliver(<span class="attribute">'message1</span>').deliver(<span class="attribute">'message2</span>');</code></pre>
<h1>Making the Postman smart</h1>
<p>Remember that I said <code>Postman</code> was going to be the coolest pub/ sub library and you should use it above all others? Well there is actual a feature that I have included that I haven&#39;t seen in many other libraries and that&#39;s the idea of a <strong>message bus</strong>.</p>
<h2>Message Bus 101</h2>
<p>The idea of turning a pub/ sub into a message bus came to me in a recent project at work where we were using pub/ sub quite extensively but we have a bit of an issue, we couldn&#39;t ensure that the subscriptions were happening <em>before</em> the publishing was done. This meant that we could have components on our page not receiving the messages and this can be a real issue for us.</p>
<p>With a message bus though we actually track all the messages that were previously published and when a subscriber attaches its callback function it will receive the previously published messages.</p>
<p>That means that we can do the following:</p>
<pre class="highlighted"><code class="cmake">postman.deliver('<span class="keyword">message</span>');
//some other code
postman.receive('<span class="keyword">message</span>', <span class="keyword">function</span>() {
  console.log('<span class="keyword">message</span> was received');
});</code></pre>
<h2>How it works</h2>
<p>Internally what <code>Postman</code> does is tracks every <code>deliver</code> method call and the arguments provided to it and when ever a <code>receive</code> call happens it will iterate through the delivery history and then call the callback with each of the history point.</p>
<h2>Usefulness of a Message Buss</h2>
<p>So now that you&#39;ve seen that with <code>Postman</code> we can not only publish and receive messages using a known order of execution you can see that we&#39;re also allowing an unknown order of execution to happen and our messages are still going to end up at the required destination.</p>
<p>Told you it would be cool ;).</p>
<p>Something else that <code>Postman</code> exposes from its API is a way to get rid of messages. If you&#39;re building a long-running JavaScript application you may find a point where messages reside in the history much longer than you&#39;d like them to, and future subscribers might not care about the state of the application back when the messages first were published. It&#39;s also important for memory management, you don&#39;t want large JavaScript objects sitting in memory if you don&#39;t really need them there. So what <code>Postman</code> does is exposes a method called <code>dropMessages</code> and we can use the method like so:</p>
<pre class="highlighted"><code class="profile"><span class="filename">postman.dropMessages('some-message');</code></pre>
<p><code>Postman</code> will then remove all the call history for the passed in message name. As cool as this is it might be important to drop messages <em>conditionally</em>. To do this <code>Postman</code> allows you to not just pass in a message name, but a criteria which determines the messages to drop.</p>
<p>The criteria that you pass in can be either a function or a date, so you can determine which messages to drop using logic (say if you wanted to drop based on the args that it received) or drop messages older than a certain date.</p>
<p>If you use a function to drop messages it&#39;ll take a callback that internally get&#39;s passed to the <code>[Array.map][7]</code> function, so make sure that you implement it to take those arguments, with the element value being a JavaScript object matching the following schema:</p>
<pre class="highlighted"><code class="css"><span class="rules">{
  <span class="rule"><span class="attribute">args</span>:<span class="value"> [],
  created: Date,
  lastPublished: Date
}</span></span></span></code></pre>
<p>The <code>args</code> property is the arguments that passed into the message (an empty array if you don&#39;t provide arguments), <code>created</code> being a date object which is when the message was raised and <code>lastPublished</code> was when the message was last sent to the a callback.</p>
<p>Lastly when you call the <code>receive</code> method you can pass in an optional third argument which indicates whether the history will be ignored or not. By default history <strong>wont</strong> be ignored but if you&#39;re doing a subscription that you don&#39;t want the history provided to it you can use it like so:</p>
<pre class="highlighted"><code class="matlab"><span class="transposed_variable">postman.</span>receive(<span class="string">'some-message'</span>, <span class="keyword">function</span>() <span class="cell">{ }</span>, true);</code></pre>
<h2>Tests</h2>
<p>Something else I decided to do with <code>Postman</code> was to ensure that it does actually work as advertised. To do this I&#39;ve gone about writing a test suite which you can find <a href="https://github.com/aaronpowell/Postman/blob/master/test/tests.js">here</a>. A lot of people neglect testing when writing JavAScript, but I think it&#39;s quite important to at the very lest sanity check your own API. I&#39;ve used <a href="http://docs.jquery.com/Qunit">Qunit</a> and it&#39;s super simple to write out the tests. Fire up the <a href="https://github.com/aaronpowell/Postman/blob/master/test/tests.html">html</a> in the browser and you&#39;ll see just how the tests themselves pass ;).</p>
<h2>Node.js</h2>
<p>The final goal of <code>Postman</code> was to be entirely unreliant on the DOM so that you could run it in a server-side JavaScript implementation such as <a href="http://nodejs.org">Node.js</a>. I&#39;ll try and get this popped up on <a href="http://npmjs.org">npm</a> so if you want to use it in your Node projects it&#39;ll be nice and easy.</p>
<h1>Conclusion</h1>
<p>So this wraps up my introduction to <code>Postman</code>. As I said pub/ sub is a pattern that is <em>done to death</em> but I hope that this library has a few features which make you choose it over the myriad of existing pub/ sub libraries out there ;).</p>

                        </article>
                    </div>
                    <div class="8u skel-cell-mainContent">
                        <article class="is-post">
                            <div id="disqus_thread"></div>
<script>
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
window.disqus_shortname = 'aaronpowell'; // required: replace example with your forum shortname
window.disqus_identifier = document.title || 'Home';
window.disqus_developer = !! ~document.location.href.indexOf("localhost") ? 1 : 0;
window.disqus_url = document.location.origin + '/javascript/postman';

/* * * DON'T EDIT BELOW THIS LINE * * */
(function () {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by</a>
<span class="logo-disqus"> Disqus</span>

                        </article>
                    </div>
                </div>
            </div>
        </div>

        <div id="footer-wrapper">

    <!-- Copyright -->
        <div id="copyright" class="container">
            <ul class="links">
                <li>&copy; Aaron Powell. All rights reserved</li>
                <li>Design: <a href="http://html5up.net/">HTML5 UP</a></li>
            </ul>
        </div>

</div>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-6399564-1']);
  _gaq.push(['_trackPageview']);

  (function () {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
  })();

</script>

    </body>
</html>