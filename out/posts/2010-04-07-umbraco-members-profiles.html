<!DOCTYPE HTML>
<!--
    Strongly Typed 1.0 by HTML5 UP
    html5up.net | @n33co
    Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
    <head>
  <meta charset="utf-8">
  <title>Umbraco Members Profiles - LINQ to Fail</title>
  <meta name="author" content="Aaron Powell">
  <meta name="viewport" content="width=1040" />
  <link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600|Arvo:700" rel="stylesheet" type="text/css" />
  <link href="/css/highlightjs/solarized_light.css" rel="stylesheet" type="text/css" />
  <script src="/js/jquery-1.9.1.min.js"></script>
  <script src="/js/jquery.dropotron-1.3.js"></script>
  <script src="/js/config.js"></script>
  <script src="/js/skel.min.js"></script>
  <script src="/js/skel-ui.min.js"></script>
  <noscript>
    <link rel="stylesheet" href="/css/skel-noscript.css" />
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/style-desktop.css" />
  </noscript>
  <!--[if lte IE 8]><script src="/js/html5shiv.js"></script><![endif]-->

</head>

    <body class="left-sidebar">

        <div id="header-wrapper">
            <div id="header" class="container">
                <h1 id="logo">Umbraco Members Profiles</h1>
                <h2>7th April 2010</h2>
                <ul class="tags">
    
</ul>
                <!-- Nav -->
<nav id="nav">
    <ul>
        <li><a class="icon icon-home" href="/"><span>Home</span></a></li>
        <li><a class="icon icon-github" href="https://github.com/aaronpowell"><span>aaronpowell</span></a></li>
        <li><a class="icon icon-twitter" href="http://twitter.com/slace"><span>@slace</span></a></li>
        <li><a class="icon icon-book" href="/about"><span>About Me</span></a></li>
        <li><a class="icon icon-rss" href="/feed"><span>Feed</span></a></li>
    </ul>
</nav>

            </div>
        </div>

        <div id="main-wrapper">
            <div id="main" class="container">
                <div class="row">
                    <div id="sidebar" class="4u">
    <section>
        <ul class="divided">
            
        </ul>
    </section>
</div>

                    <div id="content" class="8u skel-cell-mainContent">
                        <article class="is-post">
                            <p>Almost 12 months ago I did a post looking at how to make .NET interaction with Umbraco Members easier (Extending Umbraco Members). This was for Umbraco 3.x, but now with Umbraco 4.x a question that has been coming up a lot on the Umbraco forums of recent is how to work with the Umbraco Membership. When Umbraco 4 was released it brought in the implementation of the ASP.NET Membership classes (MembershipProvider, RoleProvider and ProfileProvider).</p>
<p>These classes were implemented via the umbraco.providers assembly and were essentially just wrappers for the underlying Umbraco Member/ Member Type/ Member Group classes.</p>
<p>Although they still go through the Umbraco API underneath what was very nice was that now it was possible to use the standard ASP.NET login controls, Forms Authentication, etc. And if you&#39;re really brave you could drop in your own membership provider, such as the SqlMembershipProvider or any custom solution you&#39;d written.</p>
<p>Something that seems to have been neglected is how to work with the Member Type information. By default you only have Name, Username and Password on a Member in Umbraco, so we extend it via the MemberType, but how do we get that data back?
Generally people will just use the Umbraco API and the Member.getProperty(alias) method, but that kind of nulls the point of having the ASP.NET Membership available to us, and what if you did want to swap out the providers (although I highly doubt that would ever happen)?</p>
<p>That&#39;s what I&#39;m going to explain here, how you can use the ASP.NET ProfileProvider and it&#39;s associated classes with an Umbraco-defined MemberType.</p>
<h2>Our Member Type</h2>
<p>For this I&#39;m going to have a very basic little Member Type, it&#39;ll have three bits of data on it, First Name, Middle Name and Last Name.</p>
<p><img src="http://www.aaron-powell.com/get/media/2723/picture%201.png" alt=""></p>
<p>As you can see these are defined as per normal, nothing special about that. I can then go to my Umbraco Member and enter some data and view it:</p>
<p><img src="http://www.aaron-powell.com/get/media/2728/picture%202.png" alt=""></p>
<h2>Accessing via ASP.NET</h2>
<p>Now we need to be able to access this via ASP.NET, there are two things we need to configure. First is we want to define our .NET class which represents the Member Type. To do this we need to create a class which inherits from System.Web.Profile.ProfileBase:</p>
<pre class="highlighted"><code class="python">using System;
using System.Web.Profile;
public <span class="class"><span class="keyword">class</span> <span class="title">MemberProfile</span> :</span> ProfileBase { ... }</code></pre>
<p>Now we have to define the properties which we want exposed from our MemberType. The nice thing is here I don&#39;t have to expose everything, if there was a property which I didn&#39;t want/ need access to, I can easily just leave it out. So lets define our properties:</p>
<pre class="highlighted"><code class="cs">[SettingsAllowAnonymous(<span class="keyword">false</span>)]
<span class="keyword">public</span> <span class="keyword">string</span> FirstName
{
    <span class="keyword">get</span>
    {
        <span class="keyword">var</span> o = <span class="keyword">base</span>.GetPropertyValue(<span class="string">"first_name"</span>);
        <span class="keyword">if</span> (o == DBNull.Value)
        {
            <span class="keyword">return</span> <span class="keyword">string</span>.Empty;
        }
        <span class="keyword">return</span> (<span class="keyword">string</span>)o;
    }
    <span class="keyword">set</span>
    {
        <span class="keyword">base</span>.SetPropertyValue(<span class="string">"first_name"</span>, <span class="keyword">value</span>);
    }
}

[SettingsAllowAnonymous(<span class="keyword">false</span>)]
<span class="keyword">public</span> <span class="keyword">string</span> LastName
{
    <span class="keyword">get</span>
    {
        <span class="keyword">var</span> o = <span class="keyword">base</span>.GetPropertyValue(<span class="string">"last_name"</span>);
        <span class="keyword">if</span> (o == DBNull.Value)
        {
            <span class="keyword">return</span> <span class="keyword">string</span>.Empty;
        }
        <span class="keyword">return</span> (<span class="keyword">string</span>)o;
    }
    <span class="keyword">set</span>
    {
        <span class="keyword">base</span>.SetPropertyValue(<span class="string">"last_name"</span>, <span class="keyword">value</span>);
    }
}

[SettingsAllowAnonymous(<span class="keyword">false</span>)]
<span class="keyword">public</span> <span class="keyword">string</span> MiddleName
{
    <span class="keyword">get</span>
    {
        <span class="keyword">var</span> o = <span class="keyword">base</span>.GetPropertyValue(<span class="string">"middle_name"</span>);
        <span class="keyword">if</span> (o == DBNull.Value)
        {
            <span class="keyword">return</span> <span class="keyword">string</span>.Empty;
        }
        <span class="keyword">return</span> (<span class="keyword">string</span>)o;
    }
    <span class="keyword">set</span>
    {
        <span class="keyword">base</span>.SetPropertyValue(<span class="string">"middle_name"</span>, <span class="keyword">value</span>);
    }
}</code></pre>
<p>So as you can see I&#39;ve created three properties which we are exposing. Notice how all of them are doing a <strong>base.GetPropertyValue(string)</strong> method call, and the string we are passing in is the Alias of the Member Type property. This is because we&#39;ll be using the Umbraco ProfileProvider which expects the property alias. This means that we can easily create a friendly name in our class for the property (such as FirstName) and pass through the un-friendly name as the alisa (first_name).
Additionally I&#39;ve marked all the classes with the SettingsAllowAnonymousAttribute and set it to false.
Profiles in ASP.NET Membership can support anonymous profiles, but I wont be covering that.</p>
<p>Now that we&#39;ve defined our class for the profile we need to tell ASP.NET to use it. This is really easy, thanks to the umbraco.provider.members.UmbracoProfileProvider class. This class is an implementation of the ProfileProvider abstract class, and is designed to get the profile information for an Umbraco member.</p>
<p>So we need to set up our web.config like so:</p>
<pre class="highlighted"><code class="xml"><span class="tag">&lt;<span class="title">system.web</span>&gt;</span>
    <span class="tag">&lt;<span class="title">profile</span> <span class="attribute">defaultProvider</span>=<span class="value">"UmbracoMemberProfileProvider"</span> <span class="attribute">enabled</span>=<span class="value">"true"</span> <span class="attribute">inherits</span>=<span class="value">"UmbracoMemberDemo.Web.MemberProfile, UmbracoMemberDemo.Web"</span>&gt;</span>
      <span class="tag">&lt;<span class="title">providers</span>&gt;</span>
        <span class="tag">&lt;<span class="title">clear</span> /&gt;</span>
        <span class="tag">&lt;<span class="title">add</span> <span class="attribute">name</span>=<span class="value">"UmbracoMemberProfileProvider"</span> <span class="attribute">type</span>=<span class="value">"umbraco.providers.members.UmbracoProfileProvider, umbraco.providers"</span> /&gt;</span>
      <span class="tag">&lt;/<span class="title">providers</span>&gt;</span>
      <span class="tag">&lt;<span class="title">properties</span>&gt;</span>
        <span class="tag">&lt;<span class="title">clear</span> /&gt;</span>
        <span class="tag">&lt;<span class="title">add</span> <span class="attribute">name</span>=<span class="value">"first_name"</span> <span class="attribute">allowAnonymous</span> =<span class="value">"false"</span> <span class="attribute">provider</span>=<span class="value">"UmbracoMemberProfileProvider"</span> <span class="attribute">type</span>=<span class="value">"System.String"</span> /&gt;</span>
        <span class="tag">&lt;<span class="title">add</span> <span class="attribute">name</span>=<span class="value">"last_name"</span> <span class="attribute">allowAnonymous</span> =<span class="value">"false"</span> <span class="attribute">provider</span>=<span class="value">"UmbracoMemberProfileProvider"</span> <span class="attribute">type</span>=<span class="value">"System.String"</span> /&gt;</span>
        <span class="tag">&lt;<span class="title">add</span> <span class="attribute">name</span>=<span class="value">"middle_name"</span> <span class="attribute">allowAnonymous</span> =<span class="value">"false"</span> <span class="attribute">provider</span>=<span class="value">"UmbracoMemberProfileProvider"</span> <span class="attribute">type</span>=<span class="value">"System.String"</span> /&gt;</span>
      <span class="tag">&lt;/<span class="title">properties</span>&gt;</span>
    <span class="tag">&lt;/<span class="title">profile</span>&gt;</span>
<span class="tag">&lt;/<span class="title">system.web</span>&gt;</span></code></pre>
<p>So what have we done? Well on the <profile /> node I have defined that I want to use the UmbracoMemberProfileProvider as the default (if I had multiple profile providers defined that is of relivance) and that the profile will inherit my class UmbracoMember.Web.MemberProfile which is in the UmbracoMemberDemo.Web assembly.
This will let ASP.NET know the class type and I can then access the properties through my class.</p>
<p>Lastly I defined the properties which are in the class, with their name being the Alias in Umbraco. I&#39;ve also explicity defined the provider they will come from, again if I had multiple providers defined I could have multiple locations where I get the data, and it&#39;s at the property level I would define where it comes from.</p>
<h2>Using the Profile</h2>
<p>Well we&#39;ve set up all that really needs to be set up, it&#39;s really that simple! But how do we access the data in the profile? Well I&#39;m going to make an assumption that you have secured pages and the following code is being run within one.</p>
<p>From the current HttpContext object we have access to the profile, via HttpContext.Current.Profile and this will return me a ProfileBase instance. So I can now do this:</p>
<pre class="highlighted"><code class="avrasm">string firstName = ((MemberProfile)HttpContext<span class="preprocessor">.Current</span><span class="preprocessor">.Profile</span>)<span class="preprocessor">.FistName</span><span class="comment">;</span></code></pre>
<p>And remember that the property has a setter as well, so I can write back to it as well, which will the write back to Umbraco.</p>
<p>I can make a .NET user control and do something like this also:</p>
<pre class="highlighted"><code class="xml"><span class="tag">&lt;<span class="title">div</span>&gt;</span>
    <span class="tag">&lt;<span class="title">p</span>&gt;</span>
        <span class="tag">&lt;<span class="title">span</span>&gt;</span>First Name: <span class="vbscript">&lt;%= ((UmbracoMemberTester.Web.MemberProfile)Context.Profile).FirstName %&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span>
    <span class="tag">&lt;/<span class="title">p</span>&gt;</span>
    <span class="tag">&lt;<span class="title">p</span>&gt;</span>
        <span class="tag">&lt;<span class="title">span</span>&gt;</span>Middle Name: <span class="vbscript">&lt;%= ((UmbracoMemberTester.Web.MemberProfile)Context.Profile).MiddleName %&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span>
    <span class="tag">&lt;/<span class="title">p</span>&gt;</span>
    <span class="tag">&lt;<span class="title">p</span>&gt;</span>
        <span class="tag">&lt;<span class="title">span</span>&gt;</span>Last Name: <span class="vbscript">&lt;%= ((UmbracoMemberTester.Web.MemberProfile)Context.Profile).LastName %&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span>
    <span class="tag">&lt;/<span class="title">p</span>&gt;</span>
<span class="tag">&lt;/<span class="title">div</span>&gt;</span></code></pre>
<p>That bit of code does not even require a back-end file for the User Control. And how does it look? Well just like this:</p>
<p><img src="http://www.aaron-powell.com/get/media/2733/picture%203.png" alt=""></p>
<h2>Conclusion</h2>
<p>I hope that this has been useful and explains just how easy it can be to use standard ASP.NET features to expose Umbraco Member Types.</p>

                        </article>
                    </div>
                    <div class="8u skel-cell-mainContent">
                        <article class="is-post">
                            <div id="disqus_thread"></div>
<script>
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
window.disqus_shortname = 'aaronpowell'; // required: replace example with your forum shortname
window.disqus_identifier = document.title || 'Home';
window.disqus_developer = !! ~document.location.href.indexOf("localhost") ? 1 : 0;
window.disqus_url = document.location.origin + '/umbraco-members-profiles';

/* * * DON'T EDIT BELOW THIS LINE * * */
(function () {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by</a>
<span class="logo-disqus"> Disqus</span>

                        </article>
                    </div>
                </div>
            </div>
        </div>

        <div id="footer-wrapper">

    <!-- Copyright -->
        <div id="copyright" class="container">
            <ul class="links">
                <li>&copy; Aaron Powell. All rights reserved</li>
                <li>Design: <a href="http://html5up.net/">HTML5 UP</a></li>
            </ul>
        </div>

</div>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-6399564-1']);
  _gaq.push(['_trackPageview']);

  (function () {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
  })();

</script>

    </body>
</html>