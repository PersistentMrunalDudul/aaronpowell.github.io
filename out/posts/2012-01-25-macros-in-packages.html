<!DOCTYPE HTML>
<!--
    Strongly Typed 1.0 by HTML5 UP
    html5up.net | @n33co
    Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
    <head>
  <meta charset="utf-8">
  <title>Macros in packages - LINQ to Fail</title>
  <meta name="author" content="Aaron Powell">
  <meta name="viewport" content="width=1040" />
  <link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600|Arvo:700" rel="stylesheet" type="text/css" />
  <link href="/css/highlightjs/solarized_light.css" rel="stylesheet" type="text/css" />
  <script src="/js/jquery-1.9.1.min.js"></script>
  <script src="/js/jquery.dropotron-1.3.js"></script>
  <script src="/js/config.js"></script>
  <script src="/js/skel.min.js"></script>
  <script src="/js/skel-ui.min.js"></script>
  <noscript>
    <link rel="stylesheet" href="/css/skel-noscript.css" />
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/style-desktop.css" />
  </noscript>
  <!--[if lte IE 8]><script src="/js/html5shiv.js"></script><![endif]-->

</head>

    <body class="left-sidebar">

        <div id="header-wrapper">
            <div id="header" class="container">
                <h1 id="logo">Macros in packages</h1>
                <h2>25th January 2012</h2>
                <ul class="tags">
    
        <li><a class="icon icon-tag" href="/tagged/umbaco.html"><span>umbaco</span></a></li>
    
        <li><a class="icon icon-tag" href="/tagged/umbraco-5.html"><span>umbraco-5</span></a></li>
    
        <li><a class="icon icon-tag" href="/tagged/umbraco.html"><span>umbraco</span></a></li>
    
</ul>
                <!-- Nav -->
<nav id="nav">
    <ul>
        <li><a class="icon icon-home" href="/"><span>Home</span></a></li>
        <li><a class="icon icon-github" href="https://github.com/aaronpowell"><span>aaronpowell</span></a></li>
        <li><a class="icon icon-twitter" href="http://twitter.com/slace"><span>@slace</span></a></li>
        <li><a class="icon icon-book" href="/about"><span>About Me</span></a></li>
        <li><a class="icon icon-rss" href="/feed"><span>Feed</span></a></li>
    </ul>
</nav>

            </div>
        </div>

        <div id="main-wrapper">
            <div id="main" class="container">
                <div class="row">
                    <div id="sidebar" class="4u">
    <section>
        <ul class="divided">
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">5th September 2012</span>
                            <h3><a href="/posts/2012-09-05-text-casing-and-examine.html">Text casing and Examine</a></h3>
                        </header>
                        <p>A few times I&#39;ve seen questions posted on the Umbraco forums which ask how to deal with case insensitivity text with Examine, and itâ€™s also something that we&#39;ve had to handle a few times within our...</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/lucene-net.html"><span>lucene.net</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/examine.html"><span>examine</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/umbraco.html"><span>umbraco</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">11th July 2012</span>
                            <h3><a href="/posts/2012-07-11-using-mvc-in-umbraco-4-revisited.html">Revisiting using ASP.NET MVC in Umbraco 4</a></h3>
                        </header>
                        <p>An update on using ASP.NET MVC with Umbraco 4.</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/umbraco.html"><span>umbraco</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/asp-net-mvc.html"><span>asp.net-mvc</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">13th June 2012</span>
                            <h3><a href="/posts/2012-06-13-introducing-umbraco-contributor-list.html">Introducing the Umbraco contributor mailing list</a></h3>
                        </header>
                        <p>Keen discuss contributing to Umbraco&#39;s core, join the discussion now!</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/umbraco.html"><span>umbraco</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">12th June 2012</span>
                            <h3><a href="/posts/2012-06-12-using-mvc-in-umbraco-4.html">Using ASP.NET MVC in Umbraco 4</a></h3>
                        </header>
                        <p>How to combine ASP.Net MVC applications with an Umbraco project</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/umbraco.html"><span>umbraco</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/asp-net-mvc.html"><span>asp.net-mvc</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">19th December 2011</span>
                            <h3><a href="/posts/2011-12-19-i-want-you.html">I want you</a></h3>
                        </header>
                        <p>![alt text][1]</p>
<p>Hi, my name&#39;s Aaron and I&#39;m a former member of the Umbraco core team. Before I [departed][2] the core team something I was pushing for was greater involvement between the core (and ...</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/umbraco.html"><span>umbraco</span></a>
                            
                        </div>
                    </article>
                </li>
            
        </ul>
    </section>
</div>

                    <div id="content" class="8u skel-cell-mainContent">
                        <article class="is-post">
                            <p>So you&#39;re working on an Umbraco 5 package and you want to be able to ship your own Macro with it. Seems like a common scenario you want to do yeah? It&#39;s something that&#39;s possible in v4 right? So how do you go about doing it in v5?</p>
<h1>Some background</h1>
<p>In v4 Macros were a bit of a pain to ship, in case you didn&#39;t know they were stored in the database and their data model was... less than ideal mainly as they evolved from being XSLT components to also supporting .NET, Iron* and eventually Razor.</p>
<p>Well here&#39;s a fun fact about v5 Macros <strong>they aren&#39;t in the database</strong>, Macros in v5 are actually stored in Hive. Out of the box they will be run of the file system Hive provider but since they are in Hive you could (in theory) stick them into the Database, on a FTP or anywhere crazy that you want. But really, them being on the file system is pretty fantastic as it means that it&#39;s really easy to include them in Source Control, something that was a huge problem with the Umbraco projects I&#39;d worked with in the past.</p>
<p>You will find your macros (by default) at the location <code>~/App_Data/Umbraco/Macros</code> and this contains a serialized XML version of your macro, which looks a lot like the exported Macro definitions in v4, just not quite as confusing. Also this is a configuration value that comes from the <code>/configuration/umbraco/macros[@rootPath]</code> section of the web.config. Again this is something that you can change but you probably shouldn&#39;t :P.</p>
<h1>Installing Macros from your package</h1>
<p>In my <a href="http://www.aaron-powell.com/umbraco/creating-an-installer-task">last post</a> I introduced tasks and again this is what you&#39;ll want to use to install your macro with your package.</p>
<p>The first thing you want to do is copy your macro file from the Macros folder into somewhere that&#39;ll include it in your package. I use a folder called <strong>Macros</strong> that sites at the root of my package, but it&#39;s ultimately a personal preference thing so you can put that folder anywhere inside your package.</p>
<p><em>Side note Matt Brailsford has a great post on <a href="http://blog.mattbrailsford.com/2011/09/30/automating-umbraco-v5-package-creation-using-msbuild/">how to create v5 packages</a>, a must-read until there&#39;s a UI to do it.</em></p>
<p>Part of the v5 source includes a task that can help you with this and it&#39;s called <code>CopyFileTask</code> and it allows you to copy a single file from one location to another. You&#39;ll see this task used as part of the <em>DevDataset</em> that&#39;s shipping with the RC builds but what you want to do is something like this:</p>
<pre class="highlighted"><code class="xml">  <span class="tag">&lt;<span class="title">add</span> <span class="attribute">type</span>=<span class="value">"Umbraco.Cms.Web.Tasks.CopyFileTask, Umbraco.Cms.Web.Tasks"</span> <span class="attribute">trigger</span>=<span class="value">"post-package-install"</span>&gt;</span>
    <span class="tag">&lt;<span class="title">parameter</span> <span class="attribute">name</span>=<span class="value">"source"</span> <span class="attribute">value</span>=<span class="value">"Macros/MyMacro.macro"</span> /&gt;</span>
    <span class="tag">&lt;<span class="title">parameter</span> <span class="attribute">name</span>=<span class="value">"destination"</span> <span class="attribute">value</span>=<span class="value">"~/App_Data/Umbraco/Macros/MyMacro.macro"</span> /&gt;</span>
  <span class="tag">&lt;/<span class="title">add</span>&gt;</span></code></pre>
<p>Adding that to your web.config in your packages (as described in my last post) will copy the file from the <strong>Macros</strong> folder in your package (or what ever folder you&#39;ve put them into) to the Umbraco Macros folder.</p>
<h1>Conclusion</h1>
<p><strong>Yes, that&#39;s it.</strong></p>
<p>Seriously, it&#39;s so much easier to ship Macros in v5 that v4 and the fact that they are running off disk (don&#39;t be a dick and use some crazy Hive provider for them like Examine!) makes installing them as simple as copying a file.</p>
<p>But I think there&#39;s some room for improvements around this still and as I work on my v5 tasks set I&#39;m going to be doing a simpler task for installing Macros, but in the meantime the above will work nicely <strong>today</strong>.</p>

                        </article>
                    </div>
                    <div class="8u skel-cell-mainContent">
                        <article class="is-post">
                            <div id="disqus_thread"></div>
<script>
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
window.disqus_shortname = 'aaronpowell'; // required: replace example with your forum shortname
window.disqus_identifier = document.title || 'Home';
window.disqus_developer = !! ~document.location.href.indexOf("localhost") ? 1 : 0;
window.disqus_url = document.location.origin + '/umbraco/macros-in-packages';

/* * * DON'T EDIT BELOW THIS LINE * * */
(function () {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by</a>
<span class="logo-disqus"> Disqus</span>

                        </article>
                    </div>
                </div>
            </div>
        </div>

        <div id="footer-wrapper">

    <!-- Copyright -->
        <div id="copyright" class="container">
            <ul class="links">
                <li>&copy; Aaron Powell. All rights reserved</li>
                <li>Design: <a href="http://html5up.net/">HTML5 UP</a></li>
            </ul>
        </div>

</div>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-6399564-1']);
  _gaq.push(['_trackPageview']);

  (function () {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
  })();

</script>

    </body>
</html>