<!DOCTYPE HTML>
<!--
    Strongly Typed 1.0 by HTML5 UP
    html5up.net | @n33co
    Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
    <head>
  <meta charset="utf-8">
  <title>How to check if a file exists in Windows 8 - LINQ to Fail</title>
  <meta name="author" content="Aaron Powell">
  <meta name="viewport" content="width=1040" />
  <link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600|Arvo:700" rel="stylesheet" type="text/css" />
  <link href="/css/highlightjs/solarized_light.css" rel="stylesheet" type="text/css" />
  <script src="/js/jquery-1.9.1.min.js"></script>
  <script src="/js/jquery.dropotron-1.3.js"></script>
  <script src="/js/config.js"></script>
  <script src="/js/skel.min.js"></script>
  <script src="/js/skel-ui.min.js"></script>
  <noscript>
    <link rel="stylesheet" href="/css/skel-noscript.css" />
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/style-desktop.css" />
  </noscript>
  <!--[if lte IE 8]><script src="/js/html5shiv.js"></script><![endif]-->

</head>

    <body class="left-sidebar">

        <div id="header-wrapper">
            <div id="header" class="container">
                <h1 id="logo">How to check if a file exists in Windows 8</h1>
                <h2>24th September 2012</h2>
                <ul class="tags">
    
        <li><a class="icon icon-tag" href="/tagged/windows8.html"><span>windows8</span></a></li>
    
        <li><a class="icon icon-tag" href="/tagged/winjs.html"><span>winjs</span></a></li>
    
        <li><a class="icon icon-tag" href="/tagged/c-.html"><span>c#</span></a></li>
    
        <li><a class="icon icon-tag" href="/tagged/winrt.html"><span>winrt</span></a></li>
    
</ul>
                <!-- Nav -->
<nav id="nav">
    <ul>
        <li><a class="icon icon-home" href="/"><span>Home</span></a></li>
        <li><a class="icon icon-github" href="https://github.com/aaronpowell"><span>aaronpowell</span></a></li>
        <li><a class="icon icon-twitter" href="http://twitter.com/slace"><span>@slace</span></a></li>
        <li><a class="icon icon-book" href="/about"><span>About Me</span></a></li>
        <li><a class="icon icon-rss" href="/feed"><span>Feed</span></a></li>
    </ul>
</nav>

            </div>
        </div>

        <div id="main-wrapper">
            <div id="main" class="container">
                <div class="row">
                    <div id="sidebar" class="4u">
    <section>
        <ul class="divided">
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">16th June 2010</span>
                            <h3><a href="/posts/2010-06-16-aspnet-mvc-xml-action-result.html">ASP.NET MVC XML Action Result</a></h3>
                        </header>
                        <p>An easy way to return XML from ASP.NET MVC</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/asp-net.html"><span>asp.net</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/asp-net-mvc.html"><span>asp.net-mvc</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/c-.html"><span>c#</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/xml.html"><span>xml</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">2nd October 2012</span>
                            <h3><a href="/posts/2012-10-02-dbjs-indexes-and-queries.html">Indexes and Queries in db.js</a></h3>
                        </header>
                        <p>An overview of how to create indexes and execute powerful queries against them using db.js</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/indexeddb.html"><span>indexeddb</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/web.html"><span>web</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/winjs.html"><span>winjs</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">26th September 2012</span>
                            <h3><a href="/posts/2012-09-26-teched-2012.html">Teched 2012 - HTML & JavaScript Windows 8 apps</a></h3>
                        </header>
                        <p>Couldn&#39;t make it to Teched Australia this year?</p>
<p>Made it and absolutely loved my session?</p>
<p>Well good news everybody, it&#39;s now online for your viewing pleasure, [check it out here][1].</p>
<p>This year my...</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/auteched.html"><span>auteched</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/winjs.html"><span>winjs</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/speaking.html"><span>speaking</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">14th September 2012</span>
                            <h3><a href="/posts/2012-09-14-creating-classes.html">Creating classes in WinJS</a></h3>
                        </header>
                        <p>A look at how you can create JavaScript classes in WinJS</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/winjs.html"><span>winjs</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/windows8.html"><span>windows8</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">14th September 2012</span>
                            <h3><a href="/posts/2012-09-14-settings-suck.html">The settings suck</a></h3>
                        </header>
                        <p>Settings in Windows 8 XAML suck. Period.</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/xaml.html"><span>xaml</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/windows8.html"><span>windows8</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/rant.html"><span>rant</span></a>
                            
                        </div>
                    </article>
                </li>
            
        </ul>
    </section>
</div>

                    <div id="content" class="8u skel-cell-mainContent">
                        <article class="is-post">
                            <p>Sometimes things are simple, sometimes they aren&#39;t when you think they should be. One such thing in Windows 8 development is checking if a file exists...</p>
<p>In a Windows 8 app (be it C# or JavaScript) you work with the <a href="http://msdn.microsoft.com/library/windows/apps/BR227230"><code>StorageFolder</code></a>. Since we are sandboxed and don&#39;t really have file-system access we don&#39;t have the <code>System.IO</code> namespace as we&#39;re use to meaning we have an entirely new set of APIs for reading a writing files (although it&#39;s nice that they are built around being asynchronous). The fun thing about <code>StorageFolder</code> is it has no method like <code>FileExistsAsync</code>. Yep, there&#39;s no API which will allow you to work out whether a file exists or not...</p>
<p>So how do you do it?</p>
<h1>EDD, Exception Driven Development</h1>
<p>If you&#39;ve done much Windows 8 development you&#39;ll have learnt that a lot of the methods you&#39;d expect to return null values or have a <code>TryGetFoo</code> method will actually raise an exception when the take can&#39;t be completed. <code>StorageFolder</code> is no exception to this rule.</p>
<p>Although I can&#39;t find it documented anywhere it seems that the only way you can check if a file exists if with this:</p>
<pre class="highlighted"><code class="nginx"><span class="title">StorageFile</span> file;
<span class="title">try</span> {
    <span class="title">file</span> = await ApplicationData.Current.LocalStorage.GetFileAsync(<span class="string">"foo.txt"</span>);
}
<span class="title">catch</span> (FileNotFoundException) {
    <span class="title">file</span> = null;
}</code></pre>
<p>It seems to consistently throw the <code>FileNotFoundException</code> when it doesn&#39;t exist (which I guess makes sense :P), but the problem is that you end up with this try/ catch block where you&#39;re essentially swallow an exception (and everything in my programming past tells me that that&#39;s a bad idea).</p>
<p>Well the logic is pretty straight forward so here&#39;s an extension method:</p>
<pre class="highlighted"><code class="vala"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">StorageFolderExtensions</span>
{</span>
    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">async</span> Task&lt;<span class="keyword">bool</span>&gt; FileExistsAsync(<span class="keyword">this</span> StorageFolder folder, <span class="keyword">string</span> fileName)
    {
        <span class="keyword">try</span>
        {
            await folder.GetFileAsync(fileName);
            <span class="keyword">return</span> <span class="literal">true</span>;
        }
        <span class="keyword">catch</span> (FileNotFoundException)
        {
            <span class="keyword">return</span> <span class="literal">false</span>;
        }
    }
}</code></pre>
<p>Or grab the <a href="https://gist.github.com/3773739">gist</a>.</p>
<h1>WinJS file exists</h1>
<p>So that above is all well and good in C#/ XAML Windows 8 applications, but what if you&#39;re like me and would prefer to just use WinJS?</p>
<p>Well the API is slightly less shit for WinJS, true you still don&#39;t have any easy way to check if a file exists or not but instead of being exception based it handles it through <a href="http://msdn.microsoft.com/en-us/library/windows/apps/br211867.aspx">promises</a>:</p>
<pre class="highlighted"><code class="javascript"><span class="keyword">var</span> folder = Windows.Storage.ApplicationData.current.roamingFolder;
folder.getFileAsync(<span class="string">'foo.txt'</span>).then(<span class="function"><span class="keyword">function</span> <span class="params">(file)</span> {</span>
    <span class="comment">//process with a valid file</span>
}, <span class="function"><span class="keyword">function</span> <span class="params">(e)</span> {</span>
    <span class="comment">//no file was found</span>
});</code></pre>
<p>While this is <em>somewhat</em> nicer as you don&#39;t have to try/ catch the error it&#39;s still not ideal. One of the main problems here is there&#39;s no way to know <em>what</em> error was raised. Since JavaScript doesn&#39;t have typed error handling like C# any error that comes from the <code>getFileAsync</code> method goes into the same error handler. This can be a bit of a pain although I&#39;m struggling to find any documentation on what else could be raised.</p>
<p>There&#39;s three things you can do in this case:</p>
<ol>
<li>Assume that it is the WinJS equivilent of <code>FileNotFoundException</code> and treat all errors the same (this is probably the best way, you don&#39;t have a file, do you really care why?)</li>
<li>You can check the message contains something stating the file didn&#39;t exist, but if you do this make sure you&#39;re taking localisation into account!</li>
<li>Cast it to it&#39;s <em>base error type</em> and go from there. This isn&#39;t overly robust as the best you can do is <code>e instanceof WinRTError</code> as it&#39;s not <em>of type</em> <code>FileNotFoundException</code></li>
</ol>
<p>If you&#39;re really keen here&#39;s an <em>extension method</em> for doing it in WinJS in a very basic manner (<a href="https://gist.github.com/3773776">and gist</a>):</p>
<pre class="highlighted"><code class="avrasm">Windows<span class="preprocessor">.Storage</span><span class="preprocessor">.StorageFolder</span><span class="preprocessor">.prototype</span><span class="preprocessor">.fileExistsAsync</span> = function(fileName) {
    var folder = this<span class="comment">;</span>
    return WinJS<span class="preprocessor">.Promise</span>(function (complete, error) {
        folder<span class="preprocessor">.getFileAsync</span>(fileName)<span class="preprocessor">.then</span>(function() {
            complete()<span class="comment">;</span>
        }, function() {
            error()<span class="comment">;</span>
        })<span class="comment">;</span>
    })<span class="comment">;</span>
}<span class="comment">;</span></code></pre>
<p>But realistically I wouldn&#39;t bother, since WinJS uses a Promise for this you can pretty easily split out the logic branch between the found/ not found process without the need for an ugly try/ catch block in place. Hell if you don&#39;t want to do anything when there isn&#39;t a file then you can drop the error callback all together and the application will carry on its merry way.</p>
<h1>Conclusion</h1>
<p>There&#39;s no built in method for determining if a file exists or not from a Windows 8 application using the <code>StorageFolder</code> API. If you&#39;re using C# you&#39;re going to need to handle the <code>FileNotFoundException</code> and go from there. A simple extension method is easy to create if you&#39;re doing a lot of file IO and want to check files exist. WinJS is marginally better though the different async handling but really it&#39;s just hiding the try/ catch away behind another layer. In this case you can provide different callbacks for the different states which can make the code a little cleaner.</p>

                        </article>
                    </div>
                    <div class="8u skel-cell-mainContent">
                        <article class="is-post">
                            <div id="disqus_thread"></div>
<script>
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
window.disqus_shortname = 'aaronpowell'; // required: replace example with your forum shortname
window.disqus_identifier = document.title || 'Home';
window.disqus_developer = !! ~document.location.href.indexOf("localhost") ? 1 : 0;
window.disqus_url = document.location.origin + '/winrt/check-if-file-exists';

/* * * DON'T EDIT BELOW THIS LINE * * */
(function () {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by</a>
<span class="logo-disqus"> Disqus</span>

                        </article>
                    </div>
                </div>
            </div>
        </div>

        <div id="footer-wrapper">

    <!-- Copyright -->
        <div id="copyright" class="container">
            <ul class="links">
                <li>&copy; Aaron Powell. All rights reserved</li>
                <li>Design: <a href="http://html5up.net/">HTML5 UP</a></li>
            </ul>
        </div>

</div>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-6399564-1']);
  _gaq.push(['_trackPageview']);

  (function () {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
  })();

</script>

    </body>
</html>