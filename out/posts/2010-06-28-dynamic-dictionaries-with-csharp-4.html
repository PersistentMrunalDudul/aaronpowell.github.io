<!DOCTYPE HTML>
<!--
    Strongly Typed 1.0 by HTML5 UP
    html5up.net | @n33co
    Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
    <head>
  <meta charset="utf-8">
  <title>Dynamic Dictionaries with C# 4.0 | LINQ to Fail</title>
  <meta name="author" content="Aaron Powell">
  <meta name="viewport" content="width=1040" />
  <link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600|Arvo:700" rel="stylesheet" type="text/css" />
  <link href="/css/highlightjs/solarized_light.css" rel="stylesheet" type="text/css" />
  <script src="/js/jquery-1.9.1.min.js"></script>
  <script src="/js/jquery.dropotron-1.3.js"></script>
  <script src="/js/config.js"></script>
  <script src="/js/skel.min.js"></script>
  <script src="/js/skel-ui.min.js"></script>
  <noscript>
    <link rel="stylesheet" href="/css/skel-noscript.css" />
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/style-desktop.css" />
  </noscript>
  <!--[if lte IE 8]><script src="/js/html5shiv.js"></script><![endif]-->

</head>

    <body class="left-sidebar">

        <div id="header-wrapper">
            <div id="header" class="container">
                <h1 id="logo">Dynamic Dictionaries with C# 4.0</h1>
                <h2>28th June 2010</h2>
                <ul class="tags">
    
        <li><a class="icon icon-tag" href="/tagged/c-.html"><span>c#</span></a></li>
    
        <li><a class="icon icon-tag" href="/tagged/net.html"><span>.net</span></a></li>
    
        <li><a class="icon icon-tag" href="/tagged/dynamic.html"><span>dynamic</span></a></li>
    
        <li><a class="icon icon-tag" href="/tagged/umbraco.html"><span>umbraco</span></a></li>
    
</ul>
                <!-- Nav -->
<nav id="nav">
    <ul>
        <li><a class="icon icon-home" href="/"><span>Home</span></a></li>
        <li><a class="icon icon-github" href="https://github.com/aaronpowell"><span>aaronpowell</span></a></li>
        <li><a class="icon icon-twitter" href="http://twitter.com/slace"><span>@slace</span></a></li>
        <li><a class="icon icon-book" href="/about"><span>About Me</span></a></li>
        <li><a class="icon icon-rss" href="/feed"><span>Feed</span></a></li>
    </ul>
</nav>

            </div>
        </div>

        <div id="main-wrapper">
            <div id="main" class="container">
                <div class="row">
                    <div id="sidebar" class="4u">
    <section>
        <ul class="divided">
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">30th August 2010</span>
                            <h3><a href="/posts/2010-08-30-http-compression-mvc-fileresult.html">Using HttpCompression libraries and ASP.NET MVC FileResult</a></h3>
                        </header>
                        <p>An interesting quirk I found from ClientDe</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/asp-net-mvc.html"><span>asp.net-mvc</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/clientdependency.html"><span>clientdependency</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/umbraco.html"><span>umbraco</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">19th May 2009</span>
                            <h3><a href="/posts/2009-05-19-query-syntax-vs-method-syntax.html">Query Syntax vs Method Syntax</a></h3>
                        </header>
                        <p>What&#39;s the difference with LINQ to using query syntax to pure lambda expressions?</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/linq.html"><span>linq</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/c-.html"><span>c#</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/net.html"><span>.net</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">1st April 2010</span>
                            <h3><a href="/posts/2010-04-01-umbraco.html">Umbraco</a></h3>
                        </header>
                        <p>All my articles about the worlds friendliest CMS</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/umbraco.html"><span>umbraco</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/cms.html"><span>cms</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/net.html"><span>.net</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">7th April 2010</span>
                            <h3><a href="/posts/2010-04-07-csharp.html">C#/ .NET</a></h3>
                        </header>
                        <p>Source of all that I&#39;ve written about in the .NET world</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/c-.html"><span>c#</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/net.html"><span>.net</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">8th April 2010</span>
                            <h3><a href="/posts/2010-04-08-the-great-umbraco-api-misconception.html">The great Umbraco API misconception</a></h3>
                        </header>
                        <p>Sometimes the truth hurts</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/umbraco.html"><span>umbraco</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/cms.html"><span>cms</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/net.html"><span>.net</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/caution.html"><span>caution</span></a>
                            
                        </div>
                    </article>
                </li>
            
        </ul>
    </section>
</div>

                    <div id="content" class="8u skel-cell-mainContent">
                        <article class="is-post">
                            <p>Have you ever been working with the <code>Dictionary&lt;TKey, TValue&gt;</code> object in .NET and just wanted to find some way in which you can do this:</p>
<pre class="highlighted"><code class="r">var dictionary = new Dictionary&lt;string, string&gt; { { <span class="string">"hello"</span>, <span class="string">"world!"</span> } };
<span class="keyword">...</span>
var something = dictionary.hello;</code></pre>
<p>It&#39;d be sweet, but it&#39;s not possible. The dictionary is just a bucket and there isn&#39;t a way it can know at compile type about the objects which are within it. Damn, so you just have to go via the indexer of the dictionary.</p>
<p>But really, using dot-notation could be really cool!</p>
<p>Well with the .NET 4.0 framework we now have a built in DLR so can we use the dynamic features of the C# 4 to this?</p>
<h2>Introducing the DynamicObject</h2>
<p>Well the answer is yes, yes you can do this, and it&#39;s really bloody easy, in fact you can do it in about 10 lines of code (if you leave out error checking and don&#39;t count curly braces :P).</p>
<p>First off you need to have a look at the <a href="http://msdn.microsoft.com/en-us/library/system.dynamic.dynamicobject.aspx"><code>DynamicObject</code> which is in System.Runtime</a>. There&#39;s a lot of different things you can do with the <code>DynamicObject</code> class, and things which you can change. For this we are going to work with <a href="http://msdn.microsoft.com/en-us/library/system.dynamic.dynamicobject.trygetmember.aspx"><code>TryGetMember</code></a>, with this we just need to override the base implementation so we can add our own dot-notation handler!</p>
<p>So lets start with a class:</p>
<pre class="highlighted"><code class="vala"><span class="keyword">using</span> System;
<span class="keyword">using</span> System.Collections.Generic;
<span class="keyword">using</span> System.Dynamic;

<span class="class"><span class="keyword">namespace</span> <span class="title">AaronPowell</span>.<span class="title">Dynamics</span>.<span class="title">Collections</span>
{</span>
    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DynamicDictionary</span>&lt;<span class="title">TValue</span>&gt; : <span class="title">DynamicObject</span>
    {</span>
        <span class="keyword">private</span> IDictionary&lt;<span class="keyword">string</span>, TValue&gt; dictionary;

        <span class="keyword">public</span> DynamicDictionary(IDictionary&lt;<span class="keyword">string</span>, TValue&gt; dictionary)
        {
            <span class="keyword">this</span>.dictionary = dictionary;
        }
    }
}</code></pre>
<p>Essentially this is just going to be a wrapper for our dynamic implementation of a dictionary. So we&#39;re actually making a class which has a private property which takes a dictionary instance into the constructor.</p>
<p>Now we&#39;ve got our object we need do some work to get it handle our dot-notation interaction. First we&#39;ll override the base implementation:</p>
<pre class="highlighted"><code class="nginx">    <span class="title">public</span> override bool TryGetMember(GetMemberBinder binder, out object result)
    {
        <span class="title">var</span> key = binder.Name;
        <span class="title">if</span> (dictionary.ContainsKey(key))
        {
            <span class="title">result</span> = dictionary[key];
            <span class="title">return</span> <span class="built_in">true</span>;
        }
        <span class="title">throw</span> new KeyNotFoundException(string.Format(<span class="string">"Key \"{0}\" was not found in the given dictionary"</span>, key));
    }</code></pre>
<p>And you know what, we&#39;re actually done! Now all you have to do:</p>
<pre class="highlighted"><code class="cs"><span class="keyword">var</span> dictionary = <span class="keyword">new</span> Dictionary&lt;<span class="keyword">string</span>, <span class="keyword">string</span>&gt; {
    { <span class="string">"hello"</span>, <span class="string">"world!"</span> }
};

dynamic dynamicDictionary = <span class="keyword">new</span> DyanmicDictionary(dictionary);

Console.WriteLine(dynamicDictionary.hello); <span class="comment">//prints 'world'</span></code></pre>
<p>I&#39;m going to be releasing the source for this shortly (well, an improved version), along with a few other nifty uses for <code>dynamic</code>. So keep watching this space for that ;).</p>
<h2>Umbraco</h2>
<p>While we were working on some sexy features for Umbraco 5 over the CodeGarden 10 retreat we kept saying that we should look at using as many of the cool new .NET framework features which we can possibly get away with. To this extent we kept saying we need to work out how to implement the <code>dynamic</code> keyword in some way.</p>
<p>Well that&#39;s where the idea for the above code came from, in fact we&#39;ve got a similar piece of code which will be usable within the framework of Umbraco 5 and entity design. But the full info on that will belong to another post ;).</p>
<h2>Released!</h2>
<p>I&#39;ve rolled the above code (with some improvements mind you) into a new project that I&#39;ve been working on for making working with dynamics in .NET a whole lot easier. You can check out my <a href="/dynamics-library">Dynamics Library</a> and get dynamacising.</p>

                        </article>
                    </div>
                    <div class="8u skel-cell-mainContent">
                        <article class="is-post">
                            <div id="disqus_thread"></div>
<script>
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
window.disqus_shortname = 'aaronpowell'; // required: replace example with your forum shortname
window.disqus_identifier = document.title || 'Home';
window.disqus_developer = !! ~document.location.href.indexOf("localhost") ? 1 : 0;
window.disqus_url = document.location.origin + '/dynamic-dictionaries-with-csharp-4';

/* * * DON'T EDIT BELOW THIS LINE * * */
(function () {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by</a>
<span class="logo-disqus"> Disqus</span>

                        </article>
                    </div>
                </div>
            </div>
        </div>

        <div id="footer-wrapper">

    <!-- Copyright -->
        <div id="copyright" class="container">
            <ul class="links">
                <li>&copy; Aaron Powell. All rights reserved</li>
                <li>Design: <a href="http://html5up.net/">HTML5 UP</a></li>
            </ul>
        </div>

</div>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-6399564-1']);
  _gaq.push(['_trackPageview']);

  (function () {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
  })();

</script>

    </body>
</html>