<!DOCTYPE HTML>
<!--
    Strongly Typed 1.0 by HTML5 UP
    html5up.net | @n33co
    Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
    <head>
  <meta charset="utf-8">
  <title>ServerHere - When you just need a webserver | LINQ to Fail</title>
  <meta name="author" content="Aaron Powell">
  <meta name="viewport" content="width=1040" />
  <link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600|Arvo:700" rel="stylesheet" type="text/css" />
  <link href="/css/highlightjs/solarized_light.css" rel="stylesheet" type="text/css" />
  <script src="/js/jquery-1.9.1.min.js"></script>
  <script src="/js/jquery.dropotron-1.3.js"></script>
  <script src="/js/config.js"></script>
  <script src="/js/skel.min.js"></script>
  <script src="/js/skel-ui.min.js"></script>
  <noscript>
    <link rel="stylesheet" href="/css/skel-noscript.css" />
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/style-desktop.css" />
  </noscript>
  <!--[if lte IE 8]><script src="/js/html5shiv.js"></script><![endif]-->

</head>

    <body class="left-sidebar">

        <div id="header-wrapper">
            <div id="header" class="container">
                <h1 id="logo">ServerHere - When you just need a webserver</h1>
                <h2>8th March 2011</h2>
                <ul class="tags">
    
        <li><a class="icon icon-tag" href="/tagged/web.html"><span>web</span></a></li>
    
</ul>
                <!-- Nav -->
<nav id="nav">
    <ul>
        <li><a class="icon icon-home" href="/"><span>Home</span></a></li>
        <li><a class="icon icon-github" href="https://github.com/aaronpowell"><span>aaronpowell</span></a></li>
        <li><a class="icon icon-twitter" href="http://twitter.com/slace"><span>@slace</span></a></li>
        <li><a class="icon icon-book" href="/about"><span>About Me</span></a></li>
        <li><a class="icon icon-rss" href="/feed"><span>Feed</span></a></li>
    </ul>
</nav>

            </div>
        </div>

        <div id="main-wrapper">
            <div id="main" class="container">
                <div class="row">
                    <div id="sidebar" class="4u">
    <section>
        <ul class="divided">
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">13th March 2011</span>
                            <h3><a href="/posts/2011-03-13-javascript-animation.html">Animating with JavaScript</a></h3>
                        </header>
                        <p>A look at how to make a simple JavaScript animation library</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/web.html"><span>web</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">19th April 2013</span>
                            <h3><a href="/posts/2013-04-19-ie-useragents.html">Internet Explorer userAgents</a></h3>
                        </header>
                        <p>A new program from the IE team</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/internet-explorer.html"><span>internet-explorer</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/web.html"><span>web</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">14th January 2013</span>
                            <h3><a href="/posts/2013-01-14-ie10-console-thoughts.html">Making the Internet Explorer JavaScript tools better, again</a></h3>
                        </header>
                        <p>A look at what&#39;s changed since I last pointed out the failings of the IE dev tools</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/web.html"><span>web</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/internet-explorer.html"><span>internet-explorer</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/web-dev.html"><span>web-dev</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">18th October 2012</span>
                            <h3><a href="/posts/2012-10-18-dbjs-chrome.html">Chrome support for db.js</a></h3>
                        </header>
                        <p>A little word on the db.js support for Chrome</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/indexeddb.html"><span>indexeddb</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/chrome.html"><span>chrome</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/web.html"><span>web</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">8th October 2012</span>
                            <h3><a href="/posts/2012-10-08-reverse-order-unique-indexes.html">Reverse order unique queries in IndexedDB</a></h3>
                        </header>
                        <p>The quirk of reverse index querying in IndexedDB and in turn db.js</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/indexeddb.html"><span>indexeddb</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/web.html"><span>web</span></a>
                            
                        </div>
                    </article>
                </li>
            
        </ul>
    </section>
</div>

                    <div id="content" class="8u skel-cell-mainContent">
                        <article class="is-post">
                            <p>I&#39;ve been doing a lot of JavaScript development recently and as cool as <a href="http://jsfiddle.net">jsfiddle</a> there&#39;s a few things that really irk me about it (which is a topic for another day) and sometimes you just want to run the file locally to see how it goes.</p>
<p>So you go and create a HTML and JavaScript file on your file system and you open it in your browser and you have that crazy file system path in your address bar. Most browsers this is fine for, but IE likes to try and be a bit more secure so I&#39;ll often see this:</p>
<p><img src="http://www.aaron-powell.com/upload/Render/javascript/ie-security.PNG" alt="IE security warning"></p>
<p>Sure you can change IE&#39;s security settings to be a little less aggressive and not give you that warning but I quite like that my browser is trying to be a bit secure, I don&#39;t see why that&#39;s such a bad thing.</p>
<p>But it can be a pain, if you don&#39;t accept the security warning your JavaScript doesn&#39;t work.</p>
<p>There&#39;s several ways I could go about solving this problem, I could use Visual Studio and IIS Express (or Cassini if you&#39;re old-school :P), I could map my local IIS install to that folder or I could write my own web server.</p>
<p>Guess what I did!</p>
<h1>ServerHere</h1>
<p>If you guessed that I wrote my own web server then you guessed right. I&#39;ve created a little project called <strong><a href="http://hg.slace.biz/serverhere">ServerHere</a></strong> which does exactly what the name implies, <em>creates a web server from the current folder</em>.</p>
<p>It&#39;s a commandline tool and you use it just like this:</p>
<pre class="highlighted"><code class="tex">PS&gt; cd c:<span class="command">\SomeFolderToServe</span>
PS&gt; c:<span class="command">\Path</span><span class="command">\To</span><span class="command">\ServerHere</span>.exe</code></pre>
<p>And there you go now you&#39;ll have a server running at <code>http://+:8080</code> (meaning <code>localhost</code> and machine name will work).</p>
<p>If you want to change the port it runs on you&#39;ll need to run it as an administrator and then run it like this:</p>
<pre class="highlighted"><code class="tex">PS&gt; c:<span class="command">\Path</span><span class="command">\To</span><span class="command">\ServerHere</span>.exe /p:1234</code></pre>
<p>Now it&#39;ll run on port <code>1234</code> rather than <code>8080</code> (or <code>6590</code> which is  the default administrator port, just to avoid potential conflicts).</p>
<h1>How do it work</h1>
<p>There&#39;s a nifty little class in the .NET framework called <a href="http://msdn.microsoft.com/en-us/library/system.net.httplistener.aspx">HttpListener</a> and this is the core of building your own web server. Basically it&#39;s a little class for handling the HTTP protocol.</p>
<p>To use it you need to create a new instance of the class and then specify some prefixes:</p>
<pre class="highlighted"><code class="avrasm">var listener = new HttpListener()<span class="comment">;</span>
listener<span class="preprocessor">.Prefixes</span><span class="preprocessor">.Add</span>(<span class="string">"http://localhost:8080/"</span>)<span class="comment">;</span>
listener<span class="preprocessor">.Start</span>()<span class="comment">;</span></code></pre>
<p>Now you have a server running and listening on port 8080, via localhost. You can specify what ever hostname you want, or port number (but keep in mind that if you want to run a non-standard port you need to run as an administrator).</p>
<p>To actually handle the requests you can do it synchronously or asynchronously, obviously depending what&#39;s best for your scenario. ServerHere listens asynchronously so I&#39;ll cover that off (if you&#39;re interested in synchronous usages check the MSDN docs).</p>
<p>First off we&#39;ll create our web server class:</p>
<pre class="highlighted"><code class="objectivec"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="id">HttpServer</span></span>
{
    <span class="keyword">private</span> <span class="keyword">readonly</span> HttpListener _listener;

    <span class="keyword">public</span> HttpServer()
    {
        _listener = new HttpListener();
        _listener<span class="variable">.Prefixes</span><span class="variable">.Add</span>(<span class="string">"http://localhost:8080/"</span>);
        _listener<span class="variable">.Start</span>();

        _listener<span class="variable">.BeginGetContext</span>(HandleResponse, null);
    }

    <span class="keyword">public</span> <span class="keyword">void</span> HandlerResponse(IAsyncResult result) { ... }
}</code></pre>
<p>What we&#39;re using here is the <code>BeginGetContext</code> method, this will then deal with an async request. When the <code>Context</code> (which is a HttpContext basically) is ready (ie - someone has requested a URL) you can handle it, write to it, etc:</p>
<pre class="highlighted"><code class="avrasm">private void HandleResponse(IAsyncResult result)
{
    HttpListenerContext context<span class="comment">;</span>
    try
    {
        context = _listener<span class="preprocessor">.EndGetContext</span>(result)<span class="comment">;</span>

        _listener<span class="preprocessor">.BeginGetContext</span>(HandleResponse, null)<span class="comment">;</span>
    }
    catch (HttpListenerException)
    {
        return<span class="comment">;</span>
    }

    using (var response = context<span class="preprocessor">.Response</span>)
    {
        response<span class="preprocessor">.StatusCode</span> = <span class="number">200</span><span class="comment">;</span>
        response<span class="preprocessor">.ContentType</span> = <span class="string">"text/plain"</span><span class="comment">;</span>
        using (var writer = new StreamWriter(response<span class="preprocessor">.OutputStream</span>))
        {
            writer<span class="preprocessor">.Write</span>(<span class="string">"Hello World!"</span>)<span class="comment">;</span>
            writer<span class="preprocessor">.Flush</span>()<span class="comment">;</span>
        }
        response<span class="preprocessor">.Close</span>()<span class="comment">;</span>
    }
}</code></pre>
<p>This method will do the following:</p>
<ul>
<li>Grab the context from the listener (you want to catch the <code>HttpListenerException</code> which will be thrown if the server is shutting down)</li>
<li>Keep the server alive by re-issuing a <code>BeginGetContext</code></li>
<li>Get the response from the context</li>
<li>Set a status code</li>
<li>Set a content type</li>
<li>Write something to the response</li>
</ul>
<p>I&#39;ll leave it as an exercise to the reader to work out how to react to different URLs, return more useful responses, etc.</p>
<h1>Conclusion</h1>
<p>To wrap up we&#39;ve seen a handy little tool for a scenario that you&#39;ll probably never come across.</p>
<p>We then looked at the basics for creating your own web server.</p>
<p>Now go, <a href="http://hg.slace.biz/serverhere/src">grab the source</a> and create web servers to your hearts content!</p>

                        </article>
                    </div>
                    <div class="8u skel-cell-mainContent">
                        <article class="is-post">
                            <div id="disqus_thread"></div>
<script>
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
window.disqus_shortname = 'aaronpowell'; // required: replace example with your forum shortname
window.disqus_identifier = document.title || 'Home';
window.disqus_developer = !! ~document.location.href.indexOf("localhost") ? 1 : 0;
window.disqus_url = document.location.origin + '/serverhere';

/* * * DON'T EDIT BELOW THIS LINE * * */
(function () {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by</a>
<span class="logo-disqus"> Disqus</span>

                        </article>
                    </div>
                </div>
            </div>
        </div>

        <div id="footer-wrapper">

    <!-- Copyright -->
        <div id="copyright" class="container">
            <ul class="links">
                <li>&copy; Aaron Powell. All rights reserved</li>
                <li>Design: <a href="http://html5up.net/">HTML5 UP</a></li>
            </ul>
        </div>

</div>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-6399564-1']);
  _gaq.push(['_trackPageview']);

  (function () {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
  })();

</script>

    </body>
</html>