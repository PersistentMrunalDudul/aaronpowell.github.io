<!DOCTYPE HTML>
<!--
    Strongly Typed 1.0 by HTML5 UP
    html5up.net | @n33co
    Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
    <head>
  <meta charset="utf-8">
  <title>Creating classes in WinJS - LINQ to Fail</title>
  <meta name="author" content="Aaron Powell">
  <meta name="viewport" content="width=1040" />
  <link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600|Arvo:700" rel="stylesheet" type="text/css" />
  <link href="/css/highlightjs/solarized_light.css" rel="stylesheet" type="text/css" />
  <script src="/js/jquery-1.9.1.min.js"></script>
  <script src="/js/jquery.dropotron-1.3.js"></script>
  <script src="/js/config.js"></script>
  <script src="/js/skel.min.js"></script>
  <script src="/js/skel-ui.min.js"></script>
  <noscript>
    <link rel="stylesheet" href="/css/skel-noscript.css" />
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/style-desktop.css" />
  </noscript>
  <!--[if lte IE 8]><script src="/js/html5shiv.js"></script><![endif]-->

</head>

    <body class="left-sidebar">

        <div id="header-wrapper">
            <div id="header" class="container">
                <h1 id="logo">Creating classes in WinJS</h1>
                <h2>14th September 2012</h2>
                <ul class="tags">
    
        <li><a class="icon icon-tag" href="/tagged/winjs.html"><span>winjs</span></a></li>
    
        <li><a class="icon icon-tag" href="/tagged/windows8.html"><span>windows8</span></a></li>
    
        <li><a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a></li>
    
</ul>
                <!-- Nav -->
<nav id="nav">
    <ul>
        <li><a class="icon icon-home" href="/"><span>Home</span></a></li>
        <li><a class="icon icon-github" href="https://github.com/aaronpowell"><span>aaronpowell</span></a></li>
        <li><a class="icon icon-twitter" href="http://twitter.com/slace"><span>@slace</span></a></li>
        <li><a class="icon icon-book" href="/about"><span>About Me</span></a></li>
        <li><a class="icon icon-rss" href="/feed"><span>Feed</span></a></li>
    </ul>
</nav>

            </div>
        </div>

        <div id="main-wrapper">
            <div id="main" class="container">
                <div class="row">
                    <div id="sidebar" class="4u">
    <section>
        <ul class="divided">
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">5th July 2013</span>
                            <h3><a href="/posts/2013-07-05-javascript-binding-currying-and-arrows.html">JavaScript bind, currying and arrow functions</a></h3>
                        </header>
                        <p>After confusing my colleagues with how to invoke functions with a modifided set of arguments at a single time the next evolutionary point was to confuse them with creating functions that are always called with a different state.</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">4th July 2013</span>
                            <h3><a href="/posts/2013-07-04-javascript-call-and-apply.html">JavaScript call and apply</a></h3>
                        </header>
                        <p>After having confused one of my colleagues with some code that used the JavaScript <code>apply</code> method and giving them an answer that didn&#39;t leave them completely bemused I thought I&#39;d share my explanation with the world.</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">21st June 2013</span>
                            <h3><a href="/posts/2013-06-21-walking-a-javascript-object.html">Walking a JavaScript object</a></h3>
                        </header>
                        <p>Ever had a path to a path to a property on a JavaScript object that you want to walk? Something along the lines of <code>foo.bar.baz</code>.</p>
<p>Recently I was trying to solve this problem and came across a nifty little trick</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">22nd January 2013</span>
                            <h3><a href="/posts/2013-01-22-hello-mathy.html">Hello mathy</a></h3>
                        </header>
                        <p>An introduction to another new library from me, this time it&#39;s mathy, a simple formula parser</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/typescript.html"><span>typescript</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/web.html"><span>web</span></a>
                            
                        </div>
                    </article>
                </li>
            
                <li>
                    <article class="is-excerpt">
                        <header>
                            <span class="date">14th January 2013</span>
                            <h3><a href="/posts/2013-01-14-ie10-console-thoughts.html">Making the Internet Explorer JavaScript tools better, again</a></h3>
                        </header>
                        <p>A look at what&#39;s changed since I last pointed out the failings of the IE dev tools</p>

                        <div class="tags">
                            
                                <a class="icon icon-tag" href="/tagged/javascript.html"><span>javascript</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/web.html"><span>web</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/internet-explorer.html"><span>internet-explorer</span></a>
                            
                                <a class="icon icon-tag" href="/tagged/web-dev.html"><span>web-dev</span></a>
                            
                        </div>
                    </article>
                </li>
            
        </ul>
    </section>
</div>

                    <div id="content" class="8u skel-cell-mainContent">
                        <article class="is-post">
                            <p>Sure using classes in JavaScript <em>may</em> not be a great idea, you can&#39;t help but argue that there are valid scenarios which you would be wanting to use the class pattern.</p>
<p>If you&#39;re doing WinJS development there&#39;s an API that will allow you to make classes easily, <code>WinJS.Class</code> being the root. From here you can define new classes, derive classes or create mixins.</p>
<h1>Creating a class</h1>
<p>It&#39;s very easy to create a class using the WinJS API, here&#39;s a simple person:</p>
<pre class="highlighted"><code class="matlab"> var Person = <span class="transposed_variable">WinJS.</span><span class="transposed_variable">Class.</span>define(<span class="function"><span class="keyword">function</span> <span class="params">(firstName, lastName)</span> {</span>
    <span class="transposed_variable">this.</span>firstName = firstName;
    <span class="transposed_variable">this.</span>lastName = lastName;
});

var me = new Person(<span class="string">'Aaron'</span>, <span class="string">'Powell'</span>);
<span class="transposed_variable">console.</span><span class="built_in">log</span>(<span class="transposed_variable">me.</span>firstName + <span class="string">' '</span> <span class="transposed_variable">me.</span>lastName);</code></pre>
<p>Not very exciting is it?</p>
<p>Well let&#39;s say you want to add some instance members:</p>
<pre class="highlighted"><code class="javascript"> <span class="keyword">var</span> Person = WinJS.Class.define(<span class="function"><span class="keyword">function</span> <span class="params">(firstName, lastName)</span> {</span>
    <span class="keyword">this</span>.firstName = firstName;
    <span class="keyword">this</span>.lastName = lastName;
}, {
    sayHello: <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
       console.log(<span class="string">'Hello there good sir'</span>);
    }
});

<span class="keyword">var</span> me = <span class="keyword">new</span> Person(<span class="string">'Aaron'</span>, <span class="string">'Powell'</span>);

me.sayHello();</code></pre>
<p>The 2nd argument to the <code>define</code> method is a JavaScript object that represents the <em>public instance</em> members which you will have available on your class. There&#39;s also a third argument you can use which allows you to create <em>public static</em> members.</p>
<h2>Powerful properties</h2>
<p>Something that I found rather cool and not particularly well documented is how the properties are created (both the instance and static properties). Internally they are created using the <a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Object/defineProperty"><code>Object.defineProperties</code></a> method, and since this is ECMAScript 5 we&#39;re able to do some cool things, such as leveraging the new property features, like so:</p>
<pre class="highlighted"><code class="actionscript"> <span class="keyword">var</span> Person = WinJS.Class.define(<span class="function"><span class="keyword">function</span> <span class="params">(firstName, lastName)</span> {</span>
    <span class="keyword">this</span>.firstName = firstName;
    <span class="keyword">this</span>.lastName = lastName;
}, {
    fullName: {
        <span class="keyword">get</span>: <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span> <span class="keyword">return</span> <span class="keyword">this</span>.firstName + <span class="string">' '</span> + <span class="keyword">this</span>.lastName; }
    }
});</code></pre>
<p>What I&#39;ve done here is used a property descriptor to create a <strong>read only</strong> property which calculates a value based off of other properties on the object. WinJS takes this information and then creates it properly so I can do:</p>
<pre class="highlighted"><code class="avrasm">console<span class="preprocessor">.log</span>(me<span class="preprocessor">.fullName</span>)<span class="comment">;</span></code></pre>
<p>If I then try and <code>set</code> the value of <code>fullName</code> nothing will happen, it gets ignored.</p>
<p>You can also leverage this to create properties with validation in them:</p>
<pre class="highlighted"><code class="actionscript"> <span class="keyword">var</span> Person = WinJS.Class.define(<span class="function"><span class="keyword">function</span> <span class="params">(firstName, lastName)</span> {</span>
    <span class="keyword">this</span>.firstName = firstName;
    <span class="keyword">this</span>.lastName = lastName;
}, {
    fullName: {
        <span class="keyword">get</span>: <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span> <span class="keyword">return</span> <span class="keyword">this</span>.firstName + <span class="string">' '</span> + <span class="keyword">this</span>.lastName; }
    },
    age: {
       <span class="keyword">get</span>: <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
           <span class="keyword">return</span> <span class="keyword">this</span>._age;
       },
       <span class="keyword">set</span>: <span class="function"><span class="keyword">function</span> <span class="params">(value)</span> {</span>
           <span class="keyword">if</span> (value &lt; <span class="number">0</span>) {
               <span class="keyword">throw</span> <span class="string">'Age must be greater than or equal to 0'</span>;
           }

           <span class="keyword">this</span>._age = value;
       }
   },
   _age: <span class="number">0</span>
});</code></pre>
<p>Now I have a more intelligent property in <code>age</code>, it will do validation to make sure that you don&#39;t have a negative age and it stores its information in a pseudo-private property, that being <code>_age</code>.</p>
<p>Pseudo-private property? Huh? Since JavaScript doesn&#39;t really have the notion of classes the concept of public/ private members doesn&#39;t exist. You <em>can</em> have things internal to the &quot;constructor&quot; function, but they can&#39;t be accessed outside of that scope. Instead what WinJS does (and many other class pattern libraries) is uses the <code>_</code> prefix to denote something as private. While this wont actually be private, it&#39;s a bit harder to learn about (Visual Studio intellisense drops any JavaScript members that start with it for example).</p>
<p>The other thing that WinJS does to help you hide these members is it will look to see if you&#39;ve provided a property descriptor, and then look for the <code>enumerable</code> property of it (if you don&#39;t have a property descriptor it creates one and sets <code>enumerable</code> to <code>false</code>). When the <code>enumerable</code> property on a descriptor is <code>false</code> (the default too BTW) the property will be skipped when the properties are enumerated by say a <code>for-in</code> loop or <code>Object.keys</code>.</p>
<p>So these <code>_</code>-prefixed members are hidden as best as they can be in JavaScript, and it&#39;s really neat that you can use a common coding convention to mark them as hidden rather than having to create a full descriptor yourself.</p>
<h1>Deriving classes</h1>
<p>Sometimes just creating a class isn&#39;t enough, you want to have a base class which you can then derive others from. Again since there&#39;s no class system in JavaScript this isn&#39;t native, but through the use of prototypes you can simulate this inheritance. WinJS provides a simple to use API for doing classical inheritance, <code>WinJS.Class.derive</code>.</p>
<p>Let&#39;s use the tacky person-employee example for this:</p>
<pre class="highlighted"><code class="avrasm">var Employee = WinJS<span class="preprocessor">.Class</span><span class="preprocessor">.derive</span>(Person, function (firstName, lastName, position) {
    this<span class="preprocessor">.firstName</span> = firstName<span class="comment">;</span>
    this<span class="preprocessor">.lastName</span> = lastName<span class="comment">;</span>
    this<span class="preprocessor">.position</span> = position<span class="comment">;</span>
})<span class="comment">;</span></code></pre>
<p>For this as you can probably tell you provide the first argument of the method as the base class and then all arguments beyond that are the same as if you&#39;re calling <code>define</code>.</p>
<p><em>Side note - if you don&#39;t provide a base class it will pipe the arguments through to the <code>define</code> function anyway.</em></p>
<p>Since this inherits from the <code>Person</code> class I have access to all its members so I can call <code>sayHello</code> for example, or set the age of  the employee.</p>
<h2>A gotcha with derived classes</h2>
<p>While working with the <code>derive</code> API I hit a problem, <strong>the base class constructor was never called!</strong> I had a base class that I defined like this:</p>
<pre class="highlighted"><code class="javascript"><span class="keyword">var</span> Bootstrapper = WinJS.Class.define(<span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
    <span class="keyword">var</span> initialised = <span class="literal">false</span>;

    <span class="keyword">this</span>.init = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
        <span class="comment">//do some init stuff</span>
        <span class="comment">//eventually call customInit</span>
    };
}, {
    customInit: <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>}
});</code></pre>
<p>So this was the bootstrapper for my application but I wanted it so I could create an extended version of it for the different parts so I could bootstrap each individually. I then extended it like so:</p>
<pre class="highlighted"><code class="javascript"><span class="keyword">var</span> MainBootstrapper = WinJS.Class.derive(MyApp.Bootstrapper, <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
}, {
    customInit: <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
        <span class="comment">//do some custom stuff</span>
    }
});

<span class="keyword">new</span> MainBootstrapper().init();</code></pre>
<p>But this crashes, it crashes because <code>init</code> was not found on my <code>MainBootstrapper</code>. Strange, my type inherits from <code>Bootstrapper</code>, if I create an instance of <code>Bootstrapper</code> I get that, so why don&#39;t I have the <code>init</code> method on my derived type?</p>
<p>Well here&#39;s the problem the &quot;base constructor&quot; is never called. This means that anything done in the constructor of the type you&#39;re inheriting from doesn&#39;t get executed, and since that&#39;s where I was defining my <code>init</code> method it never got added to the object! The reason for this is that the <code>derive</code> method only does prototypal inheritance, it doesn&#39;t do constructor inheritance.</p>
<p>The easiest way to get around this is to move what you&#39;re setting up in your constructor into being setup in the instance members like the earlier <code>Person</code> example. If this isn&#39;t possible you can solve it in another way by manually calling the base class constructor function yourself, like so:</p>
<pre class="highlighted"><code class="javascript"><span class="keyword">var</span> MainBootstrapper = WinJS.Class.derive(MyApp.Bootstrapper, <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
    MyApp.Bootstrapper.apply(<span class="keyword">this</span>);        
}, {
    customInit: <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
        <span class="comment">//do some custom stuff</span>
    }
});

<span class="keyword">new</span> MainBootstrapper().init();</code></pre>
<p>Here you&#39;ll notice I&#39;m using the <code>apply</code> method to invoke the <code>MyApp.Bootstrapper</code> function. By doing that and passing <code>this</code> into it we&#39;re setting the scope of the function to be the instance of the <code>MainBootstrapper</code> being created, which in turn will perform any logic against it and properly extend the <code>MainBootstrapper</code> object with the base class constructor logic.</p>
<p>This is a frustrating problem, it took me <em>ages</em> to work out why my inheritance wasn&#39;t working the way I was expecting it to so watch out if you&#39;re doing classical inheritance in WinJS <em>and</em> wanting constructor inheritance.</p>
<h1>Mixins</h1>
<p>The <code>WinJS.Class.mix</code> function is an interesting one and not something that you&#39;ll likely have come across before. What it does is allow you to implement multiple inheritance in JavaScript (and if you&#39;re a .NETter this wont exactly be familiar :P).</p>
<p>Let&#39;s revisit our Employee example:</p>
<pre class="highlighted"><code class="smalltalk">var payable = {
    <span class="method">accountNumber:</span> <span class="number">0</span>,
    <span class="method">bsb:</span> <span class="number">0</span>,
    <span class="method">accountName:</span> <span class="string">''</span>,
    <span class="method">rate:</span> <span class="number">150</span>
};

var worker = {
    <span class="method">expectedHours:</span> <span class="number">8</span>,
    <span class="method">worksWeekends:</span> <span class="keyword">false</span>
};

var <span class="class">Employee</span> = <span class="class">WinJS</span>.<span class="class">Class</span>.mix(<span class="class">Person</span>, payable, worker);</code></pre>
<p>Here instead of using the <code>derive</code> function I&#39;ve used <code>mix</code> to create our Employee. This time I&#39;ve got a few objects that represent various things that could make up my employee type and I use <code>mix</code> to ultimately put them all together. The first argument is the constructor function which you want to use, so my <code>Person</code> class goes there and then it&#39;s essentially a <code>param[]</code> argument, everything that&#39;s used after the constructor has its properties copied onto the object, building up the members of it. Again this has the same property creation logic as <code>define</code> so you can make pseudo-privates, you can add get/ set bodies, etc.</p>
<h1>Conclusion</h1>
<p>So this wraps up our look at the <code>WinJS.Class</code> API. I&#39;m not trying to convince you that you should use classes in your JavaScript code but instead have a look a the API for it if/ when you reach the point that you think classes can have benefits inside of your WinJS application.</p>
<p>I also wanted to document some of the more intelligent features about how you can create classes, that it&#39;s smart enough to look for, and use, the ECMAScript 5 properties as well as taking conventions into account for creating privates. I also wanted to raise the problem that you can hit with the way classical inheritance is implemented in WinJS.</p>

                        </article>
                    </div>
                    <div class="8u skel-cell-mainContent">
                        <article class="is-post">
                            <div id="disqus_thread"></div>
<script>
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
window.disqus_shortname = 'aaronpowell'; // required: replace example with your forum shortname
window.disqus_identifier = document.title || 'Home';
window.disqus_developer = !! ~document.location.href.indexOf("localhost") ? 1 : 0;
window.disqus_url = document.location.origin + '/winjs/creating-classes';

/* * * DON'T EDIT BELOW THIS LINE * * */
(function () {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by</a>
<span class="logo-disqus"> Disqus</span>

                        </article>
                    </div>
                </div>
            </div>
        </div>

        <div id="footer-wrapper">

    <!-- Copyright -->
        <div id="copyright" class="container">
            <ul class="links">
                <li>&copy; Aaron Powell. All rights reserved</li>
                <li>Design: <a href="http://html5up.net/">HTML5 UP</a></li>
            </ul>
        </div>

</div>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-6399564-1']);
  _gaq.push(['_trackPageview']);

  (function () {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
  })();

</script>

    </body>
</html>